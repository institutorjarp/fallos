<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Instituto de Recursos Judiciales, Argumentación y Razonamiento Probatorio - Sistema de Carga de Fallos</title>
    <link rel="icon" type="image/png" sizes="32x32" href="favicon.png">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&family=Playfair+Display:wght@500;600;700&display=swap" rel="stylesheet">
    
    <style>
        /* ===== VARIABLES Y RESET ===== */
        :root {
            --primary-color: #2c3e50;
            --secondary-color: #34495e;
            --accent-color: #3498db;
            --success-color: #27ae60;
            --warning-color: #f39c12;
            --danger-color: #e74c3c;
            --light-color: #ecf0f1;
            --dark-color: #2c3e50;
            --border-color: #bdc3c7;
            --shadow: 0 1px 4px rgba(0, 0, 0, 0.05);
            --border-radius: 4px;
            --transition: all 0.2s ease;
            --gray-600: #718096;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Roboto', sans-serif;
            background-color: #f8f9fa;
            color: #333;
            line-height: 1.5;
            padding: 15px;
            font-size: 14px;
        }
        
        .container {
            max-width: 1100px;
            margin: 0 auto;
        }
        
        /* ===== HEADER PROFESIONAL ===== */
        .header {
            margin-bottom: 25px;
            padding: 0;
            border-radius: var(--border-radius);
            overflow: hidden;
            box-shadow: var(--shadow);
        }
        
        .header-top {
            background: linear-gradient(135deg, #1a2634, #2c3e50);
            color: white;
            padding: 25px 30px;
            text-align: center;
            border-bottom: 3px solid var(--accent-color);
        }
        
        .instituto-nombre {
            font-size: 1.3rem;
            font-weight: 400;
            letter-spacing: 1px;
            margin-bottom: 10px;
            font-family: 'Playfair Display', serif;
            opacity: 0.95;
        }
        
        .sistema-titulo {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            font-family: 'Playfair Display', serif;
        }
        
        .sistema-titulo i {
            color: var(--accent-color);
            font-size: 1.8rem;
        }
        
        .header-subtitle {
            font-size: 1rem;
            opacity: 0.9;
            max-width: 700px;
            margin: 0 auto;
            font-style: italic;
        }
        
        .header-footer {
            background-color: var(--secondary-color);
            color: white;
            padding: 10px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.85rem;
        }
        
        .badge {
            background-color: var(--accent-color);
            color: white;
            padding: 4px 10px;
            border-radius: 20px;
            font-weight: 500;
            font-size: 0.8rem;
        }
        
        /* ===== PANEL DE RESUMEN ===== */
        .resumen-panel {
            background: white;
            border-radius: var(--border-radius);
            padding: 18px 22px;
            margin-bottom: 25px;
            box-shadow: var(--shadow);
            border: 1px solid #e9ecef;
            border-left: 5px solid var(--accent-color);
        }
        
        .resumen-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
            padding-bottom: 8px;
            border-bottom: 1px solid #edf2f7;
            color: var(--gray-600);
            font-size: 0.8rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .resumen-badge {
            background: var(--light-color);
            padding: 4px 12px;
            border-radius: 30px;
            font-weight: 600;
            font-size: 0.75rem;
            color: var(--primary-color);
        }
        
        .resumen-encabezado {
            background: #f8fafc;
            border-radius: 6px;
            padding: 12px 16px;
            margin-bottom: 16px;
            border: 1px solid #e2e8f0;
            display: flex;
            flex-wrap: wrap;
            align-items: center;
            gap: 12px;
        }
        
        .resumen-encabezado-icono {
            background: var(--accent-color);
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            flex-shrink: 0;
        }
        
        .resumen-encabezado-contenido {
            flex: 1;
        }
        
        .resumen-encabezado-titulo {
            font-size: 1rem;
            font-weight: 600;
            color: var(--primary-color);
            margin-bottom: 4px;
            font-family: 'Playfair Display', serif;
        }
        
        .resumen-encabezado-detalle {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
            color: var(--gray-600);
            font-size: 0.8rem;
        }
        
        .resumen-encabezado-detalle i {
            color: var(--accent-color);
            margin-right: 4px;
        }
        
        .resumen-encabezado-badge {
            background: #e6f7e6;
            color: var(--success-color);
            padding: 4px 12px;
            border-radius: 30px;
            font-size: 0.75rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 6px;
        }
        
        /* ===== DOS COLUMNAS PARA EL RESUMEN TÉCNICO ===== */
        .resumen-columnas {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 5px;
        }
        
        .resumen-columna {
            display: flex;
            flex-direction: column;
            gap: 16px;
        }
        
        .resumen-seccion {
            background: #f8fafc;
            border-radius: 6px;
            padding: 14px 16px;
            border: 1px solid #edf2f7;
        }
        
        .resumen-seccion-titulo {
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: 600;
            color: var(--primary-color);
            font-size: 0.85rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 10px;
            padding-bottom: 8px;
            border-bottom: 1px solid #e2e8f0;
        }
        
        .resumen-seccion-titulo i {
            color: var(--accent-color);
            font-size: 0.9rem;
        }
        
        .resumen-item {
            display: flex;
            align-items: flex-start;
            margin-bottom: 8px;
            padding-bottom: 6px;
            border-bottom: 1px dashed #edf2f7;
        }
        
        .resumen-item:last-child {
            border-bottom: none;
            margin-bottom: 0;
            padding-bottom: 0;
        }
        
        .resumen-icono {
            width: 22px;
            color: var(--accent-color);
            margin-right: 10px;
            text-align: center;
            font-size: 0.85rem;
            flex-shrink: 0;
        }
        
        .resumen-label {
            font-weight: 600;
            color: var(--secondary-color);
            min-width: 100px;
            flex-shrink: 0;
            font-size: 0.85rem;
        }
        
        .resumen-valor {
            color: #2d3748;
            word-break: break-word;
            flex: 1;
            line-height: 1.5;
            font-size: 0.85rem;
        }
        
        .resumen-chip {
            display: inline-block;
            background: #edf2f7;
            padding: 3px 12px;
            border-radius: 30px;
            font-size: 0.8rem;
            margin: 2px 6px 2px 0;
            color: #2d3748;
            border: 1px solid #e2e8f0;
        }
        
        .resumen-redactado {
            margin-top: 25px;
            padding-top: 20px;
            border-top: 1px solid #e2e8f0;
        }
        
        .resumen-redactado-titulo {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.85rem;
            font-weight: 600;
            color: var(--primary-color);
            margin-bottom: 15px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .resumen-redactado-titulo i {
            color: var(--accent-color);
        }
        
        .resumen-redactado-contenido {
            background: #f8fafc;
            border-radius: 6px;
            padding: 18px 22px;
            border-left: 4px solid var(--accent-color);
            font-size: 0.9rem;
            line-height: 1.6;
            color: #2d3748;
        }
        
        .resumen-redactado-contenido p {
            margin-bottom: 12px;
        }
        
        .resumen-redactado-contenido p:last-child {
            margin-bottom: 0;
        }
        
        .resumen-vacio {
            color: var(--gray-600);
            font-style: italic;
            padding: 30px;
            text-align: center;
            background: #f8fafc;
            border-radius: 6px;
            font-size: 0.9rem;
        }
        
        .resumen-footer {
            margin-top: 20px;
            padding-top: 15px;
            border-top: 1px solid #edf2f7;
            font-size: 0.75rem;
            color: var(--gray-600);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .resumen-footer-left {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .resumen-footer-left i {
            color: var(--accent-color);
        }
        
        .resumen-footer-right {
            font-weight: 600;
            color: var(--accent-color);
            background: #e6f0fa;
            padding: 5px 15px;
            border-radius: 30px;
            font-size: 0.7rem;
        }
        
        /* ===== FORMULARIOS ===== */
        .form-section {
            background: white;
            border-radius: var(--border-radius);
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: var(--shadow);
            transition: var(--transition);
        }
        
        .form-section:hover {
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        }
        
        .section-title {
            font-size: 1.4rem;
            color: var(--primary-color);
            margin-bottom: 18px;
            padding-bottom: 8px;
            border-bottom: 2px solid var(--accent-color);
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .section-title i {
            color: var(--accent-color);
            font-size: 1.2rem;
        }
        
        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 18px;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        .form-group.full-width {
            grid-column: 1 / -1;
        }
        
        label {
            display: block;
            margin-bottom: 6px;
            font-weight: 500;
            color: var(--secondary-color);
            font-size: 0.95rem;
        }
        
        .required::after {
            content: " *";
            color: var(--danger-color);
        }
        
        input[type="text"],
        input[type="date"],
        textarea,
        select {
            width: 100%;
            padding: 10px 12px;
            border: 1.5px solid var(--border-color);
            border-radius: var(--border-radius);
            font-size: 0.95rem;
            transition: var(--transition);
            background-color: white;
        }
        
        input[type="text"]:focus,
        input[type="date"]:focus,
        textarea:focus,
        select:focus {
            outline: none;
            border-color: var(--accent-color);
            box-shadow: 0 0 0 2px rgba(52,152,219,0.1);
        }
        
        .custom-input {
            margin-top: 10px;
            animation: fadeIn 0.3s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-5px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        textarea {
            min-height: 100px;
            resize: vertical;
        }
        
        .option-group {
            background: #f8f9fa;
            padding: 15px;
            border-radius: var(--border-radius);
            border: 1px solid #e9ecef;
        }
        
        .options-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
            gap: 10px;
        }
        
        .checkbox-option,
        .radio-option {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px;
            background: white;
            border-radius: 5px;
            border: 1px solid var(--border-color);
            transition: var(--transition);
            cursor: pointer;
            font-size: 0.9rem;
        }
        
        .checkbox-option:hover,
        .radio-option:hover {
            border-color: var(--accent-color);
            background-color: #f0f8ff;
        }
        
        .checkbox-option input,
        .radio-option input {
            width: 16px;
            height: 16px;
            cursor: pointer;
        }
        
        .checkbox-option label,
        .radio-option label {
            margin: 0;
            cursor: pointer;
            font-weight: normal;
            flex: 1;
            font-size: 0.9rem;
        }
        
        .method-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 10px;
        }
        
        .collapsible {
            margin-bottom: 15px;
        }
        
        .collapsible-header {
            background: var(--light-color);
            padding: 12px 15px;
            border-radius: var(--border-radius);
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
            font-weight: 600;
            color: var(--primary-color);
            border: 1px solid var(--border-color);
            transition: var(--transition);
            font-size: 0.95rem;
        }
        
        .collapsible-header:hover {
            background: #dfe6e9;
        }
        
        .collapsible-header i {
            transition: transform 0.2s ease;
            font-size: 0.9rem;
        }
        
        .collapsible-header.active i {
            transform: rotate(180deg);
        }
        
        .collapsible-content {
            padding: 15px;
            border: 1px solid var(--border-color);
            border-top: none;
            border-radius: 0 0 var(--border-radius) var(--border-radius);
            background: white;
            display: none;
        }
        
        .collapsible-content.active {
            display: block;
        }
        
        .conditional-section {
            border-left: 4px solid var(--accent-color);
            padding-left: 15px;
            margin-top: 15px;
            margin-bottom: 15px;
            background-color: #f9fafb;
            border-radius: 0 var(--border-radius) var(--border-radius) 0;
            padding: 15px;
            display: none;
        }
        
        .conditional-section.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }
        
        .sub-section {
            background: #f0f2f5;
            padding: 15px;
            border-radius: var(--border-radius);
            margin-top: 10px;
            border: 1px solid var(--border-color);
        }
        
        .buttons-container {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 30px;
            padding: 15px;
        }
        
        .btn {
            padding: 12px 30px;
            border: none;
            border-radius: var(--border-radius);
            font-size: 0.95rem;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            min-width: 160px;
        }
        
        .btn-submit {
            background: var(--success-color);
            color: white;
        }
        
        .btn-submit:hover {
            background: #219653;
            transform: translateY(-1px);
            box-shadow: var(--shadow);
        }
        
        .btn-reset {
            background: var(--danger-color);
            color: white;
        }
        
        .btn-reset:hover {
            background: #c0392b;
            transform: translateY(-1px);
            box-shadow: var(--shadow);
        }
        
        /* ===== RESPONSIVE ===== */
        @media (max-width: 768px) {
            .resumen-columnas {
                grid-template-columns: 1fr;
                gap: 15px;
            }
            
            .resumen-encabezado {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .resumen-item {
                flex-direction: column;
            }
            
            .resumen-icono {
                display: none;
            }
            
            .resumen-label {
                min-width: 100%;
                margin-bottom: 4px;
            }
            
            .form-grid {
                grid-template-columns: 1fr;
            }
            
            .options-container,
            .method-grid {
                grid-template-columns: 1fr;
            }
            
            .buttons-container {
                flex-direction: column;
            }
        }
        
        .status-message {
            padding: 12px 15px;
            border-radius: var(--border-radius);
            margin-bottom: 15px;
            display: none;
            font-weight: 500;
            font-size: 0.9rem;
        }
        
        .status-success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .status-error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .footer {
            text-align: center;
            margin-top: 35px;
            padding: 15px;
            color: #7f8c8d;
            font-size: 0.8rem;
            border-top: 1px solid var(--border-color);
        }
        
        .helper-text {
            font-size: 0.8rem;
            color: #7f8c8d;
            margin-top: 4px;
            font-style: italic;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- HEADER -->
        <header class="header">
            <div class="header-top">
                <div class="instituto-nombre">
                    <i class="fas fa-university"></i> Instituto de Recursos Judiciales, Argumentación y Razonamiento Probatorio
                </div>
                <h1 class="sistema-titulo">
                    <i class="fas fa-gavel"></i> Sistema de Carga de Fallos Judiciales
                </h1>
                <p class="header-subtitle">Análisis sistematizado de jurisprudencia penal y constitucional</p>
            </div>
            <div class="header-footer">
                <span><i class="fas fa-balance-scale"></i> Especialización en Derecho Penal y Procesal Penal</span>
                <span class="badge"><i class="fas fa-file-alt"></i> Formulario de análisis crítico</span>
            </div>
        </header>
        
        <!-- PANEL DE RESUMEN -->
        <div class="resumen-panel" id="resumenPanel">
            <div class="resumen-header">
                <span><i class="fas fa-file-alt"></i> RESUMEN DEL FALLO - ACTUALIZACIÓN EN TIEMPO REAL</span>
                <span class="resumen-badge" id="resumenBadge">Sin datos</span>
            </div>
            
            <!-- CONTENIDO DEL RESUMEN TÉCNICO (DOS COLUMNAS) -->
            <div id="resumenContenido"></div>
            
            <!-- RESUMEN NARRATIVO -->
            <div class="resumen-redactado" id="resumenRedactado" style="display: none;">
                <div class="resumen-redactado-titulo">
                    <i class="fas fa-quote-left"></i> RESUMEN NARRATIVO DEL FALLO
                </div>
                <div class="resumen-redactado-contenido" id="resumenRedactadoContenido"></div>
            </div>
            
            <div class="resumen-footer" id="resumenFooter"></div>
        </div>
        
        <div id="statusMessage" class="status-message"></div>
        
        <form id="fallosForm">
            <!-- SECCIÓN 1: IDENTIFICACIÓN -->
            <section class="form-section">
                <h2 class="section-title"><i class="fas fa-id-card"></i> 1. Identificación del fallo</h2>
                <div class="form-grid">
                    <div class="form-group">
                        <label for="caratula" class="required">Carátula</label>
                        <input type="text" id="caratula" name="caratula" required placeholder="Ej: 'Pérez, Juan c/ Estado Nacional'" onchange="actualizarResumen()" onkeyup="actualizarResumen()">
                    </div>
                    <div class="form-group">
                        <label for="fallos" class="required">Fallos (tomo/página)</label>
                        <input type="text" id="fallos" name="fallos" required placeholder="Ej: 'Fallos: 336:1234'" onchange="actualizarResumen()" onkeyup="actualizarResumen()">
                    </div>
                    <div class="form-group">
                        <label for="fecha" class="required">Fecha</label>
                        <input type="date" id="fecha" name="fecha" required onchange="actualizarResumen()">
                    </div>
                </div>
            </section>
            
            <!-- SECCIÓN 2: TRIBUNAL -->
            <section class="form-section">
                <h2 class="section-title"><i class="fas fa-gavel"></i> 2. Composición del Tribunal</h2>
                <div class="form-grid">
                    <div class="form-group">
                        <label for="integracion" class="required">Integración de la Corte</label>
                        <textarea id="integracion" name="integracion" required placeholder="Liste los miembros del tribunal..." onchange="actualizarResumen()" onkeyup="actualizarResumen()"></textarea>
                    </div>
                    <div class="form-group">
                        <label class="required">Voto</label>
                        <div class="option-group">
                            <div class="options-container">
                                <div class="radio-option">
                                    <input type="radio" id="voto-unanimidad" name="voto" value="unanimidad" required onclick="toggleDisidencias(false); actualizarResumen()">
                                    <label for="voto-unanimidad">Unanimidad</label>
                                </div>
                                <div class="radio-option">
                                    <input type="radio" id="voto-mayoria" name="voto" value="mayoria" onclick="toggleDisidencias(false); actualizarResumen()">
                                    <label for="voto-mayoria">Mayoría</label>
                                </div>
                                <div class="radio-option">
                                    <input type="radio" id="voto-disidencias" name="voto" value="disidencias" onclick="toggleDisidencias(true); actualizarResumen()">
                                    <label for="voto-disidencias">Disidencias (indicar cuáles)</label>
                                </div>
                            </div>
                        </div>
                        <div id="disidenciasContainer" class="conditional-section">
                            <label for="detalleDisidencias" class="required">Detalle de las disidencias</label>
                            <textarea id="detalleDisidencias" name="detalleDisidencias" required placeholder="Indique qué jueces disentieron y los fundamentos..." onchange="actualizarResumen()" onkeyup="actualizarResumen()"></textarea>
                        </div>
                    </div>
                </div>
            </section>
            
            <!-- SECCIÓN 3: TEMA JURÍDICO CENTRAL -->
            <section class="form-section">
                <h2 class="section-title"><i class="fas fa-balance-scale"></i> 3. Tema jurídico central</h2>
                
                <div class="form-grid">
                    <!-- MATERIA PRINCIPAL -->
                    <div class="form-group full-width">
                        <label class="required">Materia principal:</label>
                        <div class="option-group">
                            
                            <!-- 3.1 ARBITRARIEDAD -->
                            <div style="margin-bottom: 15px;">
                                <div class="checkbox-option" style="background: #e8f0fe; border-left: 3px solid var(--accent-color); margin-bottom: 10px;">
                                    <input type="checkbox" id="materia-arbitrariedad" name="materiaPrincipal" value="arbitrariedad" onclick="toggleArbitrariedadGeneral(this); actualizarResumen()">
                                    <label for="materia-arbitrariedad"><strong>Arbitrariedad</strong></label>
                                </div>
                                
                                <div id="arbitrariedadGeneralContainer" style="display: none; margin-left: 25px;">
                                    
                                    <!-- 3.1.a) NORMATIVA -->
                                    <div style="margin-bottom: 12px;">
                                        <div class="checkbox-option" style="background: #f8f9fa;">
                                            <input type="checkbox" id="arbitrariedad-normativa" name="arbitrariedadPrincipal" value="Normativa" onclick="actualizarResumen()">
                                            <label for="arbitrariedad-normativa"><strong>Normativa</strong></label>
                                        </div>
                                    </div>
                                    
                                    <!-- 3.1.b) FÁCTICA -->
                                    <div style="margin-bottom: 12px;">
                                        <div class="checkbox-option" style="background: #f8f9fa; border-left: 2px solid var(--warning-color);">
                                            <input type="checkbox" id="arbitrariedad-factica" name="arbitrariedadPrincipal" value="Fáctica" onclick="toggleArbitrariedadFactica(this); actualizarResumen()">
                                            <label for="arbitrariedad-factica"><strong>Fáctica</strong></label>
                                        </div>
                                        <div id="arbitrariedadFacticaContainer" style="display: none; margin-left: 25px; margin-top: 10px;">
                                            <div class="options-container" style="grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));">
                                                <div class="checkbox-option" style="background: #fff4e6;">
                                                    <input type="checkbox" id="factica-conceptual" name="arbitrariedadFactica" value="Conceptual" onclick="actualizarResumen()">
                                                    <label for="factica-conceptual">Conceptual</label>
                                                </div>
                                                <div class="checkbox-option" style="background: #fff4e6;">
                                                    <input type="checkbox" id="factica-normativa" name="arbitrariedadFactica" value="Normativa" onclick="actualizarResumen()">
                                                    <label for="factica-normativa">Normativa</label>
                                                </div>
                                                <div class="checkbox-option" style="background: #fff4e6;">
                                                    <input type="checkbox" id="factica-epistemica" name="arbitrariedadFactica" value="Epistémica" onclick="actualizarResumen()">
                                                    <label for="factica-epistemica">Epistémica</label>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- 3.1.c) OTRAS CAUSALES -->
                                    <div style="margin-top: 15px;">
                                        <div class="checkbox-option" style="background: #f8f9fa; border-left: 2px solid var(--accent-color);">
                                            <input type="checkbox" id="arbitrariedad-otras-causales" name="arbitrariedadPrincipal" value="Otras causales" onclick="toggleOtrasCausales(this); actualizarResumen()">
                                            <label for="arbitrariedad-otras-causales"><strong>Otras causales de Arbitrariedad</strong></label>
                                        </div>
                                        
                                        <div id="otrasCausalesContainer" style="display: none; margin-left: 25px; margin-top: 15px;">
                                            
                                            <!-- 3.1.c.1 Falta de fundamentación suficiente -->
                                            <div style="margin-bottom: 15px;">
                                                <div class="checkbox-option" style="background: #f8f9fa;">
                                                    <input type="checkbox" id="causal-falta-fundamentacion" name="otrasCausalesArbitrariedad" value="Falta de fundamentación suficiente" onclick="toggleFaltaFundamentacion(this); actualizarResumen()">
                                                    <label for="causal-falta-fundamentacion"><strong>Falta de fundamentación suficiente</strong></label>
                                                </div>
                                                <div id="faltaFundamentacionContainer" style="display: none; margin-left: 25px; margin-top: 8px;">
                                                    <div class="options-container" style="grid-template-columns: 1fr;">
                                                        <div class="checkbox-option" style="background: #f8f9fa;">
                                                            <input type="checkbox" id="fundamentacion-dogmatica" name="opcionesFundamentacion" value="Afirmaciones dogmáticas o no fundadas" onclick="actualizarResumen()">
                                                            <label for="fundamentacion-dogmatica">Afirmaciones dogmáticas o no fundadas</label>
                                                        </div>
                                                        <div class="checkbox-option" style="background: #f8f9fa;">
                                                            <input type="checkbox" id="fundamentacion-insuficiente" name="opcionesFundamentacion" value="Falta de fundamentación idónea o no suficiente" onclick="actualizarResumen()">
                                                            <label for="fundamentacion-insuficiente">Falta de fundamentación idónea o no suficiente</label>
                                                        </div>
                                                        <div class="checkbox-option" style="background: #f8f9fa;">
                                                            <input type="checkbox" id="fundamentacion-carencia" name="opcionesFundamentacion" value="Carencia de sustento o referencia concreta" onclick="actualizarResumen()">
                                                            <label for="fundamentacion-carencia">Carencia de sustento o referencia concreta</label>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            
                                            <!-- 3.1.c.2 Apartamiento -->
                                            <div style="margin-bottom: 10px;">
                                                <div class="checkbox-option" style="background: #f8f9fa;">
                                                    <input type="checkbox" id="causal-apartamiento" name="otrasCausalesArbitrariedad" value="Apartamiento de las condiciones de la causa" onclick="actualizarResumen()">
                                                    <label for="causal-apartamiento">Apartamiento de las condiciones de la causa</label>
                                                </div>
                                            </div>
                                            
                                            <!-- 3.1.c.3 Valoración -->
                                            <div style="margin-bottom: 10px;">
                                                <div class="checkbox-option" style="background: #f8f9fa;">
                                                    <input type="checkbox" id="causal-valoracion" name="otrasCausalesArbitrariedad" value="Valoración de las circunstancias de hecho y prueba" onclick="actualizarResumen()">
                                                    <label for="causal-valoracion">Valoración de las circunstancias de hecho y prueba</label>
                                                </div>
                                            </div>
                                            
                                            <!-- 3.1.c.4 Defectos extremos -->
                                            <div style="margin-bottom: 10px;">
                                                <div class="checkbox-option" style="background: #f8f9fa;">
                                                    <input type="checkbox" id="causal-defectos-extremos" name="otrasCausalesArbitrariedad" value="Defectos en la consideración de extremos conducentes" onclick="actualizarResumen()">
                                                    <label for="causal-defectos-extremos">Defectos en la consideración de extremos conducentes</label>
                                                </div>
                                            </div>
                                            
                                            <!-- 3.1.c.5 Defectos normativos -->
                                            <div style="margin-bottom: 15px;">
                                                <div class="checkbox-option" style="background: #f8f9fa;">
                                                    <input type="checkbox" id="causal-defectos-normativa" name="otrasCausalesArbitrariedad" value="Defectos en la fundamentación normativa" onclick="toggleDefectosNormativa(this); actualizarResumen()">
                                                    <label for="causal-defectos-normativa"><strong>Defectos en la fundamentación normativa</strong></label>
                                                </div>
                                                <div id="defectosNormativaContainer" style="display: none; margin-left: 25px; margin-top: 8px;">
                                                    <div class="options-container" style="grid-template-columns: 1fr;">
                                                        <div class="checkbox-option" style="background: #f8f9fa;">
                                                            <input type="checkbox" id="normativa-interpretacion-erronea" name="opcionesNormativa" value="Interpretación o aplicación errónea de la norma" onclick="actualizarResumen()">
                                                            <label for="normativa-interpretacion-erronea">Interpretación o aplicación errónea de la norma</label>
                                                        </div>
                                                        <div class="checkbox-option" style="background: #f8f9fa;">
                                                            <input type="checkbox" id="normativa-apartamiento" name="opcionesNormativa" value="Apartamiento u omisión normativa" onclick="actualizarResumen()">
                                                            <label for="normativa-apartamiento">Apartamiento u omisión normativa</label>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            
                                            <!-- 3.1.c.6 Excesos u omisiones -->
                                            <div style="margin-bottom: 10px;">
                                                <div class="checkbox-option" style="background: #f8f9fa;">
                                                    <input type="checkbox" id="causal-excesos-omisiones" name="otrasCausalesArbitrariedad" value="Excesos u omisiones en el pronunciamiento" onclick="actualizarResumen()">
                                                    <label for="causal-excesos-omisiones">Excesos u omisiones en el pronunciamiento</label>
                                                </div>
                                            </div>
                                            
                                            <!-- 3.1.c.7 Exceso ritual -->
                                            <div style="margin-bottom: 10px;">
                                                <div class="checkbox-option" style="background: #f8f9fa;">
                                                    <input type="checkbox" id="causal-exceso-ritual" name="otrasCausalesArbitrariedad" value="Exceso ritual manifiesto" onclick="actualizarResumen()">
                                                    <label for="causal-exceso-ritual">Exceso ritual manifiesto</label>
                                                </div>
                                            </div>
                                            
                                            <!-- 3.1.c.8 Contradicción -->
                                            <div style="margin-bottom: 5px;">
                                                <div class="checkbox-option" style="background: #f8f9fa;">
                                                    <input type="checkbox" id="causal-contradiccion" name="otrasCausalesArbitrariedad" value="Contradicción" onclick="actualizarResumen()">
                                                    <label for="causal-contradiccion">Contradicción</label>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- 3.2 OTROS... -->
                            <div style="margin-top: 20px; padding-top: 15px; border-top: 1px solid var(--border-color);">
                                <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 10px;">
                                    <i class="fas fa-box-open" style="color: var(--accent-color);"></i>
                                    <span style="font-weight: 600; color: var(--primary-color);">3.2 Otros...</span>
                                </div>
                                
                                <select id="otrosMotivosSelect" name="otrosMotivos" class="form-control" style="width: 100%;" onchange="toggleCustomOtroMotivo(this); actualizarResumen()">
                                    <option value="">-- Seleccione una opción --</option>
                                    <option value="Afectación de derechos garantizados por la Constitución">Afectación de derechos garantizados por la Constitución</option>
                                    <option value="Interpretación de tratados internacionales">Interpretación de tratados internacionales</option>
                                    <option value="Interpretación de leyes federales">Interpretación de leyes federales</option>
                                    <option value="Fuero penal económico">Fuero penal económico</option>
                                    <option value="otro">Otro motivo...</option>
                                </select>
                                
                                <div id="customOtroMotivoContainer" class="custom-input" style="display: none; margin-top: 10px;">
                                    <label for="customOtroMotivo">Especifique el motivo:</label>
                                    <input type="text" id="customOtroMotivo" name="customOtroMotivo" placeholder="Ingrese el motivo..." onchange="actualizarResumen()" onkeyup="actualizarResumen()">
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- SUBTEMA -->
                    <div class="form-group full-width">
                        <label for="subtemaTexto">Subtema:</label>
                        <input type="text" id="subtemaTexto" name="subtemaTexto" placeholder="Ingrese el subtema del caso" onchange="actualizarResumen()" onkeyup="actualizarResumen()">
                    </div>
                </div>
            </section>
            
            <!-- SECCIÓN 4: CUESTIÓN FEDERAL -->
            <section class="form-section">
                <h2 class="section-title"><i class="fas fa-landmark"></i> 4. Cuestión federal planteada</h2>
                <div class="form-grid">
                    <div class="form-group full-width">
                        <div class="option-group">
                            <div class="options-container" style="grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));">
                                <div class="checkbox-option">
                                    <input type="checkbox" id="cuestion-garantia-defensa" name="cuestionFederal" value="Garantía de defensa en juicio" onclick="actualizarResumen()">
                                    <label for="cuestion-garantia-defensa">Garantía de defensa en juicio</label>
                                </div>
                                <div class="checkbox-option">
                                    <input type="checkbox" id="cuestion-debido-proceso" name="cuestionFederal" value="Violación al debido proceso" onclick="actualizarResumen()">
                                    <label for="cuestion-debido-proceso">Violación al debido proceso</label>
                                </div>
                                <div class="checkbox-option">
                                    <input type="checkbox" id="cuestion-defensa-juicio" name="cuestionFederal" value="Defensa en juicio" onclick="actualizarResumen()">
                                    <label for="cuestion-defensa-juicio">Defensa en juicio</label>
                                </div>
                                <div class="checkbox-option">
                                    <input type="checkbox" id="cuestion-detencion-ilegal" name="cuestionFederal" value="Detención ilegal" onclick="actualizarResumen()">
                                    <label for="cuestion-detencion-ilegal">Detención ilegal</label>
                                </div>
                                <div class="checkbox-option">
                                    <input type="checkbox" id="cuestion-pena-inconstitucional" name="cuestionFederal" value="Aplicación de pena inconstitucional" onclick="actualizarResumen()">
                                    <label for="cuestion-pena-inconstitucional">Aplicación de pena inconstitucional</label>
                                </div>
                                <div class="checkbox-option">
                                    <input type="checkbox" id="cuestion-autoincriminacion" name="cuestionFederal" value="Prohibición de autoincriminación" onclick="actualizarResumen()">
                                    <label for="cuestion-autoincriminacion">Prohibición de autoincriminación</label>
                                </div>
                                <div class="checkbox-option">
                                    <input type="checkbox" id="cuestion-plazo-razonable" name="cuestionFederal" value="Violación al plazo razonable" onclick="actualizarResumen()">
                                    <label for="cuestion-plazo-razonable">Violación al plazo razonable</label>
                                </div>
                                <div class="checkbox-option">
                                    <input type="checkbox" id="cuestion-supremacia" name="cuestionFederal" value="Supremacía constitucional" onclick="actualizarResumen()">
                                    <label for="cuestion-supremacia">Supremacía constitucional</label>
                                </div>
                                <div class="checkbox-option">
                                    <input type="checkbox" id="cuestion-derechos-convencionales" name="cuestionFederal" value="Derechos convencionales" onclick="actualizarResumen()">
                                    <label for="cuestion-derechos-convencionales">Derechos convencionales</label>
                                </div>
                            </div>
                            
                            <div style="margin-top: 15px; border-top: 1px solid var(--border-color); padding-top: 15px;">
                                <div class="checkbox-option">
                                    <input type="checkbox" id="cuestion-otro" name="cuestionFederal" value="otro" onclick="toggleCustomCuestionFederal(this); actualizarResumen()">
                                    <label for="cuestion-otro"><strong>Otro...</strong></label>
                                </div>
                                <div id="customCuestionFederalContainer" class="custom-input" style="display: none;">
                                    <label for="customCuestionFederal">Especifique la cuestión federal:</label>
                                    <input type="text" id="customCuestionFederal" name="customCuestionFederal" placeholder="Ingrese la cuestión federal..." onchange="actualizarResumen()" onkeyup="actualizarResumen()">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
            
            <!-- SECCIÓN 5: TIPO DE DESACUERDO -->
            <section class="form-section">
                <h2 class="section-title"><i class="fas fa-exclamation-triangle"></i> 5. Tipo de desacuerdo</h2>
                <div class="form-grid">
                    <div class="form-group full-width">
                        <div class="option-group">
                            <div class="options-container">
                                <div class="checkbox-option">
                                    <input type="checkbox" id="desacuerdo-normativo" name="tipoDesacuerdo" value="Normativo" onclick="actualizarResumen()">
                                    <label for="desacuerdo-normativo">Normativo</label>
                                </div>
                                <div class="checkbox-option">
                                    <input type="checkbox" id="desacuerdo-factico" name="tipoDesacuerdo" value="Fáctico" onclick="actualizarResumen()">
                                    <label for="desacuerdo-factico">Fáctico</label>
                                </div>
                                <div class="checkbox-option">
                                    <input type="checkbox" id="desacuerdo-mixto" name="tipoDesacuerdo" value="Mixto" onclick="actualizarResumen()">
                                    <label for="desacuerdo-mixto">Mixto</label>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
            
            <!-- SECCIÓN 6: TIPO DE PROBLEMA JURÍDICO -->
            <section class="form-section">
                <h2 class="section-title"><i class="fas fa-question-circle"></i> 6. Tipo de problema jurídico</h2>
                <div class="form-grid">
                    <div class="form-group full-width">
                        <div class="option-group">
                            <div class="options-container">
                                <div class="checkbox-option">
                                    <input type="checkbox" id="problema-constitucionalidad" name="problemaJuridico" value="Constitucionalidad de norma" onclick="toggleProbatorio(false); actualizarResumen()">
                                    <label for="problema-constitucionalidad">Constitucionalidad de norma</label>
                                </div>
                                <div class="checkbox-option">
                                    <input type="checkbox" id="problema-interpretativo" name="problemaJuridico" value="Interpretativo" onclick="toggleProbatorio(false); actualizarResumen()">
                                    <label for="problema-interpretativo">Interpretativo</label>
                                </div>
                                <div class="checkbox-option">
                                    <input type="checkbox" id="problema-probatorio" name="problemaJuridico" value="Probatorio" onclick="toggleProbatorio(true); actualizarResumen()">
                                    <label for="problema-probatorio">Probatorio</label>
                                </div>
                            </div>
                        </div>
                        <div id="probatorioContainer" class="conditional-section">
                            <div class="sub-section">
                                <div class="sub-section-title"><i class="fas fa-clipboard-check"></i> i. Rol de la prueba en la decisión</div>
                                <div class="options-container">
                                    <div class="radio-option">
                                        <input type="radio" id="prueba-central" name="rolPrueba" value="Central" onclick="actualizarResumen()">
                                        <label for="prueba-central">Central</label>
                                    </div>
                                    <div class="radio-option">
                                        <input type="radio" id="prueba-secundario" name="rolPrueba" value="Secundario" onclick="actualizarResumen()">
                                        <label for="prueba-secundario">Secundario</label>
                                    </div>
                                    <div class="radio-option">
                                        <input type="radio" id="prueba-marginal" name="rolPrueba" value="Marginal" onclick="actualizarResumen()">
                                        <label for="prueba-marginal">Marginal</label>
                                    </div>
                                </div>
                            </div>
                            <div class="sub-section">
                                <div class="sub-section-title"><i class="fas fa-brain"></i> ii. Tipo de inferencias probatorias detectadas</div>
                                <div class="method-grid">
                                    <div class="checkbox-option">
                                        <input type="checkbox" id="inferencia-inductivas" name="tipoInferencias" value="Inductivas" onclick="actualizarResumen()">
                                        <label for="inferencia-inductivas">Inductivas</label>
                                    </div>
                                    <div class="checkbox-option">
                                        <input type="checkbox" id="inferencia-maximas" name="tipoInferencias" value="Máximas de experiencia" onclick="actualizarResumen()">
                                        <label for="inferencia-maximas">Máximas de experiencia</label>
                                    </div>
                                    <div class="checkbox-option">
                                        <input type="checkbox" id="inferencia-presunciones-legales" name="tipoInferencias" value="Presunciones legales" onclick="actualizarResumen()">
                                        <label for="inferencia-presunciones-legales">Presunciones legales</label>
                                    </div>
                                    <div class="checkbox-option">
                                        <input type="checkbox" id="inferencia-presunciones-judiciales" name="tipoInferencias" value="Presunciones judiciales" onclick="actualizarResumen()">
                                        <label for="inferencia-presunciones-judiciales">Presunciones judiciales</label>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
            
            <!-- SECCIÓN 7: MÉTODO INTERPRETATIVO -->
            <section class="form-section">
                <h2 class="section-title"><i class="fas fa-search"></i> 7. Método interpretativo utilizado</h2>
                <div class="form-grid">
                    <div class="form-group full-width">
                        <div class="method-grid">
                            <div class="checkbox-option"><input type="checkbox" id="metodo-literal" name="metodoInterpretativo" value="Literal" onclick="actualizarResumen()"><label>Literal</label></div>
                            <div class="checkbox-option"><input type="checkbox" id="metodo-sistematico" name="metodoInterpretativo" value="Sistemático" onclick="actualizarResumen()"><label>Sistemático</label></div>
                            <div class="checkbox-option"><input type="checkbox" id="metodo-teleologico" name="metodoInterpretativo" value="Teleológico" onclick="actualizarResumen()"><label>Teleológico</label></div>
                            <div class="checkbox-option"><input type="checkbox" id="metodo-historico" name="metodoInterpretativo" value="Histórico" onclick="actualizarResumen()"><label>Histórico</label></div>
                            <div class="checkbox-option"><input type="checkbox" id="metodo-principialista" name="metodoInterpretativo" value="Principialista" onclick="actualizarResumen()"><label>Principialista</label></div>
                            <div class="checkbox-option"><input type="checkbox" id="metodo-acontrario" name="metodoInterpretativo" value="A contrario" onclick="actualizarResumen()"><label>A contrario</label></div>
                            <div class="checkbox-option"><input type="checkbox" id="metodo-afortiori" name="metodoInterpretativo" value="A fortiori" onclick="actualizarResumen()"><label>A fortiori</label></div>
                            <div class="checkbox-option"><input type="checkbox" id="metodo-analogico" name="metodoInterpretativo" value="Analógico" onclick="actualizarResumen()"><label>Analógico</label></div>
                            <div class="checkbox-option"><input type="checkbox" id="metodo-reduccion" name="metodoInterpretativo" value="Reducción al absurdo" onclick="actualizarResumen()"><label>Reducción al absurdo</label></div>
                            <div class="checkbox-option"><input type="checkbox" id="metodo-coherencia" name="metodoInterpretativo" value="Coherencia del sistema" onclick="actualizarResumen()"><label>Coherencia del sistema</label></div>
                            <div class="checkbox-option"><input type="checkbox" id="metodo-unidad" name="metodoInterpretativo" value="Unidad de la Constitución" onclick="actualizarResumen()"><label>Unidad de la Constitución</label></div>
                        </div>
                    </div>
                </div>
            </section>
            
            <!-- SECCIÓN 8: ARGUMENTOS DE PONDERACIÓN (CORREGIDA) -->
            <section class="form-section">
                <h2 class="section-title"><i class="fas fa-weight-hanging"></i> 8. Argumentos de ponderación (Alexy/Maccormick)</h2>
                
                <!-- a. ¿Hay colisión de principios? -->
                <div style="margin-bottom: 20px;">
                    <div style="font-weight: 600; margin-bottom: 10px; color: var(--primary-color);">¿Hay colisión de principios?</div>
                    <div class="options-container" style="grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));">
                        <div class="radio-option">
                            <input type="radio" id="colision-no" name="colisionPrincipios" value="no" onclick="togglePrincipiosContainer(false); actualizarResumen()">
                            <label for="colision-no">No</label>
                        </div>
                        <div class="radio-option">
                            <input type="radio" id="colision-si" name="colisionPrincipios" value="si" onclick="togglePrincipiosContainer(true); actualizarResumen()">
                            <label for="colision-si">Sí</label>
                        </div>
                    </div>
                    
                    <!-- Subopciones que aparecen cuando selecciona SÍ -->
                    <div id="principiosContainer" style="display: none; margin-left: 25px; margin-top: 15px;">
                        <div style="font-style: italic; color: var(--gray-600); margin-bottom: 10px;">en caso de ser sí, entonces indicar:</div>
                        <div class="form-grid" style="grid-template-columns: 1fr 1fr;">
                            <div class="form-group">
                                <label for="principioA" class="required">Principio A:</label>
                                <select id="principioA" name="principioA" onchange="toggleCustomPrincipioA(this); actualizarResumen()">
                                    <option value="">Seleccione un principio</option>
                                    <option value="Autonomía de la voluntad">Autonomía de la voluntad</option>
                                    <option value="Buena fe">Buena fe</option>
                                    <option value="Igualdad">Igualdad</option>
                                    <option value="Libertad">Libertad</option>
                                    <option value="Seguridad jurídica">Seguridad jurídica</option>
                                    <option value="Proporcionalidad">Proporcionalidad</option>
                                    <option value="Razonabilidad">Razonabilidad</option>
                                    <option value="Legalidad">Legalidad</option>
                                    <option value="Dignidad humana">Dignidad humana</option>
                                    <option value="Debido proceso">Debido proceso</option>
                                    <option value="Defensa en juicio">Defensa en juicio</option>
                                    <option value="Publicidad">Publicidad</option>
                                    <option value="Economía procesal">Economía procesal</option>
                                    <option value="Celeridad">Celeridad</option>
                                    <option value="otro">Otro (especificar)</option>
                                </select>
                                <div id="customPrincipioAContainer" class="custom-input" style="display: none;">
                                    <label for="customPrincipioA">Especifique el principio:</label>
                                    <input type="text" id="customPrincipioA" name="customPrincipioA" placeholder="Ingrese el principio A..." onchange="actualizarResumen()" onkeyup="actualizarResumen()">
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="principioB" class="required">Principio B:</label>
                                <select id="principioB" name="principioB" onchange="toggleCustomPrincipioB(this); actualizarResumen()">
                                    <option value="">Seleccione un principio</option>
                                    <option value="Autonomía de la voluntad">Autonomía de la voluntad</option>
                                    <option value="Buena fe">Buena fe</option>
                                    <option value="Igualdad">Igualdad</option>
                                    <option value="Libertad">Libertad</option>
                                    <option value="Seguridad jurídica">Seguridad jurídica</option>
                                    <option value="Proporcionalidad">Proporcionalidad</option>
                                    <option value="Razonabilidad">Razonabilidad</option>
                                    <option value="Legalidad">Legalidad</option>
                                    <option value="Dignidad humana">Dignidad humana</option>
                                    <option value="Debido proceso">Debido proceso</option>
                                    <option value="Defensa en juicio">Defensa en juicio</option>
                                    <option value="Publicidad">Publicidad</option>
                                    <option value="Economía procesal">Economía procesal</option>
                                    <option value="Celeridad">Celeridad</option>
                                    <option value="otro">Otro (especificar)</option>
                                </select>
                                <div id="customPrincipioBContainer" class="custom-input" style="display: none;">
                                    <label for="customPrincipioB">Especifique el principio:</label>
                                    <input type="text" id="customPrincipioB" name="customPrincipioB" placeholder="Ingrese el principio B..." onchange="actualizarResumen()" onkeyup="actualizarResumen()">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- b. Estructura de la ponderación -->
                <div style="margin-bottom: 20px;">
                    <div style="font-weight: 600; margin-bottom: 10px; color: var(--primary-color);">Estructura de la ponderación</div>
                    <div class="options-container">
                        <div class="checkbox-option">
                            <input type="checkbox" id="ponderacion-idoneidad" name="estructuraPonderacion" value="Idoneidad" onclick="actualizarResumen()">
                            <label for="ponderacion-idoneidad">Idoneidad</label>
                        </div>
                        <div class="checkbox-option">
                            <input type="checkbox" id="ponderacion-necesidad" name="estructuraPonderacion" value="Necesidad" onclick="actualizarResumen()">
                            <label for="ponderacion-necesidad">Necesidad</label>
                        </div>
                        <div class="checkbox-option">
                            <input type="checkbox" id="ponderacion-proporcionalidad" name="estructuraPonderacion" value="Proporcionalidad estricta" onclick="actualizarResumen()">
                            <label for="ponderacion-proporcionalidad">Proporcionalidad estricta</label>
                        </div>
                        <div class="checkbox-option">
                            <input type="checkbox" id="ponderacion-formula" name="estructuraPonderacion" value="Fórmula del peso implícita" onclick="actualizarResumen()">
                            <label for="ponderacion-formula">Fórmula del peso implícita</label>
                        </div>
                    </div>
                </div>
                
                <!-- c. Tipo de razonamiento -->
                <div style="margin-bottom: 5px;">
                    <div style="font-weight: 600; margin-bottom: 10px; color: var(--primary-color);">Tipo de razonamiento</div>
                    <div class="options-container">
                        <div class="checkbox-option">
                            <input type="checkbox" id="razonamiento-balance-explicito" name="tipoRazonamiento" value="Balance explícito" onclick="actualizarResumen()">
                            <label for="razonamiento-balance-explicito">Balance explícito</label>
                        </div>
                        <div class="checkbox-option">
                            <input type="checkbox" id="razonamiento-balance-implicito" name="tipoRazonamiento" value="Balance implícito" onclick="actualizarResumen()">
                            <label for="razonamiento-balance-implicito">Balance implícito</label>
                        </div>
                        <div class="checkbox-option">
                            <input type="checkbox" id="razonamiento-retorico" name="tipoRazonamiento" value="Retórico (sin estructura real)" onclick="actualizarResumen()">
                            <label for="razonamiento-retorico">Retórico (sin estructura real)</label>
                        </div>
                    </div>
                </div>
            </section>
            
            <!-- SECCIÓN 9: ERRORES DEL RAZONAMIENTO -->
            <section class="form-section">
                <h2 class="section-title"><i class="fas fa-times-circle"></i> 9. Errores del razonamiento</h2>
                <div class="form-grid">
                    <div class="form-group full-width">
                        <!-- Falacias formales -->
                        <div style="margin-bottom: 15px;">
                            <div class="options-container">
                                <div class="checkbox-option"><input type="checkbox" id="error-afirmacion" name="erroresSilogismo" value="Afirmación del consecuente" onclick="actualizarResumen()"><label>Afirmación del consecuente</label></div>
                                <div class="checkbox-option"><input type="checkbox" id="error-negacion" name="erroresSilogismo" value="Negación del antecedente" onclick="actualizarResumen()"><label>Negación del antecedente</label></div>
                                <div class="checkbox-option"><input type="checkbox" id="error-silogismo" name="erroresSilogismo" value="Silogismo disyuntivo falaz" onclick="actualizarResumen()"><label>Silogismo disyuntivo falaz</label></div>
                            </div>
                        </div>
                        <!-- Argumentos de atinencia -->
                        <div style="margin-bottom: 15px;">
                            <div class="checkbox-option" style="background: #f8fafc;">
                                <input type="checkbox" id="atinencia-principal" name="argumentosAtinenciaPrincipal" onclick="toggleAtinencia(this); actualizarResumen()">
                                <label><strong>Argumentos de atinencia</strong></label>
                            </div>
                            <div id="atinenciaContainer" class="conditional-section" style="display: none; margin-left: 25px;">
                                <div class="method-grid">
                                    <div class="checkbox-option"><input type="checkbox" id="ad-baculum" name="argumentosAtinencia" value="Ad baculum" onclick="actualizarResumen()"><label>ad baculum</label></div>
                                    <div class="checkbox-option"><input type="checkbox" id="ad-hominem" name="argumentosAtinencia" value="Ad hominem" onclick="actualizarResumen()"><label>ad hominem</label></div>
                                    <div class="checkbox-option"><input type="checkbox" id="ad-ignorantiam" name="argumentosAtinencia" value="Ad ignorantiam" onclick="actualizarResumen()"><label>ad ignorantiam</label></div>
                                    <div class="checkbox-option"><input type="checkbox" id="ad-misericordiam" name="argumentosAtinencia" value="Ad misericordiam" onclick="actualizarResumen()"><label>ad misericordiam</label></div>
                                    <div class="checkbox-option"><input type="checkbox" id="ad-populum" name="argumentosAtinencia" value="Ad populum" onclick="actualizarResumen()"><label>ad populum</label></div>
                                    <div class="checkbox-option"><input type="checkbox" id="ad-verecundiam" name="argumentosAtinencia" value="Ad verecundiam" onclick="actualizarResumen()"><label>ad verecundiam</label></div>
                                    <div class="checkbox-option"><input type="checkbox" id="de-accidente" name="argumentosAtinencia" value="De accidente" onclick="actualizarResumen()"><label>de accidente</label></div>
                                    <div class="checkbox-option"><input type="checkbox" id="accidente-inverso" name="argumentosAtinencia" value="Del accidente inverso" onclick="actualizarResumen()"><label>Del accidente inverso</label></div>
                                    <div class="checkbox-option"><input type="checkbox" id="causa-falsa" name="argumentosAtinencia" value="Causa falsa" onclick="actualizarResumen()"><label>Causa falsa</label></div>
                                    <div class="checkbox-option"><input type="checkbox" id="petitio" name="argumentosAtinencia" value="Petitio principii" onclick="actualizarResumen()"><label>Petitio principii</label></div>
                                    <div class="checkbox-option"><input type="checkbox" id="pregunta-compleja" name="argumentosAtinencia" value="Pregunta compleja" onclick="actualizarResumen()"><label>Pregunta compleja</label></div>
                                    <div class="checkbox-option"><input type="checkbox" id="ignoratio" name="argumentosAtinencia" value="Ignoratio elenchi" onclick="actualizarResumen()"><label>Ignoratio elenchi</label></div>
                                </div>
                            </div>
                        </div>
                        <!-- Argumentos de ambigüedad -->
                        <div>
                            <div class="checkbox-option" style="background: #f8fafc;">
                                <input type="checkbox" id="ambiguedad-principal" name="argumentosAmbiguedadPrincipal" onclick="toggleAmbiguedad(this); actualizarResumen()">
                                <label><strong>Argumentos de ambigüedad</strong></label>
                            </div>
                            <div id="ambiguedadContainer" class="conditional-section" style="display: none; margin-left: 25px;">
                                <div class="method-grid">
                                    <div class="checkbox-option"><input type="checkbox" id="equivoco" name="argumentosAmbiguedad" value="Equívoco" onclick="actualizarResumen()"><label>Equívoco</label></div>
                                    <div class="checkbox-option"><input type="checkbox" id="anfibologia" name="argumentosAmbiguedad" value="Anfibología" onclick="actualizarResumen()"><label>Anfibología</label></div>
                                    <div class="checkbox-option"><input type="checkbox" id="enfasis" name="argumentosAmbiguedad" value="Énfasis" onclick="actualizarResumen()"><label>Énfasis</label></div>
                                    <div class="checkbox-option"><input type="checkbox" id="composicion" name="argumentosAmbiguedad" value="Composición" onclick="actualizarResumen()"><label>Composición</label></div>
                                    <div class="checkbox-option"><input type="checkbox" id="division" name="argumentosAmbiguedad" value="División" onclick="actualizarResumen()"><label>División</label></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
            
            <!-- SECCIÓN 10: OBSERVACIONES ADICIONALES -->
            <section class="form-section">
                <h2 class="section-title"><i class="fas fa-sticky-note"></i> 10. Observaciones adicionales</h2>
                <div class="form-grid">
                    <div class="form-group full-width">
                        <textarea id="observaciones" name="observaciones" placeholder="Notas, comentarios u observaciones relevantes..." rows="4" onchange="actualizarResumen()" onkeyup="actualizarResumen()"></textarea>
                    </div>
                </div>
            </section>
            
            <!-- BOTONES -->
            <div class="buttons-container">
                <button type="button" class="btn btn-submit" onclick="guardarFallo()">
                    <i class="fas fa-save"></i> Guardar Fallo
                </button>
                <button type="button" class="btn btn-reset" onclick="resetForm()">
                    <i class="fas fa-redo"></i> Limpiar Formulario
                </button>
            </div>
        </form>
        
        <footer class="footer">
            <p>Instituto de Recursos Judiciales &copy; <span id="current-year"></span> | Análisis Jurisprudencial Penal</p>
        </footer>
    </div>

    <script>
        // ============ FUNCIÓN PRINCIPAL DE ACTUALIZACIÓN ============
        function actualizarResumen() {
            const resumenContenido = document.getElementById('resumenContenido');
            const resumenBadge = document.getElementById('resumenBadge');
            const resumenFooter = document.getElementById('resumenFooter');
            const resumenRedactado = document.getElementById('resumenRedactado');
            const resumenRedactadoContenido = document.getElementById('resumenRedactadoContenido');
            
            const datos = recopilarDatosResumen();
            
            // Contar secciones completadas
            let contador = 0;
            if (datos.caratula) contador++;
            if (datos.integracion) contador++;
            if (datos.materias.length > 0) contador++;
            if (datos.cuestionesFederales.length > 0) contador++;
            if (datos.arbitrariedadCausales.length > 0) contador++;
            if (datos.erroresSilogismo.length > 0 || datos.argumentosAtinencia.length > 0 || datos.argumentosAmbiguedad.length > 0) contador++;
            
            resumenBadge.textContent = contador > 0 ? `${contador} secciones` : 'Sin datos';
            
            // Si no hay datos
            if (!datos.caratula && datos.materias.length === 0 && datos.cuestionesFederales.length === 0) {
                resumenContenido.innerHTML = '<span class="resumen-vacio">Complete el formulario para ver el resumen del fallo...</span>';
                resumenRedactado.style.display = 'none';
                resumenFooter.innerHTML = '';
                return;
            }
            
            // Mostrar el bloque de resumen redactado
            resumenRedactado.style.display = 'block';
            
            // Determinar voto
            let votoTexto = datos.voto === 'unanimidad' ? 'Unanimidad' : datos.voto === 'mayoria' ? 'Mayoría' : datos.voto === 'disidencias' ? 'Con disidencias' : '';
            let votoColor = datos.voto === 'unanimidad' ? '#27ae60' : datos.voto === 'mayoria' ? '#f39c12' : datos.voto === 'disidencias' ? '#e74c3c' : '#718096';
            
            // ===== GENERAR HTML PARA DOS COLUMNAS =====
            let columnaIzquierda = '';
            let columnaDerecha = '';
            
            // --- COLUMNA IZQUIERDA ---
            
            // 1. TRIBUNAL
            if (datos.integracion || datos.voto) {
                columnaIzquierda += `<div class="resumen-seccion">
                    <div class="resumen-seccion-titulo">
                        <i class="fas fa-users"></i> COMPOSICIÓN DEL TRIBUNAL
                    </div>`;
                
                if (datos.integracion) {
                    columnaIzquierda += `<div class="resumen-item">
                        <div class="resumen-icono"><i class="fas fa-user-tie"></i></div>
                        <div class="resumen-label">INTEGRACIÓN:</div>
                        <div class="resumen-valor">${datos.integracion}</div>
                    </div>`;
                }
                
                if (votoTexto) {
                    columnaIzquierda += `<div class="resumen-item">
                        <div class="resumen-icono"><i class="fas fa-check-circle" style="color: ${votoColor};"></i></div>
                        <div class="resumen-label">VOTO:</div>
                        <div class="resumen-valor" style="color: ${votoColor}; font-weight: 600;">${votoTexto}</div>
                    </div>`;
                }
                
                if (datos.detalleDisidencias) {
                    columnaIzquierda += `<div class="resumen-item">
                        <div class="resumen-icono"><i class="fas fa-comment-dots"></i></div>
                        <div class="resumen-label">DISIDENCIAS:</div>
                        <div class="resumen-valor">${datos.detalleDisidencias.substring(0, 80)}${datos.detalleDisidencias.length > 80 ? '...' : ''}</div>
                    </div>`;
                }
                
                columnaIzquierda += `</div>`;
            }
            
            // 2. MATERIA PRINCIPAL
            if (datos.materias.length > 0) {
                columnaIzquierda += `<div class="resumen-seccion">
                    <div class="resumen-seccion-titulo">
                        <i class="fas fa-balance-scale"></i> MATERIA PRINCIPAL
                    </div>
                    <div class="resumen-item">
                        <div class="resumen-icono"><i class="fas fa-tag"></i></div>
                        <div class="resumen-label">MATERIA${datos.materias.length > 1 ? 'S' : ''}:</div>
                        <div class="resumen-valor">`;
                datos.materias.forEach(m => columnaIzquierda += `<span class="resumen-chip">${m}</span>`);
                columnaIzquierda += `</div></div>`;
                
                if (datos.subtema) {
                    columnaIzquierda += `<div class="resumen-item">
                        <div class="resumen-icono"><i class="fas fa-tags"></i></div>
                        <div class="resumen-label">SUBTEMA:</div>
                        <div class="resumen-valor"><strong>${datos.subtema}</strong></div>
                    </div>`;
                }
                
                columnaIzquierda += `</div>`;
            }
            
            // 3. CUESTIÓN FEDERAL
            if (datos.cuestionesFederales.length > 0) {
                columnaIzquierda += `<div class="resumen-seccion">
                    <div class="resumen-seccion-titulo">
                        <i class="fas fa-landmark"></i> CUESTIÓN FEDERAL
                    </div>
                    <div class="resumen-item">
                        <div class="resumen-icono"><i class="fas fa-check-square"></i></div>
                        <div class="resumen-label">SELECCIONADAS:</div>
                        <div class="resumen-valor">`;
                datos.cuestionesFederales.slice(0, 4).forEach(c => columnaIzquierda += `<span class="resumen-chip">${c}</span>`);
                if (datos.cuestionesFederales.length > 4) columnaIzquierda += `<span class="resumen-chip">+${datos.cuestionesFederales.length - 4}</span>`;
                columnaIzquierda += `</div></div></div>`;
            }
            
            // 4. DESACUERDO Y PROBLEMA
            if (datos.desacuerdos.length > 0 || datos.problemas.length > 0 || datos.rolPrueba) {
                columnaIzquierda += `<div class="resumen-seccion">
                    <div class="resumen-seccion-titulo">
                        <i class="fas fa-exclamation-triangle"></i> DESACUERDO Y PROBLEMA
                    </div>`;
                
                if (datos.desacuerdos.length > 0) {
                    columnaIzquierda += `<div class="resumen-item">
                        <div class="resumen-icono"><i class="fas fa-exchange-alt"></i></div>
                        <div class="resumen-label">DESACUERDO:</div>
                        <div class="resumen-valor">${datos.desacuerdos.join(' · ')}</div>
                    </div>`;
                }
                
                if (datos.problemas.length > 0) {
                    columnaIzquierda += `<div class="resumen-item">
                        <div class="resumen-icono"><i class="fas fa-question-circle"></i></div>
                        <div class="resumen-label">PROBLEMA:</div>
                        <div class="resumen-valor">${datos.problemas.join(' · ')}</div>
                    </div>`;
                }
                
                if (datos.rolPrueba) {
                    let rolColor = datos.rolPrueba === 'Central' ? '#e74c3c' : datos.rolPrueba === 'Secundario' ? '#f39c12' : '#27ae60';
                    columnaIzquierda += `<div class="resumen-item">
                        <div class="resumen-icono"><i class="fas fa-clipboard-check"></i></div>
                        <div class="resumen-label">ROL PRUEBA:</div>
                        <div class="resumen-valor"><span style="color: ${rolColor}; font-weight: 600;">${datos.rolPrueba}</span></div>
                    </div>`;
                }
                
                columnaIzquierda += `</div>`;
            }
            
            // --- COLUMNA DERECHA ---
            
            // 5. MÉTODO INTERPRETATIVO
            if (datos.metodoInterpretativo.length > 0) {
                columnaDerecha += `<div class="resumen-seccion">
                    <div class="resumen-seccion-titulo">
                        <i class="fas fa-search"></i> MÉTODO INTERPRETATIVO
                    </div>
                    <div class="resumen-item">
                        <div class="resumen-icono"><i class="fas fa-magnifying-glass"></i></div>
                        <div class="resumen-label">MÉTODOS:</div>
                        <div class="resumen-valor">${datos.metodoInterpretativo.slice(0, 4).join(' · ')}${datos.metodoInterpretativo.length > 4 ? ` <span style="color: var(--accent-color);">(+${datos.metodoInterpretativo.length - 4})</span>` : ''}</div>
                    </div>
                </div>`;
            }
            
            // 6. PONDERACIÓN (colisión de principios)
            if (datos.colisionPrincipios === 'si' && datos.principioA && datos.principioB) {
                columnaDerecha += `<div class="resumen-seccion">
                    <div class="resumen-seccion-titulo">
                        <i class="fas fa-scale-balanced"></i> COLISIÓN DE PRINCIPIOS
                    </div>
                    <div class="resumen-item">
                        <div class="resumen-icono"><i class="fas fa-gavel"></i></div>
                        <div class="resumen-label">PRINCIPIOS:</div>
                        <div class="resumen-valor">
                            <span style="background: #e8f0fe; padding: 3px 10px; border-radius: 20px;">${datos.principioA}</span>
                            <span style="margin: 0 8px; color: var(--danger-color); font-weight: 600;">VS</span>
                            <span style="background: #e8f0fe; padding: 3px 10px; border-radius: 20px;">${datos.principioB}</span>
                        </div>
                    </div>
                </div>`;
            }
            
            // 7. ESTRUCTURA DE PONDERACIÓN
            if (datos.estructuraPonderacion && datos.estructuraPonderacion.length > 0) {
                columnaDerecha += `<div class="resumen-seccion">
                    <div class="resumen-seccion-titulo">
                        <i class="fas fa-layer-group"></i> ESTRUCTURA DE PONDERACIÓN
                    </div>
                    <div class="resumen-item">
                        <div class="resumen-icono"><i class="fas fa-list-check"></i></div>
                        <div class="resumen-label">APLICADAS:</div>
                        <div class="resumen-valor">${datos.estructuraPonderacion.join(' · ')}</div>
                    </div>
                </div>`;
            }
            
            // 8. TIPO DE RAZONAMIENTO
            if (datos.tipoRazonamiento && datos.tipoRazonamiento.length > 0) {
                columnaDerecha += `<div class="resumen-seccion">
                    <div class="resumen-seccion-titulo">
                        <i class="fas fa-brain"></i> TIPO DE RAZONAMIENTO
                    </div>
                    <div class="resumen-item">
                        <div class="resumen-icono"><i class="fas fa-code-branch"></i></div>
                        <div class="resumen-label">RAZONAMIENTO:</div>
                        <div class="resumen-valor">${datos.tipoRazonamiento.join(' · ')}</div>
                    </div>
                </div>`;
            }
            
            // 9. ERRORES DEL RAZONAMIENTO
            if (datos.erroresSilogismo.length > 0 || datos.argumentosAtinencia.length > 0 || datos.argumentosAmbiguedad.length > 0) {
                let total = datos.erroresSilogismo.length + datos.argumentosAtinencia.length + datos.argumentosAmbiguedad.length;
                columnaDerecha += `<div class="resumen-seccion">
                    <div class="resumen-seccion-titulo">
                        <i class="fas fa-times-circle"></i> ERRORES DEL RAZONAMIENTO
                        <span style="background: #e74c3c20; color: var(--danger-color); padding: 3px 10px; border-radius: 30px; font-size: 0.7rem; margin-left: 8px;">${total}</span>
                    </div>`;
                
                if (datos.erroresSilogismo.length > 0) {
                    columnaDerecha += `<div class="resumen-item">
                        <div class="resumen-icono"><i class="fas fa-sitemap"></i></div>
                        <div class="resumen-label">FORMALES:</div>
                        <div class="resumen-valor">${datos.erroresSilogismo.length}</div>
                    </div>`;
                }
                
                if (datos.argumentosAtinencia.length > 0) {
                    columnaDerecha += `<div class="resumen-item">
                        <div class="resumen-icono"><i class="fas fa-comment"></i></div>
                        <div class="resumen-label">ATINENCIA:</div>
                        <div class="resumen-valor">${datos.argumentosAtinencia.length}</div>
                    </div>`;
                }
                
                if (datos.argumentosAmbiguedad.length > 0) {
                    columnaDerecha += `<div class="resumen-item">
                        <div class="resumen-icono"><i class="fas fa-language"></i></div>
                        <div class="resumen-label">AMBIGÜEDAD:</div>
                        <div class="resumen-valor">${datos.argumentosAmbiguedad.length}</div>
                    </div>`;
                }
                
                columnaDerecha += `</div>`;
            }
            
            // 10. ARBITRARIEDAD
            if (datos.arbitrariedadCausales.length > 0) {
                columnaDerecha += `<div class="resumen-seccion">
                    <div class="resumen-seccion-titulo">
                        <i class="fas fa-gavel"></i> CAUSALES DE ARBITRARIEDAD
                        <span style="background: #3498db20; color: var(--accent-color); padding: 3px 10px; border-radius: 30px; font-size: 0.7rem; margin-left: 8px;">${datos.arbitrariedadCausales.length}</span>
                    </div>
                    <div class="resumen-item">
                        <div class="resumen-icono"><i class="fas fa-list-check"></i></div>
                        <div class="resumen-label">CAUSALES:</div>
                        <div class="resumen-valor">`;
                datos.arbitrariedadCausales.slice(0, 4).forEach(c => columnaDerecha += `<span class="resumen-chip">${c}</span>`);
                if (datos.arbitrariedadCausales.length > 4) columnaDerecha += `<span class="resumen-chip">+${datos.arbitrariedadCausales.length - 4}</span>`;
                columnaDerecha += `</div></div></div>`;
            }
            
            // 11. OBSERVACIONES
            if (datos.observaciones) {
                columnaDerecha += `<div class="resumen-seccion">
                    <div class="resumen-seccion-titulo">
                        <i class="fas fa-sticky-note"></i> OBSERVACIONES
                    </div>
                    <div class="resumen-item">
                        <div class="resumen-icono"><i class="fas fa-quote-left"></i></div>
                        <div class="resumen-label">NOTAS:</div>
                        <div class="resumen-valor"><em>${datos.observaciones.substring(0, 100)}${datos.observaciones.length > 100 ? '...' : ''}</em></div>
                    </div>
                </div>`;
            }
            
            // ARMAR EL HTML COMPLETO CON DOS COLUMNAS
            let html = `
                <div class="resumen-encabezado">
                    <div class="resumen-encabezado-icono">
                        <i class="fas fa-gavel"></i>
                    </div>
                    <div class="resumen-encabezado-contenido">
                        <div class="resumen-encabezado-titulo">
                            ${datos.caratula || 'FALLO SIN CARÁTULA'}
                        </div>
                        <div class="resumen-encabezado-detalle">
                            <span><i class="fas fa-bookmark"></i> ${datos.fallos || 'Sin tomo/página'}</span>
                            <span><i class="fas fa-calendar-alt"></i> ${datos.fecha || 'Sin fecha'}</span>
                        </div>
                    </div>
                    <div class="resumen-encabezado-badge">
                        <i class="fas fa-balance-scale"></i> Análisis crítico
                    </div>
                </div>
                
                <div class="resumen-columnas">
                    <div class="resumen-columna">
                        ${columnaIzquierda}
                    </div>
                    <div class="resumen-columna">
                        ${columnaDerecha}
                    </div>
                </div>
            `;
            
            resumenContenido.innerHTML = html;
            
            // ===== GENERAR RESUMEN REDACTADO (NARRATIVO) =====
            let redactado = '';
            
            // Párrafo 1: Identificación y Tribunal
            redactado += `<p><strong>Identificación del fallo:</strong> `;
            redactado += `${datos.caratula || 'Fallo sin carátula'}`;
            if (datos.fallos) redactado += `, publicado en ${datos.fallos}`;
            if (datos.fecha) redactado += `, con fecha ${datos.fecha}`;
            redactado += `. `;
            
            if (datos.integracion) {
                redactado += `El tribunal estuvo integrado por ${datos.integracion}. `;
            }
            
            if (votoTexto) {
                redactado += `La decisión fue adoptada por <strong>${votoTexto}</strong>`;
                if (datos.detalleDisidencias) {
                    redactado += `, con disidencias de ${datos.detalleDisidencias}`;
                }
                redactado += `. `;
            }
            redactado += `</p>`;
            
            // Párrafo 2: Materia y Cuestión Federal
            redactado += `<p><strong>Materia y cuestión federal:</strong> `;
            if (datos.materias.length > 0) {
                redactado += `La materia principal del caso es ${datos.materias.join(', ')}`;
                if (datos.subtema) redactado += `, en particular sobre ${datos.subtema}`;
                redactado += `. `;
            }
            
            if (datos.cuestionesFederales.length > 0) {
                redactado += `Se plantea${datos.cuestionesFederales.length > 1 ? 'n' : ''} cuestión${datos.cuestionesFederales.length > 1 ? 'es' : ''} federal consistente en `;
                redactado += datos.cuestionesFederales.join(', ') + '. ';
            }
            redactado += `</p>`;
            
            // Párrafo 3: Análisis del razonamiento
            redactado += `<p><strong>Análisis del razonamiento:</strong> `;
            if (datos.desacuerdos.length > 0) {
                redactado += `Se advierte un desacuerdo de tipo ${datos.desacuerdos.join(' y ')}. `;
            }
            if (datos.problemas.length > 0) {
                redactado += `El problema jurídico es de carácter ${datos.problemas.join(' y ')}. `;
            }
            if (datos.rolPrueba) {
                redactado += `La prueba cumple un rol <strong>${datos.rolPrueba.toLowerCase()}</strong> en la decisión. `;
            }
            if (datos.metodoInterpretativo.length > 0) {
                redactado += `Se utiliza${datos.metodoInterpretativo.length > 1 ? 'n' : ''} método${datos.metodoInterpretativo.length > 1 ? 's' : ''} interpretativo${datos.metodoInterpretativo.length > 1 ? 's' : ''} como `;
                redactado += datos.metodoInterpretativo.join(', ') + '. ';
            }
            if (datos.colisionPrincipios === 'si' && datos.principioA && datos.principioB) {
                redactado += `Se verifica una colisión entre el principio de ${datos.principioA} y el principio de ${datos.principioB}. `;
            }
            if (datos.estructuraPonderacion && datos.estructuraPonderacion.length > 0) {
                redactado += `La ponderación utiliza: ${datos.estructuraPonderacion.join(', ')}. `;
            }
            if (datos.tipoRazonamiento && datos.tipoRazonamiento.length > 0) {
                redactado += `El razonamiento es de tipo: ${datos.tipoRazonamiento.join(', ')}. `;
            }
            redactado += `</p>`;
            
            // Párrafo 4: Arbitrariedad
            if (datos.arbitrariedadCausales.length > 0) {
                redactado += `<p><strong>Arbitrariedad:</strong> `;
                redactado += `Se configura${datos.arbitrariedadCausales.length > 1 ? 'n' : ''} ${datos.arbitrariedadCausales.length} causal${datos.arbitrariedadCausales.length !== 1 ? 'es' : ''} de arbitrariedad: `;
                redactado += datos.arbitrariedadCausales.join(', ') + '. ';
                
                if (datos.opcionesFundamentacion.length > 0) {
                    redactado += ` En particular, la falta de fundamentación se manifiesta en: ${datos.opcionesFundamentacion.join(', ')}. `;
                }
                if (datos.opcionesNormativa.length > 0) {
                    redactado += ` Los defectos normativos consisten en: ${datos.opcionesNormativa.join(', ')}. `;
                }
                if (datos.arbitrariedadFactica.length > 0) {
                    redactado += ` La arbitrariedad fáctica es de tipo: ${datos.arbitrariedadFactica.join(', ')}. `;
                }
                redactado += `</p>`;
            }
            
            // Párrafo 5: Errores del razonamiento
            if (datos.erroresSilogismo.length > 0 || datos.argumentosAtinencia.length > 0 || datos.argumentosAmbiguedad.length > 0) {
                let totalErrores = datos.erroresSilogismo.length + datos.argumentosAtinencia.length + datos.argumentosAmbiguedad.length;
                redactado += `<p><strong>Errores del razonamiento:</strong> `;
                redactado += `Se detectaron <strong>${totalErrores} error${totalErrores !== 1 ? 'es' : ''}</strong> en el razonamiento`;
                let erroresDetalle = [];
                if (datos.erroresSilogismo.length > 0) erroresDetalle.push(`${datos.erroresSilogismo.length} falacia${datos.erroresSilogismo.length !== 1 ? 's' : ''} formal${datos.erroresSilogismo.length !== 1 ? 'es' : ''}`);
                if (datos.argumentosAtinencia.length > 0) erroresDetalle.push(`${datos.argumentosAtinencia.length} argumento${datos.argumentosAtinencia.length !== 1 ? 's' : ''} de atinencia`);
                if (datos.argumentosAmbiguedad.length > 0) erroresDetalle.push(`${datos.argumentosAmbiguedad.length} argumento${datos.argumentosAmbiguedad.length !== 1 ? 's' : ''} de ambigüedad`);
                if (erroresDetalle.length > 0) {
                    redactado += ` (${erroresDetalle.join(', ')}). `;
                }
                redactado += `</p>`;
            }
            
            // Párrafo 6: Observaciones
            if (datos.observaciones) {
                redactado += `<p><strong>Observaciones:</strong> ${datos.observaciones}</p>`;
            }
            
            resumenRedactadoContenido.innerHTML = redactado;
            resumenFooter.innerHTML = `
                <div class="resumen-footer-left">
                    <i class="fas fa-clock"></i> Actualizado: ${new Date().toLocaleTimeString('es-AR')}
                    <span><i class="fas fa-university"></i> Instituto de Recursos Judiciales</span>
                </div>
                <div class="resumen-footer-right">
                    <i class="fas fa-file-signature"></i> Análisis en tiempo real
                </div>
            `;
        }

        // ============ RECOPILACIÓN DE DATOS ============
        function recopilarDatosResumen() {
            const datos = {
                caratula: document.getElementById('caratula').value || '',
                fallos: document.getElementById('fallos').value || '',
                fecha: document.getElementById('fecha').value ? new Date(document.getElementById('fecha').value).toLocaleDateString('es-AR') : '',
                integracion: document.getElementById('integracion').value || '',
                voto: document.querySelector('input[name="voto"]:checked')?.value || '',
                detalleDisidencias: document.getElementById('detalleDisidencias')?.value || '',
                materias: [],
                subtema: document.getElementById('subtemaTexto')?.value || '',
                cuestionesFederales: [],
                desacuerdos: [],
                problemas: [],
                rolPrueba: document.querySelector('input[name="rolPrueba"]:checked')?.value || '',
                metodoInterpretativo: [],
                colisionPrincipios: document.querySelector('input[name="colisionPrincipios"]:checked')?.value || '',
                principioA: '',
                principioB: '',
                estructuraPonderacion: [],
                tipoRazonamiento: [],
                erroresSilogismo: [],
                argumentosAtinencia: [],
                argumentosAmbiguedad: [],
                arbitrariedadCausales: [],
                opcionesFundamentacion: [],
                opcionesNormativa: [],
                arbitrariedadFactica: [],
                observaciones: document.getElementById('observaciones').value || ''
            };

            // ESTRUCTURA DE PONDERACIÓN
            document.querySelectorAll('input[name="estructuraPonderacion"]:checked').forEach(cb => {
                datos.estructuraPonderacion.push(cb.nextElementSibling.textContent.trim().replace(/^☐\s*/, ''));
            });

            // TIPO DE RAZONAMIENTO
            document.querySelectorAll('input[name="tipoRazonamiento"]:checked').forEach(cb => {
                datos.tipoRazonamiento.push(cb.nextElementSibling.textContent.trim().replace(/^☐\s*/, ''));
            });

            // ARBITRARIEDAD
            if (document.getElementById('materia-arbitrariedad')?.checked) {
                datos.materias.push('Arbitrariedad');
                
                if (document.getElementById('arbitrariedad-normativa')?.checked) {
                    datos.arbitrariedadCausales.push('Arbitrariedad normativa');
                }
                
                if (document.getElementById('arbitrariedad-factica')?.checked) {
                    datos.arbitrariedadCausales.push('Arbitrariedad fáctica');
                    document.querySelectorAll('input[name="arbitrariedadFactica"]:checked').forEach(cb => {
                        datos.arbitrariedadFactica.push(cb.value);
                    });
                }
                
                if (document.getElementById('arbitrariedad-otras-causales')?.checked) {
                    document.querySelectorAll('input[name="otrasCausalesArbitrariedad"]:checked').forEach(cb => {
                        let valor = cb.value;
                        datos.arbitrariedadCausales.push(valor);
                        
                        if (cb.id === 'causal-falta-fundamentacion' && cb.checked) {
                            document.querySelectorAll('#faltaFundamentacionContainer input[type="checkbox"]:checked').forEach(sub => {
                                let texto = sub.nextElementSibling.textContent.trim().replace(/^[\d\.\s]+/g, '').trim();
                                datos.opcionesFundamentacion.push(texto);
                            });
                        }
                        
                        if (cb.id === 'causal-defectos-normativa' && cb.checked) {
                            document.querySelectorAll('#defectosNormativaContainer input[type="checkbox"]:checked').forEach(sub => {
                                let texto = sub.nextElementSibling.textContent.trim().replace(/^[\d\.\s]+/g, '').trim();
                                datos.opcionesNormativa.push(texto);
                            });
                        }
                    });
                }
            }

            // OTROS MOTIVOS
            let otrosMotivosSelect = document.getElementById('otrosMotivosSelect');
            if (otrosMotivosSelect.value && otrosMotivosSelect.value !== 'otro') {
                let texto = otrosMotivosSelect.options[otrosMotivosSelect.selectedIndex]?.text;
                texto = texto.replace(/^[\d\.\s]+/, '').trim();
                datos.materias.push(texto);
            } else if (otrosMotivosSelect.value === 'otro') {
                let custom = document.getElementById('customOtroMotivo')?.value;
                if (custom) datos.materias.push(custom);
            }

            // CUESTIONES FEDERALES
            document.querySelectorAll('input[name="cuestionFederal"]:checked').forEach(cb => {
                if (cb.value === 'otro') {
                    let c = document.getElementById('customCuestionFederal')?.value;
                    if (c) datos.cuestionesFederales.push(c);
                } else {
                    datos.cuestionesFederales.push(cb.value);
                }
            });

            // DESACUERDOS
            document.querySelectorAll('input[name="tipoDesacuerdo"]:checked').forEach(cb => {
                datos.desacuerdos.push(cb.nextElementSibling.textContent.trim());
            });

            // PROBLEMAS
            document.querySelectorAll('input[name="problemaJuridico"]:checked').forEach(cb => {
                datos.problemas.push(cb.nextElementSibling.textContent.trim());
            });

            // MÉTODO INTERPRETATIVO
            document.querySelectorAll('input[name="metodoInterpretativo"]:checked').forEach(cb => {
                datos.metodoInterpretativo.push(cb.nextElementSibling.textContent.trim());
            });

            // PRINCIPIOS
            if (document.getElementById('colision-si')?.checked) {
                datos.principioA = obtenerValorConPersonalizado('principioA', 'customPrincipioA');
                datos.principioB = obtenerValorConPersonalizado('principioB', 'customPrincipioB');
            }

            // ERRORES
            document.querySelectorAll('input[name="erroresSilogismo"]:checked').forEach(cb => {
                datos.erroresSilogismo.push(cb.nextElementSibling.textContent.trim());
            });
            if (document.getElementById('atinencia-principal')?.checked) {
                document.querySelectorAll('#atinenciaContainer input[type="checkbox"]:checked').forEach(cb => {
                    datos.argumentosAtinencia.push(cb.nextElementSibling.textContent.trim());
                });
            }
            if (document.getElementById('ambiguedad-principal')?.checked) {
                document.querySelectorAll('#ambiguedadContainer input[type="checkbox"]:checked').forEach(cb => {
                    datos.argumentosAmbiguedad.push(cb.nextElementSibling.textContent.trim());
                });
            }

            return datos;
        }

        // ============ FUNCIONES AUXILIARES ============
        function obtenerValorConPersonalizado(selectId, customInputId) {
            let s = document.getElementById(selectId);
            if (!s) return '';
            if (s.value === 'otro') { 
                let c = document.getElementById(customInputId); 
                return c ? c.value : ''; 
            }
            return s.options[s.selectedIndex]?.text || '';
        }

        // ============ TOGGLES ============
        function toggleArbitrariedadGeneral(cb) {
            let c = document.getElementById('arbitrariedadGeneralContainer');
            if (cb.checked) c.style.display = 'block';
            else { 
                c.style.display = 'none'; 
                c.querySelectorAll('input[type="checkbox"]').forEach(cb => cb.checked = false);
                document.getElementById('arbitrariedadFacticaContainer').style.display = 'none';
                document.getElementById('otrasCausalesContainer').style.display = 'none';
                document.getElementById('faltaFundamentacionContainer').style.display = 'none';
                document.getElementById('defectosNormativaContainer').style.display = 'none';
            }
            actualizarResumen();
        }
        
        function toggleArbitrariedadFactica(cb) {
            let c = document.getElementById('arbitrariedadFacticaContainer');
            if (cb.checked) c.style.display = 'block';
            else { 
                c.style.display = 'none'; 
                c.querySelectorAll('input[type="checkbox"]').forEach(cb => cb.checked = false);
            }
            actualizarResumen();
        }
        
        function toggleOtrasCausales(cb) {
            let c = document.getElementById('otrasCausalesContainer');
            if (cb.checked) c.style.display = 'block';
            else { 
                c.style.display = 'none'; 
                c.querySelectorAll('input[type="checkbox"]').forEach(cb => cb.checked = false);
                document.getElementById('faltaFundamentacionContainer').style.display = 'none';
                document.getElementById('defectosNormativaContainer').style.display = 'none';
            }
            actualizarResumen();
        }
        
        function toggleFaltaFundamentacion(cb) {
            let c = document.getElementById('faltaFundamentacionContainer');
            if (cb.checked) c.style.display = 'block';
            else { 
                c.style.display = 'none'; 
                c.querySelectorAll('input[type="checkbox"]').forEach(cb => cb.checked = false);
            }
            actualizarResumen();
        }
        
        function toggleDefectosNormativa(cb) {
            let c = document.getElementById('defectosNormativaContainer');
            if (cb.checked) c.style.display = 'block';
            else { 
                c.style.display = 'none'; 
                c.querySelectorAll('input[type="checkbox"]').forEach(cb => cb.checked = false);
            }
            actualizarResumen();
        }
        
        function toggleCustomOtroMotivo(select) {
            let c = document.getElementById('customOtroMotivoContainer');
            if (select.value === 'otro') c.style.display = 'block';
            else { 
                c.style.display = 'none'; 
                document.getElementById('customOtroMotivo').value = ''; 
            }
            actualizarResumen();
        }
        
        function toggleCustomCuestionFederal(cb) {
            let c = document.getElementById('customCuestionFederalContainer');
            if (cb.checked) c.style.display = 'block';
            else { 
                c.style.display = 'none'; 
                document.getElementById('customCuestionFederal').value = ''; 
            }
            actualizarResumen();
        }
        
        function toggleCustomPrincipioA(s) {
            let c = document.getElementById('customPrincipioAContainer');
            c.style.display = s.value === 'otro' ? 'block' : 'none';
            if (s.value !== 'otro') document.getElementById('customPrincipioA').value = '';
            actualizarResumen();
        }
        
        function toggleCustomPrincipioB(s) {
            let c = document.getElementById('customPrincipioBContainer');
            c.style.display = s.value === 'otro' ? 'block' : 'none';
            if (s.value !== 'otro') document.getElementById('customPrincipioB').value = '';
            actualizarResumen();
        }
        
        function toggleAtinencia(cb) {
            let c = document.getElementById('atinenciaContainer');
            if (cb.checked) c.style.display = 'block';
            else { 
                c.style.display = 'none'; 
                c.querySelectorAll('input[type="checkbox"]').forEach(cb => cb.checked = false);
            }
            actualizarResumen();
        }
        
        function toggleAmbiguedad(cb) {
            let c = document.getElementById('ambiguedadContainer');
            if (cb.checked) c.style.display = 'block';
            else { 
                c.style.display = 'none'; 
                c.querySelectorAll('input[type="checkbox"]').forEach(cb => cb.checked = false);
            }
            actualizarResumen();
        }
        
        function toggleCollapsible(e) {
            e.classList.toggle('active');
            e.nextElementSibling.classList.toggle('active');
        }
        
        function toggleDisidencias(m) {
            let c = document.getElementById('disidenciasContainer');
            if (m) c.classList.add('active');
            else { 
                c.classList.remove('active'); 
                document.getElementById('detalleDisidencias').value = ''; 
            }
            actualizarResumen();
        }
        
        function togglePrincipiosContainer(m) {
            let c = document.getElementById('principiosContainer');
            if (m) c.style.display = 'block';
            else { 
                c.style.display = 'none'; 
                document.getElementById('principioA').value = ''; 
                document.getElementById('principioB').value = ''; 
                document.getElementById('customPrincipioA').value = ''; 
                document.getElementById('customPrincipioB').value = ''; 
                document.getElementById('customPrincipioAContainer').style.display = 'none'; 
                document.getElementById('customPrincipioBContainer').style.display = 'none'; 
            }
            actualizarResumen();
        }
        
        function toggleProbatorio(m) {
            let c = document.getElementById('probatorioContainer');
            let chk = document.getElementById('problema-probatorio');
            if (m && chk.checked) c.classList.add('active');
            else { 
                c.classList.remove('active'); 
                c.querySelectorAll('input').forEach(i => { 
                    if (i.type === 'checkbox' || i.type === 'radio') i.checked = false; 
                }); 
            }
            actualizarResumen();
        }

        // ============ GUARDADO Y RESET ============
        function validarProblemaJuridico() { 
            return document.querySelectorAll('input[name="problemaJuridico"]:checked').length > 0; 
        }
        
        function guardarFallo() {
            let c = document.getElementById('caratula').value;
            let f = document.getElementById('fecha').value;
            if (!c || !f) {
                showStatus('Complete los campos obligatorios', 'error');
                return;
            }
            if (!validarProblemaJuridico()) {
                showStatus('Debe seleccionar al menos un tipo de problema jurídico', 'error');
                return;
            }
            if (document.getElementById('voto-disidencias').checked && !document.getElementById('detalleDisidencias').value) {
                showStatus('Debe detallar las disidencias', 'error');
                return;
            }
            if (document.getElementById('colision-si')?.checked) {
                let a = obtenerValorConPersonalizado('principioA', 'customPrincipioA');
                let b = obtenerValorConPersonalizado('principioB', 'customPrincipioB');
                if (!a || !b) {
                    showStatus('Debe especificar ambos principios cuando hay colisión', 'error');
                    return;
                }
            }
            showStatus(`Fallo "${c}" procesado correctamente`, 'success');
        }

        function showStatus(m, t) {
            let s = document.getElementById('statusMessage');
            s.textContent = m;
            s.className = `status-message status-${t}`;
            s.style.display = 'block';
            setTimeout(() => s.style.display = 'none', 5000);
        }

        function resetForm() {
            if (confirm('¿Limpiar todo el formulario?')) {
                document.getElementById('fallosForm').reset();
                document.querySelectorAll('.conditional-section, .custom-input').forEach(el => { 
                    el.classList.remove('active'); 
                    el.style.display = 'none'; 
                });
                document.querySelectorAll('.collapsible-content').forEach(c => c.classList.remove('active'));
                document.querySelectorAll('.collapsible-header').forEach(h => h.classList.remove('active'));
                
                document.getElementById('arbitrariedadGeneralContainer').style.display = 'none';
                document.getElementById('arbitrariedadFacticaContainer').style.display = 'none';
                document.getElementById('otrasCausalesContainer').style.display = 'none';
                document.getElementById('faltaFundamentacionContainer').style.display = 'none';
                document.getElementById('defectosNormativaContainer').style.display = 'none';
                document.getElementById('principiosContainer').style.display = 'none';
                
                actualizarResumen();
                showStatus('Formulario limpiado correctamente', 'success');
            }
        }

        // ============ INICIALIZACIÓN ============
        document.getElementById('current-year').textContent = new Date().getFullYear();
        document.getElementById('fecha').valueAsDate = new Date();
        
        document.addEventListener('DOMContentLoaded', function() {
            document.querySelectorAll('.custom-input').forEach(el => el.style.display = 'none');
            document.getElementById('principiosContainer').style.display = 'none';
            actualizarResumen();
        });
    </script>
</body>
</html>
