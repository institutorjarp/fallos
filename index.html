<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Instituto de Recursos Judiciales - Sistema de Carga de Fallos</title>
    <link rel="icon" type="image/png" sizes="32x32" href="favicon.png">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&family=Playfair+Display:wght@500;600;700&display=swap" rel="stylesheet">
    
    <!-- Librería para generar PDF -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    
    <style>
        /* ===== VARIABLES Y RESET ===== */
        :root {
            --primary-color: #2c3e50;
            --secondary-color: #34495e;
            --accent-color: #3498db;
            --success-color: #27ae60;
            --warning-color: #f39c12;
            --danger-color: #e74c3c;
            --light-color: #ecf0f1;
            --dark-color: #2c3e50;
            --border-color: #bdc3c7;
            --shadow: 0 1px 4px rgba(0, 0, 0, 0.05);
            --border-radius: 4px;
            --transition: all 0.2s ease;
            --gray-600: #718096;
            --disabled-bg: #f5f5f5;
            --disabled-color: #aaa;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Roboto', sans-serif;
            background-color: #f8f9fa;
            color: #333;
            line-height: 1.5;
            padding: 15px;
            font-size: 14px;
        }
        
        .container {
            max-width: 1100px;
            margin: 0 auto;
        }
        
        /* ===== HEADER PROFESIONAL ===== */
        .header {
            margin-bottom: 25px;
            padding: 0;
            border-radius: var(--border-radius);
            overflow: hidden;
            box-shadow: var(--shadow);
        }
        
        .header-top {
            background: linear-gradient(135deg, #1a2634, #2c3e50);
            color: white;
            padding: 25px 30px;
            text-align: center;
            border-bottom: 3px solid var(--accent-color);
        }
        
        .instituto-nombre {
            font-size: 1.3rem;
            font-weight: 400;
            letter-spacing: 1px;
            margin-bottom: 10px;
            font-family: 'Playfair Display', serif;
            opacity: 0.95;
        }
        
        .sistema-titulo {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            font-family: 'Playfair Display', serif;
        }
        
        .sistema-titulo i {
            color: var(--accent-color);
            font-size: 1.8rem;
        }
        
        .header-subtitle {
            font-size: 1rem;
            opacity: 0.9;
            max-width: 700px;
            margin: 0 auto;
            font-style: italic;
        }
        
        .header-footer {
            background-color: var(--secondary-color);
            color: white;
            padding: 10px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.85rem;
        }
        
        .badge {
            background-color: var(--accent-color);
            color: white;
            padding: 4px 10px;
            border-radius: 20px;
            font-weight: 500;
            font-size: 0.8rem;
        }
        
        /* ===== PANEL DE RESUMEN ===== */
        .resumen-panel {
            background: white;
            border-radius: var(--border-radius);
            padding: 18px 22px;
            margin-bottom: 25px;
            box-shadow: var(--shadow);
            border: 1px solid #e9ecef;
            border-left: 5px solid var(--accent-color);
        }
        
        .resumen-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
            padding-bottom: 8px;
            border-bottom: 1px solid #edf2f7;
            color: var(--gray-600);
            font-size: 0.8rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .resumen-badge {
            background: var(--light-color);
            padding: 4px 12px;
            border-radius: 30px;
            font-weight: 600;
            font-size: 0.75rem;
            color: var(--primary-color);
        }
        
        .resumen-redactado {
            margin-top: 0px;
            padding-top: 0px;
            border-top: none;
        }
        
        .resumen-redactado-titulo {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.85rem;
            font-weight: 600;
            color: var(--primary-color);
            margin-bottom: 15px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .resumen-redactado-titulo i {
            color: var(--accent-color);
        }
        
        .resumen-redactado-contenido {
            background: #f8fafc;
            border-radius: 6px;
            padding: 18px 22px;
            border-left: 4px solid var(--accent-color);
            font-size: 0.9rem;
            line-height: 1.6;
            color: #2d3748;
        }
        
        .resumen-redactado-contenido p {
            margin-bottom: 12px;
        }
        
        .resumen-redactado-contenido p:last-child {
            margin-bottom: 0;
        }
        
        .resumen-vacio {
            color: var(--gray-600);
            font-style: italic;
            padding: 30px;
            text-align: center;
            background: #f8fafc;
            border-radius: 6px;
            font-size: 0.9rem;
        }
        
        .resumen-footer {
            margin-top: 20px;
            padding-top: 15px;
            border-top: 1px solid #edf2f7;
            font-size: 0.75rem;
            color: var(--gray-600);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .resumen-footer-left {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .resumen-footer-left i {
            color: var(--accent-color);
        }
        
        .resumen-footer-right {
            font-weight: 600;
            color: var(--accent-color);
            background: #e6f0fa;
            padding: 5px 15px;
            border-radius: 30px;
            font-size: 0.7rem;
        }
        
        /* ===== BOTÓN PDF DEBAJO DEL RESUMEN ===== */
        .pdf-button-container {
            display: flex;
            justify-content: flex-end;
            margin-top: 15px;
        }
        
        .btn-pdf {
            background: var(--accent-color);
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: var(--border-radius);
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            display: inline-flex;
            align-items: center;
            gap: 8px;
            box-shadow: var(--shadow);
        }
        
        .btn-pdf:hover {
            background: #2980b9;
            transform: translateY(-1px);
            box-shadow: var(--shadow-hover);
        }
        
        /* ===== FORMULARIOS ===== */
        .form-section {
            background: white;
            border-radius: var(--border-radius);
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: var(--shadow);
            transition: var(--transition);
        }
        
        .form-section:hover {
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        }
        
        .form-section.disabled {
            opacity: 0.6;
            background-color: var(--disabled-bg);
            pointer-events: none;
        }
        
        .form-section.disabled .section-title {
            color: var(--disabled-color);
        }
        
        .form-section.disabled .section-title i {
            color: var(--disabled-color);
        }
        
        .section-title {
            font-size: 1.4rem;
            color: var(--primary-color);
            margin-bottom: 18px;
            padding-bottom: 8px;
            border-bottom: 2px solid var(--accent-color);
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .section-title i {
            color: var(--accent-color);
            font-size: 1.2rem;
        }
        
        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 18px;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        .form-group.full-width {
            grid-column: 1 / -1;
        }
        
        label {
            display: block;
            margin-bottom: 6px;
            font-weight: 500;
            color: var(--secondary-color);
            font-size: 0.95rem;
        }
        
        .required::after {
            content: " *";
            color: var(--danger-color);
        }
        
        input[type="text"],
        input[type="date"],
        textarea,
        select {
            width: 100%;
            padding: 10px 12px;
            border: 1.5px solid var(--border-color);
            border-radius: var(--border-radius);
            font-size: 0.95rem;
            transition: var(--transition);
            background-color: white;
        }
        
        input[type="text"]:focus,
        input[type="date"]:focus,
        textarea:focus,
        select:focus {
            outline: none;
            border-color: var(--accent-color);
            box-shadow: 0 0 0 2px rgba(52,152,219,0.1);
        }
        
        .custom-input {
            margin-top: 10px;
            animation: fadeIn 0.3s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-5px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        textarea {
            min-height: 100px;
            resize: vertical;
        }
        
        .option-group {
            background: #f8f9fa;
            padding: 15px;
            border-radius: var(--border-radius);
            border: 1px solid #e9ecef;
        }
        
        .options-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
            gap: 10px;
        }
        
        /* Estilo especial para Fáctica - 3 columnas fijas */
        .factica-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-top: 10px;
        }
        
        .checkbox-option,
        .radio-option {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px;
            background: white;
            border-radius: 5px;
            border: 1px solid var(--border-color);
            transition: var(--transition);
            cursor: pointer;
            font-size: 0.9rem;
        }
        
        .checkbox-option:hover,
        .radio-option:hover {
            border-color: var(--accent-color);
            background-color: #f0f8ff;
        }
        
        .checkbox-option input,
        .radio-option input {
            width: 16px;
            height: 16px;
            cursor: pointer;
        }
        
        .checkbox-option label,
        .radio-option label {
            margin: 0;
            cursor: pointer;
            font-weight: normal;
            flex: 1;
            font-size: 0.9rem;
        }
        
        .method-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 10px;
        }
        
        .collapsible {
            margin-bottom: 15px;
        }
        
        .collapsible-header {
            background: var(--light-color);
            padding: 12px 15px;
            border-radius: var(--border-radius);
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
            font-weight: 600;
            color: var(--primary-color);
            border: 1px solid var(--border-color);
            transition: var(--transition);
            font-size: 0.95rem;
        }
        
        .collapsible-header:hover {
            background: #dfe6e9;
        }
        
        .collapsible-header i {
            transition: transform 0.2s ease;
            font-size: 0.9rem;
        }
        
        .collapsible-header.active i {
            transform: rotate(180deg);
        }
        
        .collapsible-content {
            padding: 15px;
            border: 1px solid var(--border-color);
            border-top: none;
            border-radius: 0 0 var(--border-radius) var(--border-radius);
            background: white;
            display: none;
        }
        
        .collapsible-content.active {
            display: block;
        }
        
        .conditional-section {
            border-left: 4px solid var(--accent-color);
            padding-left: 15px;
            margin-top: 15px;
            margin-bottom: 15px;
            background-color: #f9fafb;
            border-radius: 0 var(--border-radius) var(--border-radius) 0;
            padding: 15px;
            display: none;
        }
        
        .conditional-section.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }
        
        .sub-section {
            background: #f0f2f5;
            padding: 15px;
            border-radius: var(--border-radius);
            margin-top: 10px;
            border: 1px solid var(--border-color);
        }
        
        .buttons-container {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 30px;
            padding: 15px;
        }
        
        .btn {
            padding: 12px 30px;
            border: none;
            border-radius: var(--border-radius);
            font-size: 0.95rem;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            min-width: 160px;
        }
        
        .btn-submit {
            background: var(--success-color);
            color: white;
        }
        
        .btn-submit:hover {
            background: #219653;
            transform: translateY(-1px);
            box-shadow: var(--shadow);
        }
        
        .btn-reset {
            background: var(--danger-color);
            color: white;
        }
        
        .btn-reset:hover {
            background: #c0392b;
            transform: translateY(-1px);
            box-shadow: var(--shadow);
        }
        
        /* ===== RESPONSIVE ===== */
        @media (max-width: 768px) {
            .resumen-item {
                flex-direction: column;
            }
            
            .resumen-icono {
                display: none;
            }
            
            .resumen-label {
                min-width: 100%;
                margin-bottom: 4px;
            }
            
            .form-grid {
                grid-template-columns: 1fr;
            }
            
            .options-container,
            .method-grid,
            .factica-grid {
                grid-template-columns: 1fr;
            }
            
            .buttons-container {
                flex-direction: column;
            }
            
            .pdf-button-container {
                justify-content: center;
            }
        }
        
        .status-message {
            padding: 12px 15px;
            border-radius: var(--border-radius);
            margin-bottom: 15px;
            display: none;
            font-weight: 500;
            font-size: 0.9rem;
        }
        
        .status-success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .status-error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .footer {
            text-align: center;
            margin-top: 35px;
            padding: 15px;
            color: #7f8c8d;
            font-size: 0.8rem;
            border-top: 1px solid var(--border-color);
        }
        
        .helper-text {
            font-size: 0.8rem;
            color: #7f8c8d;
            margin-top: 4px;
            font-style: italic;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- HEADER -->
        <header class="header">
            <div class="header-top">
                <div class="instituto-nombre">
                    <i class="fas fa-university"></i> Instituto de Recursos Judiciales, Argumentación y Razonamiento Probatorio
                </div>
                <h1 class="sistema-titulo">
                    <i class="fas fa-gavel"></i> Sistema de Carga de Fallos Judiciales
                </h1>
                <p class="header-subtitle">Análisis sistematizado de jurisprudencia</p>
            </div>
            <div class="header-footer">
                <span><i class="fas fa-balance-scale"></i> </span>
                <span class="badge"><i class="fas fa-file-alt"></i> Formulario de análisis crítico</span>
            </div>
        </header>
        
        <!-- PANEL DE RESUMEN - Solo narrativo -->
        <div class="resumen-panel" id="resumenPanel">
            <div class="resumen-header">
                <span><i class="fas fa-file-alt"></i> RESUMEN DEL FALLO - ACTUALIZACIÓN EN TIEMPO REAL</span>
                <span class="resumen-badge" id="resumenBadge">Sin datos</span>
            </div>
            
            <!-- SOLO RESUMEN NARRATIVO -->
            <div class="resumen-redactado" id="resumenRedactado" style="display: block;">
                <div class="resumen-redactado-titulo">
                    <i class="fas fa-quote-left"></i> RESUMEN NARRATIVO DEL FALLO
                </div>
                <div class="resumen-redactado-contenido" id="resumenRedactadoContenido">
                    <span class="resumen-vacio">Complete el formulario para ver el resumen del fallo...</span>
                </div>
            </div>
            
            <!-- BOTÓN PDF DEBAJO DEL RESUMEN -->
            <div class="pdf-button-container">
                <button type="button" class="btn-pdf" onclick="descargarResumenPDF()">
                    <i class="fas fa-file-pdf"></i> Descargar Resumen PDF
                </button>
            </div>
            
            <div class="resumen-footer" id="resumenFooter"></div>
        </div>
        
        <div id="statusMessage" class="status-message"></div>
        
        <form id="fallosForm">
            <!-- SECCIÓN 1: IDENTIFICACIÓN DEL FALLO -->
            <section class="form-section" id="section1">
                <h2 class="section-title"><i class="fas fa-id-card"></i> 1. Identificación del fallo</h2>
                <div class="form-grid" style="grid-template-columns: 1.5fr 1fr 1fr 0.8fr;">
                    <div class="form-group">
                        <label for="caratula" class="required">Carátula</label>
                        <input type="text" id="caratula" name="caratula" required placeholder="Ej: 'Pérez, Juan c/ Estado Nacional'" onchange="actualizarResumen()" onkeyup="actualizarResumen()">
                    </div>
                    <div class="form-group">
                        <label for="numeroCausa" class="required">N° Causa</label>
                        <input type="text" id="numeroCausa" name="numeroCausa" required placeholder="Ej: 12345/2023" onchange="actualizarResumen()" onkeyup="actualizarResumen()">
                    </div>
                    <div class="form-group">
                        <label for="fallos">Fallos <span style="font-weight: normal; color: var(--gray-600);">(opcional)</span></label>
                        <input type="text" id="fallos" name="fallos" placeholder="Ej: 336:1234" onchange="actualizarResumen()" onkeyup="actualizarResumen()">
                    </div>
                    <div class="form-group">
                        <label for="fecha" class="required">Fecha</label>
                        <input type="date" id="fecha" name="fecha" required onchange="actualizarResumen()">
                    </div>
                </div>
            </section>
            
            <!-- SECCIÓN 2: COMPOSICIÓN DEL TRIBUNAL -->
            <section class="form-section" id="section2">
                <h2 class="section-title"><i class="fas fa-gavel"></i> 2. Composición del Tribunal</h2>
                <div class="form-grid">
                    <div class="form-group">
                        <label for="integracion" class="required">Integración de la Corte</label>
                        <textarea id="integracion" name="integracion" required placeholder="Liste los miembros del tribunal..." onchange="actualizarResumen()" onkeyup="actualizarResumen()"></textarea>
                    </div>
                    <div class="form-group">
                        <label class="required">Voto</label>
                        <div class="option-group">
                            <div class="options-container">
                                <div class="radio-option">
                                    <input type="radio" id="voto-unanimidad" name="voto" value="unanimidad" required onclick="toggleDisidencias(false); actualizarResumen()">
                                    <label for="voto-unanimidad">Unanimidad</label>
                                </div>
                                <div class="radio-option">
                                    <input type="radio" id="voto-mayoria" name="voto" value="mayoria" onclick="toggleDisidencias(false); actualizarResumen()">
                                    <label for="voto-mayoria">Mayoría</label>
                                </div>
                                <div class="radio-option">
                                    <input type="radio" id="voto-disidencias" name="voto" value="disidencias" onclick="toggleDisidencias(true); actualizarResumen()">
                                    <label for="voto-disidencias">Disidencias</label>
                                </div>
                            </div>
                        </div>
                        <div id="disidenciasContainer" class="conditional-section">
                            <label for="detalleDisidencias" class="required">Detalle de las disidencias (indicar de quién es la disidencia)</label>
                            <textarea id="detalleDisidencias" name="detalleDisidencias" required placeholder="Ej: 'El juez Martínez disiente...'" onchange="actualizarResumen()" onkeyup="actualizarResumen()"></textarea>
                        </div>
                    </div>
                    
                    <!-- Admisibilidad -->
                    <div class="form-group full-width">
                        <label class="required">Admisibilidad</label>
                        <div class="option-group">
                            <div class="options-container" style="grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));">
                                <div class="radio-option">
                                    <input type="radio" id="admisibilidad-si" name="admisibilidad" value="si" onclick="toggleAdmisibilidad(true); actualizarResumen()">
                                    <label for="admisibilidad-si">Sí</label>
                                </div>
                                <div class="radio-option">
                                    <input type="radio" id="admisibilidad-no" name="admisibilidad" value="no" onclick="toggleAdmisibilidad(false); actualizarResumen()">
                                    <label for="admisibilidad-no">No</label>
                                </div>
                            </div>
                            
                            <!-- Opciones que aparecen cuando la admisibilidad es NO -->
                            <div id="admisibilidadNoContainer" style="display: none; margin-top: 15px;">
                                <div class="form-group">
                                    <label for="motivoInadmisible">Motivo (rellenar campo ej. Art 280 CPCCN)</label>
                                    <input type="text" id="motivoInadmisible" name="motivoInadmisible" placeholder="Ej: Art. 280 CPCCN" onchange="actualizarResumen()" onkeyup="actualizarResumen()">
                                </div>
                                <div class="form-group">
                                    <label for="argumentoCorte">¿La corte se expide con algún argumento?</label>
                                    <textarea id="argumentoCorte" name="argumentoCorte" rows="2" placeholder="Describa el argumento..." onchange="actualizarResumen()" onkeyup="actualizarResumen()"></textarea>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
            
            <!-- SECCIÓN 3: TEMA JURÍDICO -->
            <section class="form-section" id="section3">
                <h2 class="section-title"><i class="fas fa-balance-scale"></i> 3. Tema jurídico</h2>
                
                <div class="form-grid">
                    <!-- MATERIA PRINCIPAL - COMBO (SELECT) -->
                    <div class="form-group full-width">
                        <label for="materiaPrincipal" class="required">Materia principal</label>
                        <select id="materiaPrincipal" name="materiaPrincipal" class="form-control" onchange="toggleMateriaPrincipal(this); actualizarResumen()">
                            <option value="">-- Seleccione una materia principal --</option>
                            <option value="Aplicación/determinación de la pena">Aplicación/determinación de la pena</option>
                            <option value="Control de oficio del orden público">Control de oficio del orden público</option>
                            <option value="Cuestiones de competencia">Cuestiones de competencia</option>
                            <option value="Decomiso de bienes">Decomiso de bienes</option>
                            <option value="Derechos convencionales">Derechos convencionales</option>
                            <option value="Detención ilegal">Detención ilegal</option>
                            <option value="Ejecución de la pena privativa de libertad">Ejecución de la pena privativa de libertad</option>
                            <option value="Estupefacientes">Estupefacientes</option>
                            <option value="Facultades del poder legislativo">Facultades del poder legislativo</option>
                            <option value="Falta de fundamentación autónoma del recurso (artículo 15 de la ley 48)">Falta de fundamentación autónoma del recurso (artículo 15 de la ley 48)</option>
                            <option value="Garantía de defensa en juicio">Garantía de defensa en juicio</option>
                            <option value="Incompetencia de la justicia federal">Incompetencia de la justicia federal</option>
                            <option value="Inconstitucionalidad de la escala penal">Inconstitucionalidad de la escala penal</option>
                            <option value="Juicio criminal (por ej: evaluación de la prueba, asistencia legal, etc)">Juicio criminal (por ej: evaluación de la prueba, asistencia legal, etc)</option>
                            <option value="Naturaleza excepcional y restrictiva de la jurisdicción federal">Naturaleza excepcional y restrictiva de la jurisdicción federal</option>
                            <option value="Prescripción de la acción penal">Prescripción de la acción penal</option>
                            <option value="Prisión preventiva">Prisión preventiva</option>
                            <option value="Procesos de extradición">Procesos de extradición</option>
                            <option value="Prohibición de autoincriminación">Prohibición de autoincriminación</option>
                            <option value="Supremacía constitucional">Supremacía constitucional</option>
                            <option value="Suspensión del juicio a prueba">Suspensión del juicio a prueba</option>
                            <option value="Tutela judicial efectiva">Tutela judicial efectiva</option>
                            <option value="Violación al debido proceso">Violación al debido proceso</option>
                            <option value="Violación del plazo razonable">Violación del plazo razonable</option>
                            <option value="otro">Otra... (especificar)</option>
                        </select>
                        
                        <!-- Campo de texto para "Otra..." -->
                        <div id="materiaPrincipalOtraContainer" class="custom-input" style="display: none; margin-top: 10px;">
                            <label for="materiaPrincipalOtra">Especifique la materia principal:</label>
                            <input type="text" id="materiaPrincipalOtra" name="materiaPrincipalOtra" placeholder="Ingrese la materia principal..." class="form-control" onchange="actualizarResumen()" onkeyup="actualizarResumen()">
                        </div>
                    </div>
                    
                    <!-- SUBTEMA - campo de texto libre -->
                    <div class="form-group full-width">
                        <label for="subtemaTexto">Subtema:</label>
                        <input type="text" id="subtemaTexto" name="subtemaTexto" placeholder="Ingrese el subtema del caso" onchange="actualizarResumen()" onkeyup="actualizarResumen()">
                    </div>
                </div>
            </section>
            
            <!-- SECCIÓN 4: CUESTIÓN FEDERAL PLANTEADA -->
            <section class="form-section" id="section4">
                <h2 class="section-title"><i class="fas fa-landmark"></i> 4. Cuestión federal planteada</h2>
                <div class="form-grid">
                    <div class="form-group full-width">
                        <div class="option-group">
                            
                            <!-- ARBITRARIEDAD - opciones -->
                            <div style="margin-bottom: 20px;">
                                <div class="checkbox-option" style="background: #e8f0fe; border-left: 3px solid var(--accent-color); margin-bottom: 10px;">
                                    <input type="checkbox" id="cuest-arbitrariedad" name="cuestionFederalPrincipal" value="Arbitrariedad" onclick="toggleArbitrariedadCuest(this); actualizarResumen()">
                                    <label for="cuest-arbitrariedad"><strong>Arbitrariedad</strong></label>
                                </div>
                                
                                <div id="arbitrariedadCuestContainer" style="display: none; margin-left: 25px;">
                                    
                                    <!-- NORMATIVA -->
                                    <div style="margin-bottom: 10px;">
                                        <div class="checkbox-option" style="background: #f8f9fa;">
                                            <input type="checkbox" id="cuest-arbitrariedad-normativa" name="arbitrariedadCuest" value="Normativa" onclick="toggleNormativaCuest(this); actualizarResumen()">
                                            <label for="cuest-arbitrariedad-normativa"><strong>Normativa</strong></label>
                                        </div>
                                        
                                        <!-- Subopciones de Normativa -->
                                        <div id="normativaSubopcionesContainer" style="margin-left: 25px; margin-top: 5px; margin-bottom: 15px; display: none;">
                                            <div class="checkbox-option" style="background: #f8f9fa; margin-bottom: 5px;">
                                                <input type="checkbox" id="cuest-fundamentacion" name="arbitrariedadNormativa" value="Falta de fundamentación suficiente" onclick="toggleFundamentacionCuest(this); actualizarResumen()">
                                                <label for="cuest-fundamentacion">Falta de fundamentación suficiente</label>
                                            </div>
                                            <div id="fundamentacionCuestContainer" style="display: none; margin-left: 25px; margin-bottom: 10px;">
                                                <div class="checkbox-option" style="background: #f8f9fa;">
                                                    <input type="checkbox" id="cuest-fund-dogmaticas" name="opcionesFundamentacionCuest" value="Afirmaciones dogmáticas o no fundadas" onclick="actualizarResumen()">
                                                    <label for="cuest-fund-dogmaticas">Afirmaciones dogmáticas o no fundadas</label>
                                                </div>
                                                <div class="checkbox-option" style="background: #f8f9fa;">
                                                    <input type="checkbox" id="cuest-fund-idonea" name="opcionesFundamentacionCuest" value="Falta de fundamentación idónea o no suficiente" onclick="actualizarResumen()">
                                                    <label for="cuest-fund-idonea">Falta de fundamentación idónea o no suficiente</label>
                                                </div>
                                                <div class="checkbox-option" style="background: #f8f9fa;">
                                                    <input type="checkbox" id="cuest-fund-sustento" name="opcionesFundamentacionCuest" value="Carencia de sustento o referencia concreta" onclick="actualizarResumen()">
                                                    <label for="cuest-fund-sustento">Carencia de sustento o referencia concreta</label>
                                                </div>
                                            </div>
                                            
                                            <div class="checkbox-option" style="background: #f8f9fa;">
                                                <input type="checkbox" id="cuest-defectos-normativa" name="arbitrariedadNormativa" value="Defectos en la fundamentación normativa" onclick="toggleDefectosNormativaCuest(this); actualizarResumen()">
                                                <label for="cuest-defectos-normativa">Defectos en la fundamentación normativa</label>
                                            </div>
                                            <div id="defectosNormativaCuestContainer" style="display: none; margin-left: 25px; margin-bottom: 10px;">
                                                <div class="checkbox-option" style="background: #f8f9fa;">
                                                    <input type="checkbox" id="cuest-norm-interpretacion" name="opcionesNormativaCuest" value="Interpretación o aplicación errónea de la norma" onclick="actualizarResumen()">
                                                    <label for="cuest-norm-interpretacion">Interpretación o aplicación errónea de la norma</label>
                                                </div>
                                                <div class="checkbox-option" style="background: #f8f9fa;">
                                                    <input type="checkbox" id="cuest-norm-apartamiento" name="opcionesNormativaCuest" value="Apartamiento u omisión normativa" onclick="actualizarResumen()">
                                                    <label for="cuest-norm-apartamiento">Apartamiento u omisión normativa</label>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- FÁCTICA -->
                                    <div style="margin-bottom: 15px;">
                                        <div class="checkbox-option" style="background: #f8f9fa; border-left: 2px solid var(--warning-color);">
                                            <input type="checkbox" id="cuest-arbitrariedad-factica" name="arbitrariedadCuest" value="Fáctica" onclick="toggleArbitrariedadFacticaCuest(this); actualizarResumen()">
                                            <label for="cuest-arbitrariedad-factica"><strong>Fáctica</strong></label>
                                        </div>
                                        <div id="arbitrariedadFacticaCuestContainer" style="display: none; margin-left: 25px; margin-top: 10px;">
                                            <div class="factica-grid">
                                                <div class="checkbox-option" style="background: #fff4e6; height: 100%;">
                                                    <input type="checkbox" id="cuest-factica-conceptual" name="arbitrariedadFacticaCuest" value="Conceptual" onclick="actualizarResumen()">
                                                    <label for="cuest-factica-conceptual">
                                                        <strong>Conceptual</strong><br>                                                        
                                                    </label>
                                                </div>
                                                <div class="checkbox-option" style="background: #fff4e6; height: 100%;">
                                                    <input type="checkbox" id="cuest-factica-normativa" name="arbitrariedadFacticaCuest" value="Normativa" onclick="actualizarResumen()">
                                                    <label for="cuest-factica-normativa">
                                                        <strong>Normativa</strong><br>                                                        
                                                    </label>
                                                </div>
                                                <div class="checkbox-option" style="background: #fff4e6; height: 100%;">
                                                    <input type="checkbox" id="cuest-factica-epistemica" name="arbitrariedadFacticaCuest" value="Epistémica" onclick="actualizarResumen()">
                                                    <label for="cuest-factica-epistemica">
                                                        <strong>Epistémica</strong><br>                                                        
                                                    </label>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- LÓGICA -->
                                    <div style="margin-bottom: 15px;">
                                        <div class="checkbox-option" style="background: #f8f9fa; border-left: 2px solid var(--danger-color);">
                                            <input type="checkbox" id="cuest-arbitrariedad-logica" name="arbitrariedadCuest" value="Lógica" onclick="toggleLogicaCuest(this); actualizarResumen()">
                                            <label for="cuest-arbitrariedad-logica"><strong>Lógica</strong></label>
                                        </div>
                                        <div id="logicaCuestContainer" style="display: none; margin-left: 25px; margin-top: 10px;">
                                            <div class="checkbox-option" style="background: #fff0f0; margin-bottom: 10px;">
                                                <input type="checkbox" id="cuest-logica-contradiccion" name="logicaOpciones" value="Contradicción" onclick="actualizarResumen()">
                                                <label for="cuest-logica-contradiccion"><strong>Contradicción</strong></label>
                                            </div>
                                            <div style="margin-top: 10px;">
                                                <div class="checkbox-option" style="background: #fff0f0;">
                                                    <input type="checkbox" id="cuest-logica-otra" name="logicaOpciones" value="otra" onclick="toggleLogicaOtra(this); actualizarResumen()">
                                                    <label for="cuest-logica-otra"><strong>Otra</strong></label>
                                                </div>
                                                <div id="logicaOtraContainer" style="display: none; margin-left: 25px; margin-top: 10px;">
                                                    <label for="logicaOtraTexto">Especifique:</label>
                                                    <input type="text" id="logicaOtraTexto" name="logicaOtraTexto" placeholder="Ingrese el tipo de error lógico..." style="width: 100%; padding: 8px; border: 1px solid var(--border-color); border-radius: var(--border-radius);" onchange="actualizarResumen()" onkeyup="actualizarResumen()">
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- OTRAS -->
                                    <div style="margin-top: 15px;">
                                        <div class="checkbox-option" style="background: #f8f9fa; border-left: 2px solid var(--accent-color);">
                                            <input type="checkbox" id="cuest-arbitrariedad-otras" name="arbitrariedadCuest" value="Otras" onclick="toggleOtrasCuest(this); actualizarResumen()">
                                            <label for="cuest-arbitrariedad-otras"><strong>Otras</strong></label>
                                        </div>
                                        <div id="otrasCuestContainer" style="display: none; margin-left: 25px; margin-top: 10px;">
                                            <div class="options-container">
                                                <div class="checkbox-option" style="background: #f8f9fa;">
                                                    <input type="checkbox" id="cuest-exceso-ritual" name="arbitrariedadOtras" value="Exceso ritual manifiesto" onclick="actualizarResumen()">
                                                    <label for="cuest-exceso-ritual">Exceso ritual manifiesto</label>
                                                </div>
                                                <div class="checkbox-option" style="background: #f8f9fa;">
                                                    <input type="checkbox" id="cuest-apartamiento" name="arbitrariedadOtras" value="Apartamiento de las condiciones de la causa" onclick="actualizarResumen()">
                                                    <label for="cuest-apartamiento">Apartamiento de las condiciones de la causa</label>
                                                </div>
                                                <div class="checkbox-option" style="background: #f8f9fa;">
                                                    <input type="checkbox" id="cuest-valoracion" name="arbitrariedadOtras" value="Valoración de las circunstancias de hecho y prueba" onclick="actualizarResumen()">
                                                    <label for="cuest-valoracion">Valoración de las circunstancias de hecho y prueba</label>
                                                </div>
                                                <div class="checkbox-option" style="background: #f8f9fa;">
                                                    <input type="checkbox" id="cuest-defectos-extremos" name="arbitrariedadOtras" value="Defectos en la consideración de extremos conducentes" onclick="actualizarResumen()">
                                                    <label for="cuest-defectos-extremos">Defectos en la consideración de extremos conducentes</label>
                                                </div>
                                                <div class="checkbox-option" style="background: #f8f9fa;">
                                                    <input type="checkbox" id="cuest-excesos-omisiones" name="arbitrariedadOtras" value="Excesos u omisiones en el pronunciamiento" onclick="actualizarResumen()">
                                                    <label for="cuest-excesos-omisiones">Excesos u omisiones en el pronunciamiento</label>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
            
            <!-- SECCIÓN 5: TIPO DE DESACUERDO -->
            <section class="form-section" id="section5">
                <h2 class="section-title"><i class="fas fa-exclamation-triangle"></i> 5. Tipo de desacuerdo</h2>
                <div class="form-grid">
                    <div class="form-group full-width">
                        <div class="option-group">
                            <div class="options-container">
                                <div class="checkbox-option">
                                    <input type="checkbox" id="desacuerdo-normativo" name="tipoDesacuerdo" value="Normativo" onclick="actualizarResumen()">
                                    <label for="desacuerdo-normativo">Normativo</label>
                                </div>
                                <div class="checkbox-option">
                                    <input type="checkbox" id="desacuerdo-factico" name="tipoDesacuerdo" value="Fáctico" onclick="actualizarResumen()">
                                    <label for="desacuerdo-factico">Fáctico</label>
                                </div>
                                <div class="checkbox-option">
                                    <input type="checkbox" id="desacuerdo-mixto" name="tipoDesacuerdo" value="Mixto" onclick="actualizarResumen()">
                                    <label for="desacuerdo-mixto">Mixto</label>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
            
            <!-- SECCIÓN 6: TIPO DE PROBLEMA JURÍDICO -->
            <section class="form-section" id="section6">
                <h2 class="section-title"><i class="fas fa-question-circle"></i> 6. Tipo de problema jurídico</h2>
                <div class="form-grid">
                    <div class="form-group full-width">
                        <div class="option-group">
                            <div class="options-container">
                                <div class="checkbox-option">
                                    <input type="checkbox" id="problema-constitucionalidad" name="problemaJuridico" value="Constitucionalidad de norma" onclick="toggleProbatorio(false); actualizarResumen()">
                                    <label for="problema-constitucionalidad">Constitucionalidad de norma</label>
                                </div>
                                <div class="checkbox-option">
                                    <input type="checkbox" id="problema-interpretativo" name="problemaJuridico" value="Interpretativo" onclick="toggleProbatorio(false); actualizarResumen()">
                                    <label for="problema-interpretativo">Interpretativo</label>
                                </div>
                                <div class="checkbox-option">
                                    <input type="checkbox" id="problema-probatorio" name="problemaJuridico" value="Probatorio" onclick="toggleProbatorio(true); actualizarResumen()">
                                    <label for="problema-probatorio">Probatorio</label>
                                </div>
                            </div>
                        </div>
                        <div id="probatorioContainer" class="conditional-section">
                            <div class="sub-section">
                                <div class="sub-section-title"><i class="fas fa-clipboard-check"></i> i. Rol de la prueba en la decisión</div>
                                <div class="options-container">
                                    <div class="radio-option">
                                        <input type="radio" id="prueba-central" name="rolPrueba" value="Central" onclick="actualizarResumen()">
                                        <label for="prueba-central">Central</label>
                                    </div>
                                    <div class="radio-option">
                                        <input type="radio" id="prueba-secundario" name="rolPrueba" value="Secundario" onclick="actualizarResumen()">
                                        <label for="prueba-secundario">Secundario</label>
                                    </div>
                                    <div class="radio-option">
                                        <input type="radio" id="prueba-marginal" name="rolPrueba" value="Marginal" onclick="actualizarResumen()">
                                        <label for="prueba-marginal">Marginal</label>
                                    </div>
                                </div>
                            </div>
                            <div class="sub-section">
                                <div class="sub-section-title"><i class="fas fa-brain"></i> ii. Tipo de inferencias probatorias detectadas</div>
                                <div class="method-grid">
                                    <div class="checkbox-option">
                                        <input type="checkbox" id="inferencia-inductivas" name="tipoInferencias" value="Inductivas" onclick="actualizarResumen()">
                                        <label for="inferencia-inductivas">Inductivas</label>
                                    </div>
                                    <div class="checkbox-option">
                                        <input type="checkbox" id="inferencia-maximas" name="tipoInferencias" value="Máximas de experiencia" onclick="actualizarResumen()">
                                        <label for="inferencia-maximas">Máximas de experiencia</label>
                                    </div>
                                    <div class="checkbox-option">
                                        <input type="checkbox" id="inferencia-presunciones-legales" name="tipoInferencias" value="Presunciones legales" onclick="actualizarResumen()">
                                        <label for="inferencia-presunciones-legales">Presunciones legales</label>
                                    </div>
                                    <div class="checkbox-option">
                                        <input type="checkbox" id="inferencia-presunciones-judiciales" name="tipoInferencias" value="Presunciones judiciales" onclick="actualizarResumen()">
                                        <label for="inferencia-presunciones-judiciales">Presunciones judiciales</label>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
            
            <!-- SECCIÓN 7: MÉTODO INTERPRETATIVO -->
            <section class="form-section" id="section7">
                <h2 class="section-title"><i class="fas fa-search"></i> 7. Método interpretativo utilizado</h2>
                <div class="form-grid">
                    <div class="form-group full-width">
                        <div class="method-grid">
                            <div class="checkbox-option"><input type="checkbox" id="metodo-literal" name="metodoInterpretativo" value="Literal" onclick="actualizarResumen()"><label>Literal</label></div>
                            <div class="checkbox-option"><input type="checkbox" id="metodo-sistematico" name="metodoInterpretativo" value="Sistemático" onclick="actualizarResumen()"><label>Sistemático</label></div>
                            <div class="checkbox-option"><input type="checkbox" id="metodo-teleologico" name="metodoInterpretativo" value="Teleológico" onclick="actualizarResumen()"><label>Teleológico</label></div>
                            <div class="checkbox-option"><input type="checkbox" id="metodo-historico" name="metodoInterpretativo" value="Histórico" onclick="actualizarResumen()"><label>Histórico</label></div>
                            <div class="checkbox-option"><input type="checkbox" id="metodo-principialista" name="metodoInterpretativo" value="Principialista" onclick="actualizarResumen()"><label>Principialista</label></div>
                            <div class="checkbox-option"><input type="checkbox" id="metodo-acontrario" name="metodoInterpretativo" value="A contrario" onclick="actualizarResumen()"><label>A contrario</label></div>
                            <div class="checkbox-option"><input type="checkbox" id="metodo-afortiori" name="metodoInterpretativo" value="A fortiori" onclick="actualizarResumen()"><label>A fortiori</label></div>
                            <div class="checkbox-option"><input type="checkbox" id="metodo-analogico" name="metodoInterpretativo" value="Analógico" onclick="actualizarResumen()"><label>Analógico</label></div>
                            <div class="checkbox-option"><input type="checkbox" id="metodo-reduccion" name="metodoInterpretativo" value="Reducción al absurdo" onclick="actualizarResumen()"><label>Reducción al absurdo</label></div>
                            <div class="checkbox-option"><input type="checkbox" id="metodo-coherencia" name="metodoInterpretativo" value="Coherencia del sistema" onclick="actualizarResumen()"><label>Coherencia del sistema</label></div>
                            <div class="checkbox-option"><input type="checkbox" id="metodo-unidad" name="metodoInterpretativo" value="Unidad de la Constitución" onclick="actualizarResumen()"><label>Unidad de la Constitución</label></div>
                        </div>
                    </div>
                </div>
            </section>
            
            <!-- SECCIÓN 8: ARGUMENTOS DE PONDERACIÓN -->
            <section class="form-section" id="section8">
                <h2 class="section-title"><i class="fas fa-weight-hanging"></i> 8. Argumentos de ponderación (Alexy/Maccormick)</h2>
                
                <!-- a. ¿Hay colisión de principios? -->
                <div style="margin-bottom: 20px;">
                    <div style="font-weight: 600; margin-bottom: 10px; color: var(--primary-color);">¿Hay colisión de principios?</div>
                    <div class="options-container" style="grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));">
                        <div class="radio-option">
                            <input type="radio" id="colision-no" name="colisionPrincipios" value="no" onclick="togglePrincipiosContainer(false); actualizarResumen()">
                            <label for="colision-no">No</label>
                        </div>
                        <div class="radio-option">
                            <input type="radio" id="colision-si" name="colisionPrincipios" value="si" onclick="togglePrincipiosContainer(true); actualizarResumen()">
                            <label for="colision-si">Sí</label>
                        </div>
                    </div>
                    
                    <!-- Subopciones que aparecen cuando selecciona SÍ -->
                    <div id="principiosContainer" style="display: none; margin-left: 25px; margin-top: 15px;">
                        <div style="font-style: italic; color: var(--gray-600); margin-bottom: 10px;">en caso de ser sí, entonces indicar:</div>
                        <div class="form-grid" style="grid-template-columns: 1fr 1fr;">
                            <div class="form-group">
                                <label for="principioA" class="required">Principio A:</label>
                                <select id="principioA" name="principioA" onchange="toggleCustomPrincipioA(this); actualizarResumen()">
                                    <option value="">Seleccione un principio</option>
                                    <option value="Autonomía de la voluntad">Autonomía de la voluntad</option>
                                    <option value="Buena fe">Buena fe</option>
                                    <option value="Igualdad">Igualdad</option>
                                    <option value="Libertad">Libertad</option>
                                    <option value="Seguridad jurídica">Seguridad jurídica</option>
                                    <option value="Proporcionalidad">Proporcionalidad</option>
                                    <option value="Razonabilidad">Razonabilidad</option>
                                    <option value="Legalidad">Legalidad</option>
                                    <option value="Dignidad humana">Dignidad humana</option>
                                    <option value="Debido proceso">Debido proceso</option>
                                    <option value="Defensa en juicio">Defensa en juicio</option>
                                    <option value="Publicidad">Publicidad</option>
                                    <option value="Economía procesal">Economía procesal</option>
                                    <option value="Celeridad">Celeridad</option>
                                    <option value="otro">Otro (especificar)</option>
                                </select>
                                <div id="customPrincipioAContainer" class="custom-input" style="display: none;">
                                    <label for="customPrincipioA">Especifique el principio:</label>
                                    <input type="text" id="customPrincipioA" name="customPrincipioA" placeholder="Ingrese el principio A..." onchange="actualizarResumen()" onkeyup="actualizarResumen()">
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="principioB" class="required">Principio B:</label>
                                <select id="principioB" name="principioB" onchange="toggleCustomPrincipioB(this); actualizarResumen()">
                                    <option value="">Seleccione un principio</option>
                                    <option value="Autonomía de la voluntad">Autonomía de la voluntad</option>
                                    <option value="Buena fe">Buena fe</option>
                                    <option value="Igualdad">Igualdad</option>
                                    <option value="Libertad">Libertad</option>
                                    <option value="Seguridad jurídica">Seguridad jurídica</option>
                                    <option value="Proporcionalidad">Proporcionalidad</option>
                                    <option value="Razonabilidad">Razonabilidad</option>
                                    <option value="Legalidad">Legalidad</option>
                                    <option value="Dignidad humana">Dignidad humana</option>
                                    <option value="Debido proceso">Debido proceso</option>
                                    <option value="Defensa en juicio">Defensa en juicio</option>
                                    <option value="Publicidad">Publicidad</option>
                                    <option value="Economía procesal">Economía procesal</option>
                                    <option value="Celeridad">Celeridad</option>
                                    <option value="otro">Otro (especificar)</option>
                                </select>
                                <div id="customPrincipioBContainer" class="custom-input" style="display: none;">
                                    <label for="customPrincipioB">Especifique el principio:</label>
                                    <input type="text" id="customPrincipioB" name="customPrincipioB" placeholder="Ingrese el principio B..." onchange="actualizarResumen()" onkeyup="actualizarResumen()">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- b. Estructura de la ponderación -->
                <div style="margin-bottom: 20px;">
                    <div style="font-weight: 600; margin-bottom: 10px; color: var(--primary-color);">Estructura de la ponderación</div>
                    <div class="options-container">
                        <div class="checkbox-option">
                            <input type="checkbox" id="ponderacion-idoneidad" name="estructuraPonderacion" value="Idoneidad" onclick="actualizarResumen()">
                            <label for="ponderacion-idoneidad">Idoneidad</label>
                        </div>
                        <div class="checkbox-option">
                            <input type="checkbox" id="ponderacion-necesidad" name="estructuraPonderacion" value="Necesidad" onclick="actualizarResumen()">
                            <label for="ponderacion-necesidad">Necesidad</label>
                        </div>
                        <div class="checkbox-option">
                            <input type="checkbox" id="ponderacion-proporcionalidad" name="estructuraPonderacion" value="Proporcionalidad estricta" onclick="actualizarResumen()">
                            <label for="ponderacion-proporcionalidad">Proporcionalidad estricta</label>
                        </div>
                        <div class="checkbox-option">
                            <input type="checkbox" id="ponderacion-formula" name="estructuraPonderacion" value="Fórmula del peso implícita" onclick="actualizarResumen()">
                            <label for="ponderacion-formula">Fórmula del peso implícita</label>
                        </div>
                    </div>
                </div>
                
                <!-- c. Tipo de razonamiento -->
                <div style="margin-bottom: 5px;">
                    <div style="font-weight: 600; margin-bottom: 10px; color: var(--primary-color);">Tipo de razonamiento</div>
                    <div class="options-container">
                        <div class="checkbox-option">
                            <input type="checkbox" id="razonamiento-balance-explicito" name="tipoRazonamiento" value="Balance explícito" onclick="actualizarResumen()">
                            <label for="razonamiento-balance-explicito">Balance explícito</label>
                        </div>
                        <div class="checkbox-option">
                            <input type="checkbox" id="razonamiento-balance-implicito" name="tipoRazonamiento" value="Balance implícito" onclick="actualizarResumen()">
                            <label for="razonamiento-balance-implicito">Balance implícito</label>
                        </div>
                        <div class="checkbox-option">
                            <input type="checkbox" id="razonamiento-retorico" name="tipoRazonamiento" value="Retórico (sin estructura real)" onclick="actualizarResumen()">
                            <label for="razonamiento-retorico">Retórico (sin estructura real)</label>
                        </div>
                    </div>
                </div>
            </section>
            
            <!-- SECCIÓN 9: ERRORES DEL RAZONAMIENTO -->
            <section class="form-section" id="section9">
                <h2 class="section-title"><i class="fas fa-times-circle"></i> 9. Errores del razonamiento</h2>
                <div class="form-grid">
                    <div class="form-group full-width">
                        <!-- Falacias formales -->
                        <div style="margin-bottom: 15px;">
                            <div class="options-container">
                                <div class="checkbox-option"><input type="checkbox" id="error-afirmacion" name="erroresSilogismo" value="Afirmación del consecuente" onclick="actualizarResumen()"><label>Afirmación del consecuente</label></div>
                                <div class="checkbox-option"><input type="checkbox" id="error-negacion" name="erroresSilogismo" value="Negación del antecedente" onclick="actualizarResumen()"><label>Negación del antecedente</label></div>
                                <div class="checkbox-option"><input type="checkbox" id="error-silogismo" name="erroresSilogismo" value="Silogismo disyuntivo falaz" onclick="actualizarResumen()"><label>Silogismo disyuntivo falaz</label></div>
                            </div>
                        </div>
                        <!-- Argumentos de atinencia -->
                        <div style="margin-bottom: 15px;">
                            <div class="checkbox-option" style="background: #f8fafc;">
                                <input type="checkbox" id="atinencia-principal" name="argumentosAtinenciaPrincipal" onclick="toggleAtinencia(this); actualizarResumen()">
                                <label><strong>Argumentos de atinencia</strong></label>
                            </div>
                            <div id="atinenciaContainer" class="conditional-section" style="display: none; margin-left: 25px;">
                                <div class="method-grid">
                                    <div class="checkbox-option"><input type="checkbox" id="ad-baculum" name="argumentosAtinencia" value="Ad baculum" onclick="actualizarResumen()"><label>ad baculum</label></div>
                                    <div class="checkbox-option"><input type="checkbox" id="ad-hominem" name="argumentosAtinencia" value="Ad hominem" onclick="actualizarResumen()"><label>ad hominem</label></div>
                                    <div class="checkbox-option"><input type="checkbox" id="ad-ignorantiam" name="argumentosAtinencia" value="Ad ignorantiam" onclick="actualizarResumen()"><label>ad ignorantiam</label></div>
                                    <div class="checkbox-option"><input type="checkbox" id="ad-misericordiam" name="argumentosAtinencia" value="Ad misericordiam" onclick="actualizarResumen()"><label>ad misericordiam</label></div>
                                    <div class="checkbox-option"><input type="checkbox" id="ad-populum" name="argumentosAtinencia" value="Ad populum" onclick="actualizarResumen()"><label>ad populum</label></div>
                                    <div class="checkbox-option"><input type="checkbox" id="ad-verecundiam" name="argumentosAtinencia" value="Ad verecundiam" onclick="actualizarResumen()"><label>ad verecundiam</label></div>
                                    <div class="checkbox-option"><input type="checkbox" id="de-accidente" name="argumentosAtinencia" value="De accidente" onclick="actualizarResumen()"><label>de accidente</label></div>
                                    <div class="checkbox-option"><input type="checkbox" id="accidente-inverso" name="argumentosAtinencia" value="Del accidente inverso" onclick="actualizarResumen()"><label>Del accidente inverso</label></div>
                                    <div class="checkbox-option"><input type="checkbox" id="causa-falsa" name="argumentosAtinencia" value="Causa falsa" onclick="actualizarResumen()"><label>Causa falsa</label></div>
                                    <div class="checkbox-option"><input type="checkbox" id="petitio" name="argumentosAtinencia" value="Petitio principii" onclick="actualizarResumen()"><label>Petitio principii</label></div>
                                    <div class="checkbox-option"><input type="checkbox" id="pregunta-compleja" name="argumentosAtinencia" value="Pregunta compleja" onclick="actualizarResumen()"><label>Pregunta compleja</label></div>
                                    <div class="checkbox-option"><input type="checkbox" id="ignoratio" name="argumentosAtinencia" value="Ignoratio elenchi" onclick="actualizarResumen()"><label>Ignoratio elenchi</label></div>
                                </div>
                            </div>
                        </div>
                        <!-- Argumentos de ambigüedad -->
                        <div>
                            <div class="checkbox-option" style="background: #f8fafc;">
                                <input type="checkbox" id="ambiguedad-principal" name="argumentosAmbiguedadPrincipal" onclick="toggleAmbiguedad(this); actualizarResumen()">
                                <label><strong>Argumentos de ambigüedad</strong></label>
                            </div>
                            <div id="ambiguedadContainer" class="conditional-section" style="display: none; margin-left: 25px;">
                                <div class="method-grid">
                                    <div class="checkbox-option"><input type="checkbox" id="equivoco" name="argumentosAmbiguedad" value="Equívoco" onclick="actualizarResumen()"><label>Equívoco</label></div>
                                    <div class="checkbox-option"><input type="checkbox" id="anfibologia" name="argumentosAmbiguedad" value="Anfibología" onclick="actualizarResumen()"><label>Anfibología</label></div>
                                    <div class="checkbox-option"><input type="checkbox" id="enfasis" name="argumentosAmbiguedad" value="Énfasis" onclick="actualizarResumen()"><label>Énfasis</label></div>
                                    <div class="checkbox-option"><input type="checkbox" id="composicion" name="argumentosAmbiguedad" value="Composición" onclick="actualizarResumen()"><label>Composición</label></div>
                                    <div class="checkbox-option"><input type="checkbox" id="division" name="argumentosAmbiguedad" value="División" onclick="actualizarResumen()"><label>División</label></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
            
            <!-- SECCIÓN 10: OBSERVACIONES ADICIONALES -->
            <section class="form-section" id="section10">
                <h2 class="section-title"><i class="fas fa-sticky-note"></i> 10. Observaciones adicionales</h2>
                <div class="form-grid">
                    <div class="form-group full-width">
                        <textarea id="observaciones" name="observaciones" placeholder="Notas, comentarios u observaciones relevantes..." rows="4" onchange="actualizarResumen()" onkeyup="actualizarResumen()"></textarea>
                    </div>
                </div>
            </section>
            
            <!-- BOTONES -->
            <div class="buttons-container">
                <button type="button" class="btn btn-submit" onclick="guardarFallo()">
                    <i class="fas fa-save"></i> Guardar Fallo
                </button>
                
                <button type="button" class="btn btn-reset" onclick="resetForm()">
                    <i class="fas fa-redo"></i> Limpiar Formulario
                </button>
            </div>
        </form>
        
        <footer class="footer">
            <p>Instituto de Recursos Judiciales &copy; <span id="current-year"></span></p>
        </footer>
    </div>

    <script>
        // ============ FUNCIÓN PARA DESCARGAR PDF ============
        function descargarResumenPDF() {
            const { jsPDF } = window.jspdf;
            
            // Obtener el contenido del resumen
            const resumenContenido = document.getElementById('resumenRedactadoContenido');
            const resumenTexto = resumenContenido.innerText || resumenContenido.textContent;
            
            // Verificar si hay datos
            if (!resumenTexto || resumenTexto.includes('Complete el formulario')) {
                showStatus('No hay datos para generar el PDF. Complete el formulario primero.', 'error');
                return;
            }
            
            // Obtener la carátula para el nombre del archivo
            let caratula = document.getElementById('caratula').value || 'fallo';
            // Limpiar la carátula para el nombre de archivo (quitar caracteres especiales)
            caratula = caratula.replace(/[^a-zA-Z0-9]/g, '_').substring(0, 50);
            
            // Fecha para el nombre del archivo
            const fechaActual = new Date().toISOString().slice(0, 10);
            
            // Crear nuevo documento PDF
            const doc = new jsPDF({
                orientation: 'portrait',
                unit: 'mm',
                format: 'a4'
            });
            
            // Configurar fuentes y estilos
            doc.setFont('helvetica', 'bold');
            doc.setFontSize(16);
            doc.setTextColor(44, 62, 80); // Color primario
            
            // Título del documento
            doc.text('RESUMEN DE FALLO JUDICIAL', 20, 20);
            
            // Línea separadora
            doc.setDrawColor(52, 152, 219); // Color acento
            doc.setLineWidth(0.5);
            doc.line(20, 25, 190, 25);
            
            // Fecha de generación
            doc.setFont('helvetica', 'normal');
            doc.setFontSize(10);
            doc.setTextColor(100, 100, 100);
            const fechaHora = new Date().toLocaleDateString('es-AR', { 
                day: '2-digit', 
                month: '2-digit', 
                year: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            });
            doc.text(`Generado el: ${fechaHora}`, 20, 32);
            
            // Contenido del resumen (con ajuste de líneas)
            doc.setFont('helvetica', 'normal');
            doc.setFontSize(11);
            doc.setTextColor(50, 50, 50);
            
            // Dividir el texto en líneas que quepan en la página
            const lineas = doc.splitTextToSize(resumenTexto, 170);
            
            // Calcular posición inicial (después del título y fecha)
            let yPos = 40;
            
            // Agregar cada línea al PDF
            lineas.forEach(linea => {
                // Si llegamos al final de la página, agregar nueva página
                if (yPos > 280) {
                    doc.addPage();
                    yPos = 20;
                }
                doc.text(linea, 20, yPos);
                yPos += 7;
            });
            
            // Agregar pie de página
            doc.setFont('helvetica', 'italic');
            doc.setFontSize(8);
            doc.setTextColor(150, 150, 150);
            doc.text('Instituto de Recursos Judiciales - Sistema de Análisis de Fallos', 20, 285);
            doc.text('Documento generado automáticamente', 20, 290);
            
            // Guardar el PDF con el nombre solicitado
            const nombreArchivo = `resumen_fallo_${caratula}_${fechaActual}.pdf`;
            doc.save(nombreArchivo);
            
            showStatus('PDF generado correctamente', 'success');
        }

        // ============ FUNCIÓN PRINCIPAL DE ACTUALIZACIÓN ============
        function actualizarResumen() {
            const resumenRedactadoContenido = document.getElementById('resumenRedactadoContenido');
            const resumenBadge = document.getElementById('resumenBadge');
            const resumenFooter = document.getElementById('resumenFooter');
            
            const datos = recopilarDatosResumen();
            
            // Contar secciones completadas
            let contador = 0;
            if (datos.caratula) contador++;
            if (datos.numeroCausa) contador++;
            if (datos.integracion) contador++;
            if (datos.materiaPrincipal) contador++;
            if (datos.cuestionesFederales.length > 0) contador++;
            
            resumenBadge.textContent = contador > 0 ? `${contador} secciones` : 'Sin datos';
            
            // Si no hay datos
            if (!datos.caratula && !datos.numeroCausa && !datos.materiaPrincipal && datos.cuestionesFederales.length === 0) {
                resumenRedactadoContenido.innerHTML = '<span class="resumen-vacio">Complete el formulario para ver el resumen del fallo...</span>';
                resumenFooter.innerHTML = '';
                return;
            }
            
            // Determinar voto
            let votoTexto = '';
            if (datos.voto === 'unanimidad') votoTexto = 'Unanimidad';
            else if (datos.voto === 'mayoria') votoTexto = 'Mayoría';
            else if (datos.voto === 'disidencias') votoTexto = 'Con disidencias';
            
            // ===== GENERAR RESUMEN REDACTADO (NARRATIVO) =====
            let redactado = '';
            
            // Párrafo 1: Identificación y Tribunal
            redactado += `<p><strong>Identificación del fallo:</strong> `;
            redactado += `${datos.caratula || 'Fallo sin carátula'}`;
            if (datos.numeroCausa) redactado += `, causa N° ${datos.numeroCausa}`;
            if (datos.fallos) redactado += `, ${datos.fallos}`;
            if (datos.fecha) redactado += `, con fecha ${datos.fecha}`;
            redactado += `. `;
            
            if (datos.integracion) {
                redactado += `El tribunal estuvo integrado por ${datos.integracion}. `;
            }
            
            if (votoTexto) {
                redactado += `La decisión fue adoptada <strong>${votoTexto}</strong>`;
                if (datos.detalleDisidencias && votoTexto === 'Con disidencias') {
                    redactado += `, ${datos.detalleDisidencias}`;
                } else if (datos.detalleDisidencias) {
                    redactado += `, ${datos.detalleDisidencias}`;
                }
                redactado += `. `;
            }
            redactado += `</p>`;
            
            // Párrafo 2: Admisibilidad
            if (datos.admisibilidad === 'no') {
                redactado += `<p><strong>Admisibilidad:</strong> El recurso fue declarado inadmisible`;
                if (datos.motivoInadmisible) {
                    redactado += ` por ${datos.motivoInadmisible}`;
                }
                if (datos.argumentoCorte) {
                    redactado += `. La Corte se expidió con el siguiente argumento: "${datos.argumentoCorte}"`;
                }
                redactado += `.</p>`;
            } else if (datos.admisibilidad === 'si') {
                redactado += `<p><strong>Admisibilidad:</strong> El recurso fue admitido.</p>`;
            }
            
            // Si la admisibilidad es NO, solo mostramos observaciones después de esto
            if (datos.admisibilidad === 'no') {
                // No mostramos las secciones 3-9
                if (datos.observaciones) {
                    redactado += `<p><strong>Observaciones:</strong> ${datos.observaciones}</p>`;
                }
            } else {
                // Si la admisibilidad es SI o no está definida, mostramos todo
                
                // Párrafo 3: Materia y Cuestión Federal
                redactado += `<p><strong>Materia y cuestión federal:</strong> `;
                if (datos.materiaPrincipal) {
                    redactado += `La materia principal del caso es ${datos.materiaPrincipal}`;
                    if (datos.subtema) redactado += `, en particular sobre ${datos.subtema}`;
                    redactado += `. `;
                }
                
                if (datos.cuestionesFederales.length > 0) {
                    redactado += `Se plantea${datos.cuestionesFederales.length > 1 ? 'n' : ''} cuestión${datos.cuestionesFederales.length > 1 ? 'es' : ''} federal consistente en `;
                    redactado += datos.cuestionesFederales.join(', ') + '. ';
                }
                redactado += `</p>`;
                
                // Párrafo 4: Arbitrariedad (detalles)
                if (datos.arbitrariedadCausales.length > 0) {
                    redactado += `<p><strong>Arbitrariedad:</strong> Se configura${datos.arbitrariedadCausales.length > 1 ? 'n' : ''} ${datos.arbitrariedadCausales.length} causal${datos.arbitrariedadCausales.length !== 1 ? 'es' : ''} de arbitrariedad: `;
                    redactado += datos.arbitrariedadCausales.join(', ') + '. ';
                    
                    if (datos.opcionesFundamentacion.length > 0) {
                        redactado += ` En particular, la falta de fundamentación se manifiesta en: ${datos.opcionesFundamentacion.join(', ')}. `;
                    }
                    if (datos.opcionesNormativa.length > 0) {
                        redactado += ` Los defectos normativos consisten en: ${datos.opcionesNormativa.join(', ')}. `;
                    }
                    if (datos.arbitrariedadFactica.length > 0) {
                        redactado += ` La arbitrariedad fáctica es de tipo: ${datos.arbitrariedadFactica.join(', ')}. `;
                    }
                    if (datos.logicaAdicional) {
                        redactado += ` ${datos.logicaAdicional}. `;
                    }
                    redactado += `</p>`;
                }
                
                // ===== NUEVOS PÁRRAFOS PARA SECCIONES 5-9 =====
                
                // Párrafo 5: Tipo de desacuerdo
                if (datos.desacuerdos && datos.desacuerdos.length > 0) {
                    redactado += `<p><strong>Tipo de desacuerdo:</strong> ${datos.desacuerdos.join(', ')}. </p>`;
                }
                
                // Párrafo 6: Problema jurídico
                if (datos.problemas && datos.problemas.length > 0) {
                    redactado += `<p><strong>Problema jurídico:</strong> ${datos.problemas.join(', ')}. `;
                    if (datos.rolPrueba) {
                        redactado += `La prueba cumple un rol <strong>${datos.rolPrueba.toLowerCase()}</strong> en la decisión. `;
                    }
                    if (datos.tipoInferencias && datos.tipoInferencias.length > 0) {
                        redactado += `Se detectaron inferencias probatorias de tipo: ${datos.tipoInferencias.join(', ')}. `;
                    }
                    redactado += `</p>`;
                }
                
                // Párrafo 7: Método interpretativo
                if (datos.metodoInterpretativo && datos.metodoInterpretativo.length > 0) {
                    redactado += `<p><strong>Método interpretativo:</strong> ${datos.metodoInterpretativo.join(', ')}. </p>`;
                }
                
                // Párrafo 8: Ponderación
                if (datos.colisionPrincipios === 'si' && datos.principioA && datos.principioB) {
                    redactado += `<p><strong>Colisión de principios:</strong> Se verifica una colisión entre el principio de ${datos.principioA} y el principio de ${datos.principioB}. `;
                }
                if (datos.estructuraPonderacion && datos.estructuraPonderacion.length > 0) {
                    redactado += `La ponderación utiliza: ${datos.estructuraPonderacion.join(', ')}. `;
                }
                if (datos.tipoRazonamiento && datos.tipoRazonamiento.length > 0) {
                    redactado += `El razonamiento es de tipo: ${datos.tipoRazonamiento.join(', ')}. `;
                }
                if ((datos.colisionPrincipios === 'si' && datos.principioA && datos.principioB) || 
                    (datos.estructuraPonderacion && datos.estructuraPonderacion.length > 0) || 
                    (datos.tipoRazonamiento && datos.tipoRazonamiento.length > 0)) {
                    redactado += `</p>`;
                }
                
                // Párrafo 9: Errores del razonamiento
                let erroresTotales = 0;
                if (datos.erroresSilogismo) erroresTotales += datos.erroresSilogismo.length;
                if (datos.argumentosAtinencia) erroresTotales += datos.argumentosAtinencia.length;
                if (datos.argumentosAmbiguedad) erroresTotales += datos.argumentosAmbiguedad.length;
                
                if (erroresTotales > 0) {
                    redactado += `<p><strong>Errores del razonamiento:</strong> Se detectaron ${erroresTotales} error(es) en el razonamiento. `;
                    
                    if (datos.erroresSilogismo && datos.erroresSilogismo.length > 0) {
                        redactado += `Falacias formales: ${datos.erroresSilogismo.join(', ')}. `;
                    }
                    if (datos.argumentosAtinencia && datos.argumentosAtinencia.length > 0) {
                        redactado += `Argumentos de atinencia: ${datos.argumentosAtinencia.join(', ')}. `;
                    }
                    if (datos.argumentosAmbiguedad && datos.argumentosAmbiguedad.length > 0) {
                        redactado += `Argumentos de ambigüedad: ${datos.argumentosAmbiguedad.join(', ')}. `;
                    }
                    redactado += `</p>`;
                }
                
                // Párrafo 10: Observaciones
                if (datos.observaciones) {
                    redactado += `<p><strong>Observaciones:</strong> ${datos.observaciones}</p>`;
                }
            }
            
            resumenRedactadoContenido.innerHTML = redactado;
            resumenFooter.innerHTML = `
                <div class="resumen-footer-left">
                    <i class="fas fa-clock"></i> Actualizado: ${new Date().toLocaleTimeString('es-AR')}
                    <span><i class="fas fa-university"></i> Instituto de Recursos Judiciales</span>
                </div>
                <div class="resumen-footer-right">
                    <i class="fas fa-file-signature"></i> Análisis en tiempo real
                </div>
            `;
        }

        // ============ FUNCIÓN PARA DESHABILITAR SECCIONES ============
        function deshabilitarSecciones(deshabilitar) {
            const secciones = ['section3', 'section4', 'section5', 'section6', 'section7', 'section8', 'section9'];
            secciones.forEach(id => {
                const seccion = document.getElementById(id);
                if (seccion) {
                    if (deshabilitar) {
                        seccion.classList.add('disabled');
                        // Deshabilitar todos los inputs dentro de la sección
                        seccion.querySelectorAll('input, select, textarea').forEach(input => {
                            input.disabled = true;
                        });
                    } else {
                        seccion.classList.remove('disabled');
                        // Habilitar todos los inputs dentro de la sección
                        seccion.querySelectorAll('input, select, textarea').forEach(input => {
                            input.disabled = false;
                        });
                    }
                }
            });
        }

        // ============ RECOPILACIÓN DE DATOS ============
        function recopilarDatosResumen() {
            const datos = {
                caratula: document.getElementById('caratula').value || '',
                numeroCausa: document.getElementById('numeroCausa')?.value || '',
                fallos: document.getElementById('fallos')?.value || '',
                fecha: document.getElementById('fecha').value ? new Date(document.getElementById('fecha').value).toLocaleDateString('es-AR', { timeZone: 'UTC' }) : '',
                integracion: document.getElementById('integracion').value || '',
                voto: document.querySelector('input[name="voto"]:checked')?.value || '',
                detalleDisidencias: document.getElementById('detalleDisidencias')?.value || '',
                admisibilidad: document.querySelector('input[name="admisibilidad"]:checked')?.value || '',
                motivoInadmisible: document.getElementById('motivoInadmisible')?.value || '',
                argumentoCorte: document.getElementById('argumentoCorte')?.value || '',
                materiaPrincipal: '',
                subtema: document.getElementById('subtemaTexto')?.value || '',
                cuestionesFederales: [],
                observaciones: document.getElementById('observaciones').value || '',
                arbitrariedadCausales: [],
                opcionesFundamentacion: [],
                opcionesNormativa: [],
                arbitrariedadFactica: [],
                logicaAdicional: '',
                desacuerdos: [],
                problemas: [],
                rolPrueba: '',
                tipoInferencias: [],
                metodoInterpretativo: [],
                colisionPrincipios: '',
                principioA: '',
                principioB: '',
                estructuraPonderacion: [],
                tipoRazonamiento: [],
                erroresSilogismo: [],
                argumentosAtinencia: [],
                argumentosAmbiguedad: []
            };

            // Solo recopilar datos si la admisibilidad es SI o no está definida
            if (datos.admisibilidad !== 'no') {
                // MATERIA PRINCIPAL (desde combo)
                const materiaSelect = document.getElementById('materiaPrincipal');
                if (materiaSelect.value) {
                    if (materiaSelect.value === 'otro') {
                        datos.materiaPrincipal = document.getElementById('materiaPrincipalOtra')?.value || 'Otra (sin especificar)';
                    } else {
                        datos.materiaPrincipal = materiaSelect.options[materiaSelect.selectedIndex]?.text || '';
                    }
                }

                // CUESTIONES FEDERALES - Arbitrariedad
                if (document.getElementById('cuest-arbitrariedad')?.checked) {
                    // Normativa
                    if (document.getElementById('cuest-arbitrariedad-normativa')?.checked) {
                        datos.arbitrariedadCausales.push('Arbitrariedad normativa');
                        
                        if (document.getElementById('cuest-fundamentacion')?.checked) {
                            datos.cuestionesFederales.push('Falta de fundamentación suficiente');
                            document.querySelectorAll('#fundamentacionCuestContainer input[type="checkbox"]:checked').forEach(sub => {
                                datos.opcionesFundamentacion.push(sub.nextElementSibling.textContent.trim());
                            });
                        }
                        if (document.getElementById('cuest-defectos-normativa')?.checked) {
                            datos.cuestionesFederales.push('Defectos en la fundamentación normativa');
                            document.querySelectorAll('#defectosNormativaCuestContainer input[type="checkbox"]:checked').forEach(sub => {
                                datos.opcionesNormativa.push(sub.nextElementSibling.textContent.trim());
                            });
                        }
                    }
                    
                    // Fáctica
                    if (document.getElementById('cuest-arbitrariedad-factica')?.checked) {
                        datos.arbitrariedadCausales.push('Arbitrariedad fáctica');
                        document.querySelectorAll('input[name="arbitrariedadFacticaCuest"]:checked').forEach(cb => {
                            datos.arbitrariedadFactica.push(cb.value);
                            datos.cuestionesFederales.push(`Arbitrariedad fáctica - ${cb.value}`);
                        });
                    }
                    
                    // Lógica
                    if (document.getElementById('cuest-arbitrariedad-logica')?.checked) {
                        if (document.getElementById('cuest-logica-contradiccion')?.checked) {
                            datos.cuestionesFederales.push('Contradicción');
                            datos.arbitrariedadCausales.push('Contradicción');
                        }
                        if (document.getElementById('cuest-logica-otra')?.checked) {
                            let otraLogica = document.getElementById('logicaOtraTexto')?.value;
                            if (otraLogica) {
                                datos.cuestionesFederales.push(`Error lógico: ${otraLogica}`);
                                datos.arbitrariedadCausales.push(`Error lógico: ${otraLogica}`);
                                datos.logicaAdicional = `Error lógico adicional: ${otraLogica}`;
                            }
                        }
                    }
                    
                    // Otras
                    if (document.getElementById('cuest-arbitrariedad-otras')?.checked) {
                        document.querySelectorAll('input[name="arbitrariedadOtras"]:checked').forEach(cb => {
                            datos.cuestionesFederales.push(cb.value);
                            datos.arbitrariedadCausales.push(cb.value);
                        });
                    }
                }
                
                // TIPO DE DESACUERDO
                document.querySelectorAll('input[name="tipoDesacuerdo"]:checked').forEach(cb => {
                    datos.desacuerdos.push(cb.nextElementSibling.textContent.trim());
                });
                
                // PROBLEMA JURÍDICO
                document.querySelectorAll('input[name="problemaJuridico"]:checked').forEach(cb => {
                    datos.problemas.push(cb.nextElementSibling.textContent.trim());
                });
                
                datos.rolPrueba = document.querySelector('input[name="rolPrueba"]:checked')?.value || '';
                
                document.querySelectorAll('input[name="tipoInferencias"]:checked').forEach(cb => {
                    datos.tipoInferencias.push(cb.nextElementSibling.textContent.trim());
                });
                
                // MÉTODO INTERPRETATIVO
                document.querySelectorAll('input[name="metodoInterpretativo"]:checked').forEach(cb => {
                    datos.metodoInterpretativo.push(cb.nextElementSibling.textContent.trim());
                });
                
                // PONDERACIÓN
                datos.colisionPrincipios = document.querySelector('input[name="colisionPrincipios"]:checked')?.value || '';
                
                if (datos.colisionPrincipios === 'si') {
                    datos.principioA = obtenerValorConPersonalizado('principioA', 'customPrincipioA');
                    datos.principioB = obtenerValorConPersonalizado('principioB', 'customPrincipioB');
                }
                
                document.querySelectorAll('input[name="estructuraPonderacion"]:checked').forEach(cb => {
                    datos.estructuraPonderacion.push(cb.nextElementSibling.textContent.trim());
                });
                
                document.querySelectorAll('input[name="tipoRazonamiento"]:checked').forEach(cb => {
                    datos.tipoRazonamiento.push(cb.nextElementSibling.textContent.trim());
                });
                
                // ERRORES
                document.querySelectorAll('input[name="erroresSilogismo"]:checked').forEach(cb => {
                    datos.erroresSilogismo.push(cb.nextElementSibling.textContent.trim());
                });
                
                if (document.getElementById('atinencia-principal')?.checked) {
                    document.querySelectorAll('#atinenciaContainer input[type="checkbox"]:checked').forEach(cb => {
                        datos.argumentosAtinencia.push(cb.nextElementSibling.textContent.trim());
                    });
                }
                
                if (document.getElementById('ambiguedad-principal')?.checked) {
                    document.querySelectorAll('#ambiguedadContainer input[type="checkbox"]:checked').forEach(cb => {
                        datos.argumentosAmbiguedad.push(cb.nextElementSibling.textContent.trim());
                    });
                }
            }

            return datos;
        }

        // ============ FUNCIONES AUXILIARES ============
        function obtenerValorConPersonalizado(selectId, customInputId) {
            let s = document.getElementById(selectId);
            if (!s) return '';
            if (s.value === 'otro') { 
                let c = document.getElementById(customInputId); 
                return c ? c.value : ''; 
            }
            return s.options[s.selectedIndex]?.text || '';
        }

        // ============ TOGGLES ============
        function toggleMateriaPrincipal(select) {
            let c = document.getElementById('materiaPrincipalOtraContainer');
            if (select.value === 'otro') {
                c.style.display = 'block';
            } else {
                c.style.display = 'none';
                document.getElementById('materiaPrincipalOtra').value = '';
            }
            actualizarResumen();
        }
        
        function toggleDisidencias(m) {
            let c = document.getElementById('disidenciasContainer');
            if (m) c.classList.add('active');
            else { 
                c.classList.remove('active'); 
                document.getElementById('detalleDisidencias').value = ''; 
            }
            actualizarResumen();
        }
        
        function toggleAdmisibilidad(esSi) {
            let c = document.getElementById('admisibilidadNoContainer');
            if (!esSi) {
                c.style.display = 'block';
                // Deshabilitar secciones 3-9
                deshabilitarSecciones(true);
            } else {
                c.style.display = 'none';
                document.getElementById('motivoInadmisible').value = '';
                document.getElementById('argumentoCorte').value = '';
                // Habilitar secciones 3-9
                deshabilitarSecciones(false);
            }
            actualizarResumen();
        }
        
        function toggleArbitrariedadCuest(cb) {
            let c = document.getElementById('arbitrariedadCuestContainer');
            if (cb.checked) c.style.display = 'block';
            else { 
                c.style.display = 'none'; 
                // Limpiar todos los checkboxes dentro
                c.querySelectorAll('input[type="checkbox"]').forEach(cb => cb.checked = false);
                document.getElementById('normativaSubopcionesContainer').style.display = 'none';
                document.getElementById('fundamentacionCuestContainer').style.display = 'none';
                document.getElementById('defectosNormativaCuestContainer').style.display = 'none';
                document.getElementById('arbitrariedadFacticaCuestContainer').style.display = 'none';
                document.getElementById('logicaCuestContainer').style.display = 'none';
                document.getElementById('logicaOtraContainer').style.display = 'none';
                document.getElementById('otrasCuestContainer').style.display = 'none';
            }
            actualizarResumen();
        }
        
        function toggleNormativaCuest(cb) {
            let c = document.getElementById('normativaSubopcionesContainer');
            if (cb.checked) {
                c.style.display = 'block';
            } else {
                c.style.display = 'none';
                // Limpiar subopciones
                document.getElementById('cuest-fundamentacion').checked = false;
                document.getElementById('cuest-defectos-normativa').checked = false;
                document.getElementById('fundamentacionCuestContainer').style.display = 'none';
                document.getElementById('defectosNormativaCuestContainer').style.display = 'none';
                // Limpiar checkboxes hijos
                document.querySelectorAll('#fundamentacionCuestContainer input[type="checkbox"]').forEach(cb => cb.checked = false);
                document.querySelectorAll('#defectosNormativaCuestContainer input[type="checkbox"]').forEach(cb => cb.checked = false);
            }
            actualizarResumen();
        }
        
        function toggleFundamentacionCuest(cb) {
            let c = document.getElementById('fundamentacionCuestContainer');
            if (cb.checked) c.style.display = 'block';
            else { 
                c.style.display = 'none'; 
                c.querySelectorAll('input[type="checkbox"]').forEach(cb => cb.checked = false);
            }
            actualizarResumen();
        }
        
        function toggleDefectosNormativaCuest(cb) {
            let c = document.getElementById('defectosNormativaCuestContainer');
            if (cb.checked) c.style.display = 'block';
            else { 
                c.style.display = 'none'; 
                c.querySelectorAll('input[type="checkbox"]').forEach(cb => cb.checked = false);
            }
            actualizarResumen();
        }
        
        function toggleArbitrariedadFacticaCuest(cb) {
            let c = document.getElementById('arbitrariedadFacticaCuestContainer');
            if (cb.checked) c.style.display = 'block';
            else { 
                c.style.display = 'none'; 
                c.querySelectorAll('input[type="checkbox"]').forEach(cb => cb.checked = false);
            }
            actualizarResumen();
        }
        
        function toggleLogicaCuest(cb) {
            let c = document.getElementById('logicaCuestContainer');
            if (cb.checked) c.style.display = 'block';
            else { 
                c.style.display = 'none'; 
                document.getElementById('cuest-logica-contradiccion').checked = false;
                document.getElementById('cuest-logica-otra').checked = false;
                document.getElementById('logicaOtraContainer').style.display = 'none';
                document.getElementById('logicaOtraTexto').value = '';
            }
            actualizarResumen();
        }
        
        function toggleLogicaOtra(cb) {
            let c = document.getElementById('logicaOtraContainer');
            if (cb.checked) c.style.display = 'block';
            else { 
                c.style.display = 'none'; 
                document.getElementById('logicaOtraTexto').value = ''; 
            }
            actualizarResumen();
        }
        
        function toggleOtrasCuest(cb) {
            let c = document.getElementById('otrasCuestContainer');
            if (cb.checked) c.style.display = 'block';
            else { 
                c.style.display = 'none'; 
                c.querySelectorAll('input[type="checkbox"]').forEach(cb => cb.checked = false);
            }
            actualizarResumen();
        }
        
        function toggleCustomPrincipioA(s) {
            let c = document.getElementById('customPrincipioAContainer');
            c.style.display = s.value === 'otro' ? 'block' : 'none';
            if (s.value !== 'otro') document.getElementById('customPrincipioA').value = '';
            actualizarResumen();
        }
        
        function toggleCustomPrincipioB(s) {
            let c = document.getElementById('customPrincipioBContainer');
            c.style.display = s.value === 'otro' ? 'block' : 'none';
            if (s.value !== 'otro') document.getElementById('customPrincipioB').value = '';
            actualizarResumen();
        }
        
        function toggleAtinencia(cb) {
            let c = document.getElementById('atinenciaContainer');
            if (cb.checked) c.style.display = 'block';
            else { 
                c.style.display = 'none'; 
                c.querySelectorAll('input[type="checkbox"]').forEach(cb => cb.checked = false);
            }
            actualizarResumen();
        }
        
        function toggleAmbiguedad(cb) {
            let c = document.getElementById('ambiguedadContainer');
            if (cb.checked) c.style.display = 'block';
            else { 
                c.style.display = 'none'; 
                c.querySelectorAll('input[type="checkbox"]').forEach(cb => cb.checked = false);
            }
            actualizarResumen();
        }
        
        function toggleCollapsible(e) {
            e.classList.toggle('active');
            e.nextElementSibling.classList.toggle('active');
        }
        
        function togglePrincipiosContainer(m) {
            let c = document.getElementById('principiosContainer');
            if (m) c.style.display = 'block';
            else { 
                c.style.display = 'none'; 
                document.getElementById('principioA').value = ''; 
                document.getElementById('principioB').value = ''; 
                document.getElementById('customPrincipioA').value = ''; 
                document.getElementById('customPrincipioB').value = ''; 
                document.getElementById('customPrincipioAContainer').style.display = 'none'; 
                document.getElementById('customPrincipioBContainer').style.display = 'none'; 
            }
            actualizarResumen();
        }
        
        function toggleProbatorio(m) {
            let c = document.getElementById('probatorioContainer');
            let chk = document.getElementById('problema-probatorio');
            if (m && chk.checked) c.classList.add('active');
            else { 
                c.classList.remove('active'); 
                c.querySelectorAll('input').forEach(i => { 
                    if (i.type === 'checkbox' || i.type === 'radio') i.checked = false; 
                }); 
            }
            actualizarResumen();
        }

        // ============ GUARDADO Y RESET ============
        function validarProblemaJuridico() { 
            return document.querySelectorAll('input[name="problemaJuridico"]:checked').length > 0; 
        }
        
        function guardarFallo() {
            let c = document.getElementById('caratula').value;
            let nc = document.getElementById('numeroCausa').value;
            let f = document.getElementById('fecha').value;
            if (!c || !nc || !f) {
                showStatus('Complete los campos obligatorios: Carátula, Número de causa y Fecha', 'error');
                return;
            }
            showStatus(`Fallo "${c}" procesado correctamente`, 'success');
        }

        function showStatus(m, t) {
            let s = document.getElementById('statusMessage');
            s.textContent = m;
            s.className = `status-message status-${t}`;
            s.style.display = 'block';
            setTimeout(() => s.style.display = 'none', 5000);
        }

        function resetForm() {
            if (confirm('¿Limpiar todo el formulario?')) {
                document.getElementById('fallosForm').reset();
                document.querySelectorAll('.conditional-section, .custom-input').forEach(el => { 
                    el.classList.remove('active'); 
                    el.style.display = 'none'; 
                });
                document.querySelectorAll('.collapsible-content').forEach(c => c.classList.remove('active'));
                document.querySelectorAll('.collapsible-header').forEach(h => h.classList.remove('active'));
                
                // Ocultar contenedores específicos
                document.getElementById('admisibilidadNoContainer').style.display = 'none';
                document.getElementById('arbitrariedadCuestContainer').style.display = 'none';
                document.getElementById('normativaSubopcionesContainer').style.display = 'none';
                document.getElementById('fundamentacionCuestContainer').style.display = 'none';
                document.getElementById('defectosNormativaCuestContainer').style.display = 'none';
                document.getElementById('arbitrariedadFacticaCuestContainer').style.display = 'none';
                document.getElementById('logicaCuestContainer').style.display = 'none';
                document.getElementById('logicaOtraContainer').style.display = 'none';
                document.getElementById('otrasCuestContainer').style.display = 'none';
                document.getElementById('materiaPrincipalOtraContainer').style.display = 'none';
                document.getElementById('principiosContainer').style.display = 'none';
                
                // Habilitar todas las secciones
                deshabilitarSecciones(false);
                
                actualizarResumen();
                showStatus('Formulario limpiado correctamente', 'success');
            }
        }

        // ============ INICIALIZACIÓN ============
        document.getElementById('current-year').textContent = new Date().getFullYear();
        document.getElementById('fecha').valueAsDate = new Date();
        
        document.addEventListener('DOMContentLoaded', function() {
            document.querySelectorAll('.custom-input').forEach(el => el.style.display = 'none');
            document.getElementById('admisibilidadNoContainer').style.display = 'none';
            document.getElementById('arbitrariedadCuestContainer').style.display = 'none';
            document.getElementById('normativaSubopcionesContainer').style.display = 'none';
            document.getElementById('principiosContainer').style.display = 'none';
            actualizarResumen();
        });
    </script>
</body>
</html>
