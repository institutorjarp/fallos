<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Instituto de Recursos Judiciales, Argumentación y Razonamiento Probatorio - Sistema de Carga de Fallos</title>
    <link rel="icon" type="image/png" sizes="32x32" href="favicon.png">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&family=Playfair+Display:wght@500;600;700&display=swap" rel="stylesheet">
    
    <style>
        /* ===== VARIABLES Y RESET ===== */
        :root {
            --primary-color: #2c3e50;
            --secondary-color: #34495e;
            --accent-color: #3498db;
            --success-color: #27ae60;
            --warning-color: #f39c12;
            --danger-color: #e74c3c;
            --light-color: #ecf0f1;
            --dark-color: #2c3e50;
            --border-color: #bdc3c7;
            --shadow: 0 1px 4px rgba(0, 0, 0, 0.05);
            --border-radius: 4px;
            --transition: all 0.2s ease;
            --gray-600: #718096;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Roboto', sans-serif;
            background-color: #f8f9fa;
            color: #333;
            line-height: 1.5;
            padding: 15px;
            font-size: 14px;
        }
        
        .container {
            max-width: 1100px;
            margin: 0 auto;
        }
        
        /* ===== HEADER PROFESIONAL ===== */
        .header {
            margin-bottom: 25px;
            padding: 0;
            border-radius: var(--border-radius);
            overflow: hidden;
            box-shadow: var(--shadow);
        }
        
        .header-top {
            background: linear-gradient(135deg, #1a2634, #2c3e50);
            color: white;
            padding: 25px 30px;
            text-align: center;
            border-bottom: 3px solid var(--accent-color);
        }
        
        .instituto-nombre {
            font-size: 1.3rem;
            font-weight: 400;
            letter-spacing: 1px;
            margin-bottom: 10px;
            font-family: 'Playfair Display', serif;
            opacity: 0.95;
        }
        
        .sistema-titulo {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            font-family: 'Playfair Display', serif;
        }
        
        .sistema-titulo i {
            color: var(--accent-color);
            font-size: 1.8rem;
        }
        
        .header-subtitle {
            font-size: 1rem;
            opacity: 0.9;
            max-width: 700px;
            margin: 0 auto;
            font-style: italic;
        }
        
        .header-footer {
            background-color: var(--secondary-color);
            color: white;
            padding: 10px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.85rem;
        }
        
        .badge {
            background-color: var(--accent-color);
            color: white;
            padding: 4px 10px;
            border-radius: 20px;
            font-weight: 500;
            font-size: 0.8rem;
        }
        
        /* ===== PANEL DE RESUMEN - DOS COLUMNAS CON ENCABEZADO ===== */
        .resumen-panel {
            background: white;
            border-radius: var(--border-radius);
            padding: 25px 30px;
            margin-bottom: 30px;
            box-shadow: var(--shadow);
            border: 1px solid #e9ecef;
            border-left: 5px solid var(--accent-color);
        }
        
        .resumen-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 12px;
            border-bottom: 1px solid #edf2f7;
            color: var(--gray-600);
            font-size: 0.85rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .resumen-badge {
            background: var(--light-color);
            padding: 5px 15px;
            border-radius: 30px;
            font-weight: 600;
            font-size: 0.8rem;
            color: var(--primary-color);
        }
        
        /* ENCABEZADO DEL FALLO */
        .resumen-encabezado {
            background: linear-gradient(to right, #f8fafc, #ffffff);
            border-radius: 8px;
            padding: 16px 20px;
            margin-bottom: 20px;
            border: 1px solid #e2e8f0;
            display: flex;
            flex-wrap: wrap;
            align-items: center;
            gap: 20px;
        }
        
        .resumen-encabezado-icono {
            background: var(--accent-color);
            color: white;
            width: 50px;
            height: 50px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            flex-shrink: 0;
        }
        
        .resumen-encabezado-contenido {
            flex: 1;
        }
        
        .resumen-encabezado-titulo {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--primary-color);
            margin-bottom: 6px;
            font-family: 'Playfair Display', serif;
        }
        
        .resumen-encabezado-detalle {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            color: var(--gray-600);
            font-size: 0.9rem;
        }
        
        .resumen-encabezado-detalle i {
            color: var(--accent-color);
            margin-right: 6px;
        }
        
        .resumen-encabezado-badge {
            background: #e6f7e6;
            color: var(--success-color);
            padding: 6px 14px;
            border-radius: 30px;
            font-size: 0.8rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 6px;
        }
        
        /* CONTENIDO A DOS COLUMNAS */
        .resumen-columnas {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 25px;
            margin-top: 5px;
        }
        
        .resumen-columna {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        
        .resumen-seccion {
            background: #f8fafc;
            border-radius: 8px;
            padding: 16px 18px;
            border: 1px solid #edf2f7;
        }
        
        .resumen-seccion-titulo {
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: 600;
            color: var(--primary-color);
            font-size: 0.85rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 12px;
            padding-bottom: 8px;
            border-bottom: 1px solid #e2e8f0;
        }
        
        .resumen-seccion-titulo i {
            color: var(--accent-color);
            font-size: 0.9rem;
        }
        
        .resumen-item {
            display: flex;
            align-items: flex-start;
            margin-bottom: 10px;
            padding-bottom: 8px;
            border-bottom: 1px dashed #edf2f7;
        }
        
        .resumen-item:last-child {
            border-bottom: none;
            margin-bottom: 0;
            padding-bottom: 0;
        }
        
        .resumen-icono {
            width: 24px;
            color: var(--accent-color);
            margin-right: 12px;
            text-align: center;
            font-size: 0.9rem;
            flex-shrink: 0;
        }
        
        .resumen-label {
            font-weight: 600;
            color: var(--secondary-color);
            min-width: 110px;
            flex-shrink: 0;
            font-size: 0.85rem;
        }
        
        .resumen-valor {
            color: #2d3748;
            word-break: break-word;
            flex: 1;
            line-height: 1.5;
            font-size: 0.9rem;
        }
        
        .resumen-chip {
            display: inline-block;
            background: #edf2f7;
            padding: 3px 12px;
            border-radius: 30px;
            font-size: 0.8rem;
            margin: 2px 6px 2px 0;
            color: #2d3748;
            border: 1px solid #e2e8f0;
            transition: all 0.1s ease;
        }
        
        .resumen-chip i {
            margin-right: 5px;
            color: var(--accent-color);
            font-size: 0.7rem;
        }
        
        .resumen-chip:hover {
            background: #e2e8f0;
            border-color: #cbd5e0;
        }
        
        .resumen-vacio {
            color: var(--gray-600);
            font-style: italic;
            padding: 30px;
            text-align: center;
            background: #f8fafc;
            border-radius: 8px;
            grid-column: 1 / -1;
        }
        
        .resumen-footer {
            margin-top: 25px;
            padding-top: 15px;
            border-top: 1px solid #edf2f7;
            font-size: 0.75rem;
            color: var(--gray-600);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .resumen-footer-left {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .resumen-footer-left i {
            color: var(--accent-color);
        }
        
        .resumen-footer-right {
            font-weight: 600;
            color: var(--accent-color);
            background: #e6f0fa;
            padding: 5px 15px;
            border-radius: 30px;
        }
        
        /* ===== FORMULARIOS ===== */
        .form-section {
            background: white;
            border-radius: var(--border-radius);
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: var(--shadow);
            transition: var(--transition);
        }
        
        .form-section:hover {
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        }
        
        .section-title {
            font-size: 1.4rem;
            color: var(--primary-color);
            margin-bottom: 18px;
            padding-bottom: 8px;
            border-bottom: 2px solid var(--accent-color);
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .section-title i {
            color: var(--accent-color);
            font-size: 1.2rem;
        }
        
        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 18px;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        .form-group.full-width {
            grid-column: 1 / -1;
        }
        
        label {
            display: block;
            margin-bottom: 6px;
            font-weight: 500;
            color: var(--secondary-color);
            font-size: 0.95rem;
        }
        
        .required::after {
            content: " *";
            color: var(--danger-color);
        }
        
        input[type="text"],
        input[type="date"],
        textarea,
        select {
            width: 100%;
            padding: 10px 12px;
            border: 1.5px solid var(--border-color);
            border-radius: var(--border-radius);
            font-size: 0.90rem;
            transition: var(--transition);
            background-color: white;
        }
        
        input[type="text"]:focus,
        input[type="date"]:focus,
        textarea:focus,
        select:focus {
            outline: none;
            border-color: var(--accent-color);
            box-shadow: 0 0 0 2px rgba(52,152,219,0.1);
        }
        
        select option[value="otro"] {
            font-style: italic;
            color: #666;
        }
        
        .custom-input {
            margin-top: 10px;
            animation: fadeIn 0.3s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-5px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        textarea {
            min-height: 100px;
            resize: vertical;
        }
        
        .option-group {
            background: #f8f9fa;
            padding: 15px;
            border-radius: var(--border-radius);
            border: 1px solid #e9ecef;
        }
        
        .option-title {
            font-weight: 600;
            margin-bottom: 12px;
            color: var(--primary-color);
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.95rem;
        }
        
        .option-title i {
            color: var(--accent-color);
            font-size: 1rem;
        }
        
        .options-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
            gap: 10px;
        }
        
        .checkbox-option,
        .radio-option {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px;
            background: white;
            border-radius: 5px;
            border: 1px solid var(--border-color);
            transition: var(--transition);
            cursor: pointer;
            font-size: 0.9rem;
        }
        
        .checkbox-option:hover,
        .radio-option:hover {
            border-color: var(--accent-color);
            background-color: #f0f8ff;
        }
        
        .checkbox-option input,
        .radio-option input {
            width: 16px;
            height: 16px;
            cursor: pointer;
        }
        
        .checkbox-option label,
        .radio-option label {
            margin: 0;
            cursor: pointer;
            font-weight: normal;
            flex: 1;
            font-size: 0.9rem;
        }
        
        .method-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 10px;
        }
        
        .collapsible {
            margin-bottom: 15px;
        }
        
        .collapsible-header {
            background: var(--light-color);
            padding: 12px 15px;
            border-radius: var(--border-radius);
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
            font-weight: 600;
            color: var(--primary-color);
            border: 1px solid var(--border-color);
            transition: var(--transition);
            font-size: 0.95rem;
        }
        
        .collapsible-header:hover {
            background: #dfe6e9;
        }
        
        .collapsible-header i {
            transition: transform 0.2s ease;
            font-size: 0.9rem;
        }
        
        .collapsible-header.active i {
            transform: rotate(180deg);
        }
        
        .collapsible-content {
            padding: 15px;
            border: 1px solid var(--border-color);
            border-top: none;
            border-radius: 0 0 var(--border-radius) var(--border-radius);
            background: white;
            display: none;
        }
        
        .collapsible-content.active {
            display: block;
        }
        
        .conditional-section {
            border-left: 4px solid var(--accent-color);
            padding-left: 15px;
            margin-top: 15px;
            margin-bottom: 15px;
            background-color: #f9fafb;
            border-radius: 0 var(--border-radius) var(--border-radius) 0;
            padding: 15px;
            display: none;
        }
        
        .conditional-section.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }
        
        .sub-section {
            background: #f0f2f5;
            padding: 15px;
            border-radius: var(--border-radius);
            margin-top: 10px;
            border: 1px solid var(--border-color);
        }
        
        .sub-section-title {
            font-weight: 600;
            color: var(--primary-color);
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.95rem;
        }
        
        .buttons-container {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 30px;
            padding: 15px;
        }
        
        .btn {
            padding: 12px 30px;
            border: none;
            border-radius: var(--border-radius);
            font-size: 0.95rem;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            min-width: 160px;
        }
        
        .btn-submit {
            background: var(--success-color);
            color: white;
        }
        
        .btn-submit:hover {
            background: #219653;
            transform: translateY(-1px);
            box-shadow: var(--shadow);
        }
        
        .btn-reset {
            background: var(--danger-color);
            color: white;
        }
        
        .btn-reset:hover {
            background: #c0392b;
            transform: translateY(-1px);
            box-shadow: var(--shadow);
        }
        
        /* ===== RESPONSIVE ===== */
        @media (max-width: 768px) {
            body {
                padding: 10px;
                font-size: 13px;
            }
            
            .header {
                padding: 0;
            }
            
            .header-top {
                padding: 20px 15px;
            }
            
            .instituto-nombre {
                font-size: 1rem;
            }
            
            .sistema-titulo {
                font-size: 1.5rem;
            }
            
            .header-footer {
                flex-direction: column;
                gap: 5px;
                text-align: center;
            }
            
            .resumen-columnas {
                grid-template-columns: 1fr;
                gap: 15px;
            }
            
            .resumen-encabezado {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .resumen-item {
                flex-direction: column;
            }
            
            .resumen-icono {
                display: none;
            }
            
            .resumen-label {
                min-width: 100%;
                margin-bottom: 4px;
            }
            
            .form-grid {
                grid-template-columns: 1fr;
            }
            
            .form-section {
                padding: 15px;
            }
            
            .section-title {
                font-size: 1.2rem;
                margin-bottom: 15px;
            }
            
            .options-container,
            .method-grid {
                grid-template-columns: 1fr;
            }
            
            .buttons-container {
                flex-direction: column;
                align-items: center;
                gap: 10px;
            }
            
            .btn {
                width: 100%;
                max-width: 250px;
                padding: 10px 20px;
            }
        }
        
        .status-message {
            padding: 12px 15px;
            border-radius: var(--border-radius);
            margin-bottom: 15px;
            display: none;
            font-weight: 500;
            font-size: 0.9rem;
        }
        
        .status-success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .status-error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .footer {
            text-align: center;
            margin-top: 35px;
            padding: 15px;
            color: #7f8c8d;
            font-size: 0.8rem;
            border-top: 1px solid var(--border-color);
        }
        
        .helper-text {
            font-size: 0.8rem;
            color: #7f8c8d;
            margin-top: 4px;
            font-style: italic;
        }
        
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
        }
        
        ::-webkit-scrollbar-thumb {
            background: #c1c1c1;
            border-radius: 4px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: #a8a8a8;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- ===== HEADER ===== -->
        <header class="header">
            <div class="header-top">
                <div class="instituto-nombre">
                    <i class="fas fa-university"></i> Instituto de Recursos Judiciales, Argumentación y Razonamiento Probatorio
                </div>
                <h1 class="sistema-titulo">
                    <i class="fas fa-gavel"></i> Sistema de Carga de Fallos Judiciales
                </h1>
                <p class="header-subtitle">Análisis sistematizado de jurisprudencia penal y constitucional</p>
            </div>
            <div class="header-footer">
                <span><i class="fas fa-balance-scale"></i> Especialización en Derecho Penal y Procesal Penal</span>
                <span class="badge"><i class="fas fa-file-alt"></i> Formulario de análisis crítico</span>
            </div>
        </header>
        
        <!-- ===== PANEL DE RESUMEN - DOS COLUMNAS CON ENCABEZADO ===== -->
        <div class="resumen-panel" id="resumenPanel">
            <div class="resumen-header">
                <span><i class="fas fa-file-alt"></i> RESUMEN DEL FALLO - ACTUALIZACIÓN EN TIEMPO REAL</span>
                <span class="resumen-badge" id="resumenBadge">Sin datos</span>
            </div>
            <div class="resumen-contenido" id="resumenContenido">
                <span class="resumen-vacio">Complete el formulario para ver el resumen del fallo...</span>
            </div>
            <div class="resumen-footer" id="resumenFooter"></div>
        </div>
        
        <div id="statusMessage" class="status-message"></div>
        
        <form id="fallosForm">
            <!-- SECCIÓN 1: IDENTIFICACIÓN -->
            <section class="form-section">
                <h2 class="section-title"><i class="fas fa-id-card"></i> 1. Identificación del fallo</h2>
                <div class="form-grid">
                    <div class="form-group">
                        <label for="caratula" class="required">Carátula</label>
                        <input type="text" id="caratula" name="caratula" required placeholder="Ej: 'Pérez, Juan c/ Estado Nacional'" onchange="actualizarResumenEnTiempoReal()" onkeyup="actualizarResumenEnTiempoReal()">
                    </div>
                    <div class="form-group">
                        <label for="fallos" class="required">Fallos (tomo/página)</label>
                        <input type="text" id="fallos" name="fallos" required placeholder="Ej: 'Fallos: 336:1234'" onchange="actualizarResumenEnTiempoReal()" onkeyup="actualizarResumenEnTiempoReal()">
                    </div>
                    <div class="form-group">
                        <label for="fecha" class="required">Fecha</label>
                        <input type="date" id="fecha" name="fecha" required onchange="actualizarResumenEnTiempoReal()">
                    </div>
                </div>
            </section>
            
            <!-- SECCIÓN 2: TRIBUNAL -->
            <section class="form-section">
                <h2 class="section-title"><i class="fas fa-gavel"></i> 2. Composición del Tribunal</h2>
                <div class="form-grid">
                    <div class="form-group">
                        <label for="integracion" class="required">Integración de la Corte</label>
                        <textarea id="integracion" name="integracion" required placeholder="Liste los miembros del tribunal..." onchange="actualizarResumenEnTiempoReal()" onkeyup="actualizarResumenEnTiempoReal()"></textarea>
                    </div>
                    <div class="form-group">
                        <label class="required">Voto</label>
                        <div class="option-group">
                            <div class="options-container">
                                <div class="radio-option">
                                    <input type="radio" id="voto-unanimidad" name="voto" value="unanimidad" required onclick="toggleDisidencias(false); actualizarResumenEnTiempoReal()">
                                    <label for="voto-unanimidad">Unanimidad</label>
                                </div>
                                <div class="radio-option">
                                    <input type="radio" id="voto-mayoria" name="voto" value="mayoria" onclick="toggleDisidencias(false); actualizarResumenEnTiempoReal()">
                                    <label for="voto-mayoria">Mayoría</label>
                                </div>
                                <div class="radio-option">
                                    <input type="radio" id="voto-disidencias" name="voto" value="disidencias" onclick="toggleDisidencias(true); actualizarResumenEnTiempoReal()">
                                    <label for="voto-disidencias">Disidencias (indicar cuáles)</label>
                                </div>
                            </div>
                        </div>
                        <div id="disidenciasContainer" class="conditional-section">
                            <label for="detalleDisidencias" class="required">Detalle de las disidencias</label>
                            <textarea id="detalleDisidencias" name="detalleDisidencias" required placeholder="Indique qué jueces disentieron y los fundamentos..." onchange="actualizarResumenEnTiempoReal()" onkeyup="actualizarResumenEnTiempoReal()"></textarea>
                        </div>
                    </div>
                </div>
            </section>
            
            <!-- SECCIÓN 3: TEMA JURÍDICO CENTRAL -->
            <section class="form-section">
                <h2 class="section-title"><i class="fas fa-balance-scale"></i> 3. Tema jurídico central</h2>
                <div class="form-grid">
                    <div class="form-group full-width">
                        <label class="required">Materia principal:</label>
                        <div class="option-group">
                            <div class="options-container" style="grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));">
                                <div style="grid-column: 1 / -1; margin-bottom: 5px;">
                                    <div class="checkbox-option" style="background: #e8f0fe; border-left: 3px solid var(--accent-color);">
                                        <input type="checkbox" id="materia-arbitrariedad" name="materiaPrincipal" value="arbitrariedad_sentencia" onclick="toggleArbitrariedadSubopciones(this); actualizarResumenEnTiempoReal()">
                                        <label for="materia-arbitrariedad"><strong>Arbitrariedad de sentencia</strong></label>
                                    </div>
                                </div>
                                <div id="arbitrariedadSubopcionesContainer" style="display: none; grid-column: 1 / -1; margin-left: 25px; margin-bottom: 15px;">
                                    <div class="options-container" style="grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));">
                                        <div class="checkbox-option" style="background: #f8f9fa;">
                                            <input type="checkbox" id="arbitrariedad-normativa" name="causalesArbitrariedad" value="normativa" onclick="actualizarResumenEnTiempoReal()">
                                            <label for="arbitrariedad-normativa">Normativa</label>
                                        </div>
                                        <div class="checkbox-option" style="background: #f8f9fa;">
                                            <input type="checkbox" id="arbitrariedad-clasica" name="causalesArbitrariedad" value="clasica" onclick="actualizarResumenEnTiempoReal()">
                                            <label for="arbitrariedad-clasica">Clásica</label>
                                        </div>
                                    </div>
                                </div>
                                <div class="checkbox-option">
                                    <input type="checkbox" id="materia-afectacion-derechos" name="materiaPrincipal" value="afectacion_derechos_constitucion" onclick="actualizarResumenEnTiempoReal()">
                                    <label for="materia-afectacion-derechos">Afectación de derechos garantizados por la Constitución</label>
                                </div>
                                <div class="checkbox-option">
                                    <input type="checkbox" id="materia-tratados" name="materiaPrincipal" value="interpretacion_tratados" onclick="actualizarResumenEnTiempoReal()">
                                    <label for="materia-tratados">Interpretación de tratados internacionales</label>
                                </div>
                                <div class="checkbox-option">
                                    <input type="checkbox" id="materia-leyes-federales" name="materiaPrincipal" value="interpretacion_leyes_federales" onclick="actualizarResumenEnTiempoReal()">
                                    <label for="materia-leyes-federales">Interpretación de leyes federales</label>
                                </div>
                                <div class="checkbox-option">
                                    <input type="checkbox" id="materia-penal-economico" name="materiaPrincipal" value="penal_economico" onclick="actualizarResumenEnTiempoReal()">
                                    <label for="materia-penal-economico">Fuero penal económico</label>
                                </div>
                                <div class="checkbox-option">
                                    <input type="checkbox" id="materia-otro" name="materiaPrincipal" value="otro" onclick="toggleCustomMateriaPrincipal(this); actualizarResumenEnTiempoReal()">
                                    <label for="materia-otro"><strong>Otro...</strong></label>
                                </div>
                            </div>
                            <div id="customMateriaPrincipalContainer" class="custom-input" style="display: none;">
                                <label for="customMateriaPrincipal">Especifique la materia principal:</label>
                                <input type="text" id="customMateriaPrincipal" name="customMateriaPrincipal" placeholder="Ingrese la materia..." onchange="actualizarResumenEnTiempoReal()" onkeyup="actualizarResumenEnTiempoReal()">
                            </div>
                        </div>
                    </div>
                    <div class="form-group full-width">
                        <label for="subtema">Subtema:</label>
                        <select id="subtema" name="subtema" class="form-control" onchange="toggleCustomSubtema(this); actualizarResumenEnTiempoReal()">
                            <option value="" selected>-- Seleccione un subtema (opcional) --</option>
                            <optgroup label="Derecho Penal">
                                <option value="homicidio">Homicidio</option>
                                <option value="lesiones">Lesiones</option>
                                <option value="hurto">Hurto</option>
                                <option value="robo">Robo</option>
                                <option value="estafa">Estafa</option>
                                <option value="lavado_activos">Lavado de activos</option>
                                <option value="narcotrafico">Narcotráfico</option>
                                <option value="delitos_sexuales">Delitos sexuales</option>
                                <option value="delitos_contra_adm_publica">Delitos contra la adm. pública</option>
                            </optgroup>
                            <optgroup label="Derecho Procesal Penal">
                                <option value="prueba">Prueba</option>
                                <option value="nulidades">Nulidades</option>
                                <option value="recursos">Recursos</option>
                                <option value="prision_preventiva">Prisión preventiva</option>
                                <option value="excarcelacion">Excarcelación</option>
                                <option value="competencia">Competencia</option>
                            </optgroup>
                            <optgroup label="Garantías Constitucionales">
                                <option value="debido_proceso">Debido proceso</option>
                                <option value="defensa_juicio">Defensa en juicio</option>
                                <option value="plazo_razonable">Plazo razonable</option>
                                <option value="non_bis_idem">Non bis in idem</option>
                                <option value="legalidad">Principio de legalidad</option>
                                <option value="proporcionalidad">Proporcionalidad</option>
                            </optgroup>
                            <option value="otro">Otro (especificar)</option>
                        </select>
                        <div id="customSubtemaContainer" class="custom-input" style="display: none;">
                            <label for="customSubtema">Especifique el subtema:</label>
                            <input type="text" id="customSubtema" name="customSubtema" placeholder="Ingrese el subtema..." onchange="actualizarResumenEnTiempoReal()" onkeyup="actualizarResumenEnTiempoReal()">
                        </div>
                    </div>
                </div>
            </section>
            
            <!-- SECCIÓN 4: CUESTIÓN FEDERAL -->
            <section class="form-section">
                <h2 class="section-title"><i class="fas fa-landmark"></i> 4. Cuestión federal planteada</h2>
                <div class="form-grid">
                    <div class="form-group full-width">
                        <div class="option-group">
                            <div class="method-grid" style="grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));">
                                <div class="checkbox-option">
                                    <input type="checkbox" id="cuestion-debido-proceso" name="cuestionFederal" value="violacion_debido_proceso" onclick="actualizarResumenEnTiempoReal()">
                                    <label for="cuestion-debido-proceso">Violación al debido proceso</label>
                                </div>
                                <div class="checkbox-option">
                                    <input type="checkbox" id="cuestion-defensa-juicio" name="cuestionFederal" value="defensa_en_juicio" onclick="actualizarResumenEnTiempoReal()">
                                    <label for="cuestion-defensa-juicio">Defensa en juicio</label>
                                </div>
                                <div class="checkbox-option">
                                    <input type="checkbox" id="cuestion-detencion-ilegal" name="cuestionFederal" value="detencion_ilegal" onclick="actualizarResumenEnTiempoReal()">
                                    <label for="cuestion-detencion-ilegal">Detención ilegal</label>
                                </div>
                                <div class="checkbox-option">
                                    <input type="checkbox" id="cuestion-pena-inconstitucional" name="cuestionFederal" value="aplicacion_pena_inconstitucional" onclick="actualizarResumenEnTiempoReal()">
                                    <label for="cuestion-pena-inconstitucional">Aplicación de pena inconstitucional</label>
                                </div>
                                <div class="checkbox-option">
                                    <input type="checkbox" id="cuestion-garantia-defensa" name="cuestionFederal" value="garantia_defensa_juicio" onclick="actualizarResumenEnTiempoReal()">
                                    <label for="cuestion-garantia-defensa">Garantía de defensa en juicio</label>
                                </div>
                                <div class="checkbox-option">
                                    <input type="checkbox" id="cuestion-autoincriminacion" name="cuestionFederal" value="prohibicion_autoincriminacion" onclick="actualizarResumenEnTiempoReal()">
                                    <label for="cuestion-autoincriminacion">Prohibición de autoincriminación</label>
                                </div>
                                <div class="checkbox-option">
                                    <input type="checkbox" id="cuestion-plazo-razonable" name="cuestionFederal" value="violacion_plazo_razonable" onclick="actualizarResumenEnTiempoReal()">
                                    <label for="cuestion-plazo-razonable">Violación al plazo razonable</label>
                                </div>
                                <div class="checkbox-option">
                                    <input type="checkbox" id="cuestion-supremacia" name="cuestionFederal" value="supremacia_constitucional" onclick="actualizarResumenEnTiempoReal()">
                                    <label for="cuestion-supremacia">Supremacía constitucional</label>
                                </div>
                                <div class="checkbox-option">
                                    <input type="checkbox" id="cuestion-derechos-convencionales" name="cuestionFederal" value="derechos_convencionales" onclick="actualizarResumenEnTiempoReal()">
                                    <label for="cuestion-derechos-convencionales">Derechos convencionales</label>
                                </div>
                            </div>
                            <div style="margin-top: 15px; border-top: 1px solid var(--border-color); padding-top: 15px;">
                                <div class="checkbox-option">
                                    <input type="checkbox" id="cuestion-otro" name="cuestionFederal" value="otro" onclick="toggleCustomCuestionFederal(this); actualizarResumenEnTiempoReal()">
                                    <label for="cuestion-otro"><strong>Otro (especificar)</strong></label>
                                </div>
                                <div id="customCuestionFederalContainer" class="custom-input" style="display: none;">
                                    <label for="customCuestionFederal">Especifique la cuestión federal:</label>
                                    <input type="text" id="customCuestionFederal" name="customCuestionFederal" placeholder="Ingrese la cuestión federal..." onchange="actualizarResumenEnTiempoReal()" onkeyup="actualizarResumenEnTiempoReal()">
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="form-group full-width">
                        <label for="descripcionCuestionFederal" class="required">Descripción de la cuestión federal</label>
                        <textarea id="descripcionCuestionFederal" name="descripcionCuestionFederal" required 
                                  placeholder="Describa la cuestión federal planteada en el fallo..." 
                                  rows="4" 
                                  onchange="actualizarResumenEnTiempoReal()" 
                                  onkeyup="actualizarResumenEnTiempoReal()"></textarea>
                        <div class="helper-text">Ej: "Se cuestiona la validez constitucional del art. 123 del Código Penal en cuanto establece una pena desproporcionada..."</div>
                    </div>
                </div>
            </section>
            
            <!-- SECCIÓN 5: TIPO DE DESACUERDO -->
            <section class="form-section">
                <h2 class="section-title"><i class="fas fa-exclamation-triangle"></i> 5. Tipo de desacuerdo</h2>
                <div class="form-grid">
                    <div class="form-group full-width">
                        <div class="option-group">
                            <div class="options-container">
                                <div class="checkbox-option">
                                    <input type="checkbox" id="desacuerdo-normativo" name="tipoDesacuerdo" value="normativo" onclick="actualizarResumenEnTiempoReal()">
                                    <label for="desacuerdo-normativo">Normativo</label>
                                </div>
                                <div class="checkbox-option">
                                    <input type="checkbox" id="desacuerdo-factico" name="tipoDesacuerdo" value="factico" onclick="actualizarResumenEnTiempoReal()">
                                    <label for="desacuerdo-factico">Fáctico</label>
                                </div>
                                <div class="checkbox-option">
                                    <input type="checkbox" id="desacuerdo-mixto" name="tipoDesacuerdo" value="mixto" onclick="actualizarResumenEnTiempoReal()">
                                    <label for="desacuerdo-mixto">Mixto</label>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
            
            <!-- SECCIÓN 6: TIPO DE PROBLEMA JURÍDICO -->
            <section class="form-section">
                <h2 class="section-title"><i class="fas fa-question-circle"></i> 6. Tipo de problema jurídico</h2>
                <div class="form-grid">
                    <div class="form-group full-width">
                        <div class="option-group">
                            <div class="options-container">
                                <div class="checkbox-option">
                                    <input type="checkbox" id="problema-constitucionalidad" name="problemaJuridico" value="constitucionalidad" onclick="toggleProbatorio(false); actualizarResumenEnTiempoReal()">
                                    <label for="problema-constitucionalidad">Constitucionalidad de norma</label>
                                </div>
                                <div class="checkbox-option">
                                    <input type="checkbox" id="problema-interpretativo" name="problemaJuridico" value="interpretativo" onclick="toggleProbatorio(false); actualizarResumenEnTiempoReal()">
                                    <label for="problema-interpretativo">Interpretativo</label>
                                </div>
                                <div class="checkbox-option">
                                    <input type="checkbox" id="problema-probatorio" name="problemaJuridico" value="probatorio" onclick="toggleProbatorio(true); actualizarResumenEnTiempoReal()">
                                    <label for="problema-probatorio">Probatorio</label>
                                </div>
                            </div>
                        </div>
                        <div id="probatorioContainer" class="conditional-section">
                            <div class="sub-section">
                                <div class="sub-section-title"><i class="fas fa-clipboard-check"></i> i. Rol de la prueba en la decisión</div>
                                <div class="options-container">
                                    <div class="radio-option">
                                        <input type="radio" id="prueba-central" name="rolPrueba" value="central" onclick="actualizarResumenEnTiempoReal()">
                                        <label for="prueba-central">Central</label>
                                    </div>
                                    <div class="radio-option">
                                        <input type="radio" id="prueba-secundario" name="rolPrueba" value="secundario" onclick="actualizarResumenEnTiempoReal()">
                                        <label for="prueba-secundario">Secundario</label>
                                    </div>
                                    <div class="radio-option">
                                        <input type="radio" id="prueba-marginal" name="rolPrueba" value="marginal" onclick="actualizarResumenEnTiempoReal()">
                                        <label for="prueba-marginal">Marginal</label>
                                    </div>
                                </div>
                            </div>
                            <div class="sub-section">
                                <div class="sub-section-title"><i class="fas fa-brain"></i> ii. Tipo de inferencias probatorias detectadas</div>
                                <div class="method-grid">
                                    <div class="checkbox-option">
                                        <input type="checkbox" id="inferencia-inductivas" name="tipoInferencias" value="inductivas" onclick="actualizarResumenEnTiempoReal()">
                                        <label for="inferencia-inductivas">Inductivas</label>
                                    </div>
                                    <div class="checkbox-option">
                                        <input type="checkbox" id="inferencia-maximas" name="tipoInferencias" value="maximas_experiencia" onclick="actualizarResumenEnTiempoReal()">
                                        <label for="inferencia-maximas">Máximas de experiencia</label>
                                    </div>
                                    <div class="checkbox-option">
                                        <input type="checkbox" id="inferencia-presunciones-legales" name="tipoInferencias" value="presunciones_legales" onclick="actualizarResumenEnTiempoReal()">
                                        <label for="inferencia-presunciones-legales">Presunciones legales</label>
                                    </div>
                                    <div class="checkbox-option">
                                        <input type="checkbox" id="inferencia-presunciones-judiciales" name="tipoInferencias" value="presunciones_judiciales" onclick="actualizarResumenEnTiempoReal()">
                                        <label for="inferencia-presunciones-judiciales">Presunciones judiciales</label>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
            
            <!-- SECCIÓN 7: MÉTODO INTERPRETATIVO -->
            <section class="form-section">
                <h2 class="section-title"><i class="fas fa-search"></i> 7. Método interpretativo utilizado</h2>
                <div class="form-grid">
                    <div class="form-group full-width">
                        <div class="method-grid">
                            <div class="checkbox-option">
                                <input type="checkbox" id="metodo-literal" name="metodoInterpretativo" value="literal" onclick="actualizarResumenEnTiempoReal()">
                                <label for="metodo-literal">Literal</label>
                            </div>
                            <div class="checkbox-option">
                                <input type="checkbox" id="metodo-sistematico" name="metodoInterpretativo" value="sistematico" onclick="actualizarResumenEnTiempoReal()">
                                <label for="metodo-sistematico">Sistemático</label>
                            </div>
                            <div class="checkbox-option">
                                <input type="checkbox" id="metodo-teleologico" name="metodoInterpretativo" value="teleologico" onclick="actualizarResumenEnTiempoReal()">
                                <label for="metodo-teleologico">Teleológico</label>
                            </div>
                            <div class="checkbox-option">
                                <input type="checkbox" id="metodo-historico" name="metodoInterpretativo" value="historico" onclick="actualizarResumenEnTiempoReal()">
                                <label for="metodo-historico">Histórico</label>
                            </div>
                            <div class="checkbox-option">
                                <input type="checkbox" id="metodo-principialista" name="metodoInterpretativo" value="principialista" onclick="actualizarResumenEnTiempoReal()">
                                <label for="metodo-principialista">Principialista</label>
                            </div>
                            <div class="checkbox-option">
                                <input type="checkbox" id="metodo-acontrario" name="metodoInterpretativo" value="a_contrario" onclick="actualizarResumenEnTiempoReal()">
                                <label for="metodo-acontrario">A contrario</label>
                            </div>
                            <div class="checkbox-option">
                                <input type="checkbox" id="metodo-afortiori" name="metodoInterpretativo" value="a_fortiori" onclick="actualizarResumenEnTiempoReal()">
                                <label for="metodo-afortiori">A fortiori</label>
                            </div>
                            <div class="checkbox-option">
                                <input type="checkbox" id="metodo-analogico" name="metodoInterpretativo" value="analogico" onclick="actualizarResumenEnTiempoReal()">
                                <label for="metodo-analogico">Analógico</label>
                            </div>
                            <div class="checkbox-option">
                                <input type="checkbox" id="metodo-reduccion" name="metodoInterpretativo" value="reduccion_absurdo" onclick="actualizarResumenEnTiempoReal()">
                                <label for="metodo-reduccion">Reducción al absurdo</label>
                            </div>
                            <div class="checkbox-option">
                                <input type="checkbox" id="metodo-coherencia" name="metodoInterpretativo" value="coherencia_sistema" onclick="actualizarResumenEnTiempoReal()">
                                <label for="metodo-coherencia">Coherencia del sistema</label>
                            </div>
                            <div class="checkbox-option">
                                <input type="checkbox" id="metodo-unidad" name="metodoInterpretativo" value="unidad_constitucion" onclick="actualizarResumenEnTiempoReal()">
                                <label for="metodo-unidad">Unidad de la Constitución</label>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
            
            <!-- SECCIÓN 8: ARGUMENTOS DE PONDERACIÓN -->
            <section class="form-section">
                <h2 class="section-title"><i class="fas fa-weight-hanging"></i> 8. Argumentos de ponderación (Alexy/Maccormick)</h2>
                
                <div class="collapsible">
                    <div class="collapsible-header" onclick="toggleCollapsible(this)">
                        <span>a. ¿Hay colisión de principios?</span>
                        <i class="fas fa-chevron-down"></i>
                    </div>
                    <div class="collapsible-content">
                        <div class="form-grid">
                            <div class="form-group">
                                <div class="options-container">
                                    <div class="radio-option">
                                        <input type="radio" id="colision-no" name="colisionPrincipios" value="no" onclick="togglePrincipiosContainer(false); actualizarResumenEnTiempoReal()">
                                        <label for="colision-no">No</label>
                                    </div>
                                    <div class="radio-option">
                                        <input type="radio" id="colision-si" name="colisionPrincipios" value="si" onclick="togglePrincipiosContainer(true); actualizarResumenEnTiempoReal()">
                                        <label for="colision-si">Sí</label>
                                    </div>
                                </div>
                            </div>
                            <div id="principiosContainer" class="conditional-section">
                                <div class="form-grid">
                                    <div class="form-group">
                                        <label for="principioA" class="required">Principio A</label>
                                        <select id="principioA" name="principioA" onchange="toggleCustomPrincipioA(this); actualizarResumenEnTiempoReal()">
                                            <option value="" selected>Seleccione un principio</option>
                                            <option value="autonomia_voluntad">Autonomía de la voluntad</option>
                                            <option value="buena_fe">Buena fe</option>
                                            <option value="igualdad">Igualdad</option>
                                            <option value="libertad">Libertad</option>
                                            <option value="seguridad_juridica">Seguridad jurídica</option>
                                            <option value="proporcionalidad">Proporcionalidad</option>
                                            <option value="razonabilidad">Razonabilidad</option>
                                            <option value="legalidad">Legalidad</option>
                                            <option value="dignidad_humana">Dignidad humana</option>
                                            <option value="debido_proceso">Debido proceso</option>
                                            <option value="defensa_en_juicio">Defensa en juicio</option>
                                            <option value="publicidad">Publicidad</option>
                                            <option value="economia_procesal">Economía procesal</option>
                                            <option value="celeridad">Celeridad</option>
                                            <option value="otro">Otro principio (especificar)</option>
                                        </select>
                                        <div id="customPrincipioAContainer" class="custom-input">
                                            <label for="customPrincipioA" class="required">Especifique el principio:</label>
                                            <input type="text" id="customPrincipioA" name="customPrincipioA" placeholder="Ingrese el principio A..." onchange="actualizarResumenEnTiempoReal()" onkeyup="actualizarResumenEnTiempoReal()">
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label for="principioB" class="required">Principio B</label>
                                        <select id="principioB" name="principioB" onchange="toggleCustomPrincipioB(this); actualizarResumenEnTiempoReal()">
                                            <option value="" selected>Seleccione un principio</option>
                                            <option value="autonomia_voluntad">Autonomía de la voluntad</option>
                                            <option value="buena_fe">Buena fe</option>
                                            <option value="igualdad">Igualdad</option>
                                            <option value="libertad">Libertad</option>
                                            <option value="seguridad_juridica">Seguridad jurídica</option>
                                            <option value="proporcionalidad">Proporcionalidad</option>
                                            <option value="razonabilidad">Razonabilidad</option>
                                            <option value="legalidad">Legalidad</option>
                                            <option value="dignidad_humana">Dignidad humana</option>
                                            <option value="debido_proceso">Debido proceso</option>
                                            <option value="defensa_en_juicio">Defensa en juicio</option>
                                            <option value="publicidad">Publicidad</option>
                                            <option value="economia_procesal">Economía procesal</option>
                                            <option value="celeridad">Celeridad</option>
                                            <option value="otro">Otro principio (especificar)</option>
                                        </select>
                                        <div id="customPrincipioBContainer" class="custom-input">
                                            <label for="customPrincipioB" class="required">Especifique el principio:</label>
                                            <input type="text" id="customPrincipioB" name="customPrincipioB" placeholder="Ingrese el principio B..." onchange="actualizarResumenEnTiempoReal()" onkeyup="actualizarResumenEnTiempoReal()">
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="collapsible">
                    <div class="collapsible-header" onclick="toggleCollapsible(this)">
                        <span>b. Estructura de la ponderación</span>
                        <i class="fas fa-chevron-down"></i>
                    </div>
                    <div class="collapsible-content">
                        <div class="form-grid">
                            <div class="form-group full-width">
                                <div class="method-grid">
                                    <div class="checkbox-option">
                                        <input type="checkbox" id="ponderacion-idoneidad" name="estructuraPonderacion" value="idoneidad" onclick="actualizarResumenEnTiempoReal()">
                                        <label for="ponderacion-idoneidad">Idoneidad</label>
                                    </div>
                                    <div class="checkbox-option">
                                        <input type="checkbox" id="ponderacion-necesidad" name="estructuraPonderacion" value="necesidad" onclick="actualizarResumenEnTiempoReal()">
                                        <label for="ponderacion-necesidad">Necesidad</label>
                                    </div>
                                    <div class="checkbox-option">
                                        <input type="checkbox" id="ponderacion-proporcionalidad" name="estructuraPonderacion" value="proporcionalidad_estricta" onclick="actualizarResumenEnTiempoReal()">
                                        <label for="ponderacion-proporcionalidad">Proporcionalidad estricta</label>
                                    </div>
                                    <div class="checkbox-option">
                                        <input type="checkbox" id="ponderacion-formula" name="estructuraPonderacion" value="formula_peso" onclick="actualizarResumenEnTiempoReal()">
                                        <label for="ponderacion-formula">Fórmula del peso implícita</label>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="collapsible">
                    <div class="collapsible-header" onclick="toggleCollapsible(this)">
                        <span>c. Tipo de razonamiento</span>
                        <i class="fas fa-chevron-down"></i>
                    </div>
                    <div class="collapsible-content">
                        <div class="form-grid">
                            <div class="form-group full-width">
                                <div class="options-container">
                                    <div class="checkbox-option">
                                        <input type="checkbox" id="razonamiento-balance-explicito" name="tipoRazonamiento" value="balance_explicito" onclick="actualizarResumenEnTiempoReal()">
                                        <label for="razonamiento-balance-explicito">Balance explícito</label>
                                    </div>
                                    <div class="checkbox-option">
                                        <input type="checkbox" id="razonamiento-balance-implicito" name="tipoRazonamiento" value="balance_implicito" onclick="actualizarResumenEnTiempoReal()">
                                        <label for="razonamiento-balance-implicito">Balance implícito</label>
                                    </div>
                                    <div class="checkbox-option">
                                        <input type="checkbox" id="razonamiento-retorico" name="tipoRazonamiento" value="retorico" onclick="actualizarResumenEnTiempoReal()">
                                        <label for="razonamiento-retorico">Retórico (sin estructura real)</label>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
            
            <!-- SECCIÓN 9: ERRORES DEL RAZONAMIENTO -->
            <section class="form-section">
                <h2 class="section-title"><i class="fas fa-times-circle"></i> 9. Errores del razonamiento</h2>
                <div class="form-grid">
                    <div class="form-group full-width">
                        <div style="margin-bottom: 15px;">
                            <div class="options-container">
                                <div class="checkbox-option">
                                    <input type="checkbox" id="error-afirmacion-consecuente" name="erroresSilogismo" value="afirmacion_consecuente" onclick="actualizarResumenEnTiempoReal()">
                                    <label for="error-afirmacion-consecuente">Afirmación del consecuente</label>
                                </div>
                                <div class="checkbox-option">
                                    <input type="checkbox" id="error-negacion-antecedente" name="erroresSilogismo" value="negacion_antecedente" onclick="actualizarResumenEnTiempoReal()">
                                    <label for="error-negacion-antecedente">Negación del antecedente</label>
                                </div>
                                <div class="checkbox-option">
                                    <input type="checkbox" id="error-silogismo-disyuntivo" name="erroresSilogismo" value="silogismo_disyuntivo_falaz" onclick="actualizarResumenEnTiempoReal()">
                                    <label for="error-silogismo-disyuntivo">Silogismo disyuntivo falaz</label>
                                </div>
                            </div>
                        </div>
                        <div style="margin-bottom: 20px;">
                            <div class="checkbox-option">
                                <input type="checkbox" id="argumentos-atinencia-principal" name="argumentosAtinenciaPrincipal" value="si" onclick="toggleArgumentosAtinencia(this); actualizarResumenEnTiempoReal()">
                                <label for="argumentos-atinencia-principal"><strong>Argumentos de atinencia</strong></label>
                            </div>
                            <div id="argumentosAtinenciaContainer" class="conditional-section" style="display: none; margin-left: 25px; margin-top: 10px;">
                                <div class="method-grid">
                                    <div class="checkbox-option" style="background: #f8f9fa;">
                                        <input type="checkbox" id="argumento-ad-baculum" name="argumentosAtinencia" value="ad_baculum" onclick="actualizarResumenEnTiempoReal()">
                                        <label for="argumento-ad-baculum">ad baculum</label>
                                    </div>
                                    <div class="checkbox-option" style="background: #f8f9fa;">
                                        <input type="checkbox" id="argumento-ad-hominem" name="argumentosAtinencia" value="ad_hominem" onclick="actualizarResumenEnTiempoReal()">
                                        <label for="argumento-ad-hominem">ad hominem</label>
                                    </div>
                                    <div class="checkbox-option" style="background: #f8f9fa;">
                                        <input type="checkbox" id="argumento-ad-ignorantiam" name="argumentosAtinencia" value="ad_ignorantiam" onclick="actualizarResumenEnTiempoReal()">
                                        <label for="argumento-ad-ignorantiam">ad ignorantiam</label>
                                    </div>
                                    <div class="checkbox-option" style="background: #f8f9fa;">
                                        <input type="checkbox" id="argumento-ad-misericordiam" name="argumentosAtinencia" value="ad_misericordiam" onclick="actualizarResumenEnTiempoReal()">
                                        <label for="argumento-ad-misericordiam">ad misericordiam</label>
                                    </div>
                                    <div class="checkbox-option" style="background: #f8f9fa;">
                                        <input type="checkbox" id="argumento-ad-populum" name="argumentosAtinencia" value="ad_populum" onclick="actualizarResumenEnTiempoReal()">
                                        <label for="argumento-ad-populum">ad populum</label>
                                    </div>
                                    <div class="checkbox-option" style="background: #f8f9fa;">
                                        <input type="checkbox" id="argumento-ad-verecundiam" name="argumentosAtinencia" value="ad_verecundiam" onclick="actualizarResumenEnTiempoReal()">
                                        <label for="argumento-ad-verecundiam">ad verecundiam</label>
                                    </div>
                                    <div class="checkbox-option" style="background: #f8f9fa;">
                                        <input type="checkbox" id="argumento-de-accidente" name="argumentosAtinencia" value="de_accidente" onclick="actualizarResumenEnTiempoReal()">
                                        <label for="argumento-de-accidente">de accidente</label>
                                    </div>
                                    <div class="checkbox-option" style="background: #f8f9fa;">
                                        <input type="checkbox" id="argumento-accidente-inverso" name="argumentosAtinencia" value="accidente_inverso" onclick="actualizarResumenEnTiempoReal()">
                                        <label for="argumento-accidente-inverso">Del accidente inverso</label>
                                    </div>
                                    <div class="checkbox-option" style="background: #f8f9fa;">
                                        <input type="checkbox" id="argumento-causa-falsa" name="argumentosAtinencia" value="causa_falsa" onclick="actualizarResumenEnTiempoReal()">
                                        <label for="argumento-causa-falsa">Causa falsa</label>
                                    </div>
                                    <div class="checkbox-option" style="background: #f8f9fa;">
                                        <input type="checkbox" id="argumento-petitio-principii" name="argumentosAtinencia" value="petitio_principii" onclick="actualizarResumenEnTiempoReal()">
                                        <label for="argumento-petitio-principii">Petitio principii</label>
                                    </div>
                                    <div class="checkbox-option" style="background: #f8f9fa;">
                                        <input type="checkbox" id="argumento-pregunta-compleja" name="argumentosAtinencia" value="pregunta_compleja" onclick="actualizarResumenEnTiempoReal()">
                                        <label for="argumento-pregunta-compleja">Pregunta compleja</label>
                                    </div>
                                    <div class="checkbox-option" style="background: #f8f9fa;">
                                        <input type="checkbox" id="argumento-ignoratio-elenchi" name="argumentosAtinencia" value="ignoratio_elenchi" onclick="actualizarResumenEnTiempoReal()">
                                        <label for="argumento-ignoratio-elenchi">Ignoratio Elenchi</label>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div style="margin-bottom: 5px;">
                            <div class="checkbox-option">
                                <input type="checkbox" id="argumentos-ambiguedad-principal" name="argumentosAmbiguedadPrincipal" value="si" onclick="toggleArgumentosAmbiguedad(this); actualizarResumenEnTiempoReal()">
                                <label for="argumentos-ambiguedad-principal"><strong>Argumentos de ambigüedad</strong></label>
                            </div>
                            <div id="argumentosAmbiguedadContainer" class="conditional-section" style="display: none; margin-left: 25px; margin-top: 10px;">
                                <div class="method-grid">
                                    <div class="checkbox-option" style="background: #f8f9fa;">
                                        <input type="checkbox" id="argumento-equivoco" name="argumentosAmbiguedad" value="equivoco" onclick="actualizarResumenEnTiempoReal()">
                                        <label for="argumento-equivoco">Equívoco</label>
                                    </div>
                                    <div class="checkbox-option" style="background: #f8f9fa;">
                                        <input type="checkbox" id="argumento-anfibologia" name="argumentosAmbiguedad" value="anfibologia" onclick="actualizarResumenEnTiempoReal()">
                                        <label for="argumento-anfibologia">Anfibología</label>
                                    </div>
                                    <div class="checkbox-option" style="background: #f8f9fa;">
                                        <input type="checkbox" id="argumento-enfasis" name="argumentosAmbiguedad" value="enfasis" onclick="actualizarResumenEnTiempoReal()">
                                        <label for="argumento-enfasis">Énfasis</label>
                                    </div>
                                    <div class="checkbox-option" style="background: #f8f9fa;">
                                        <input type="checkbox" id="argumento-composicion" name="argumentosAmbiguedad" value="composicion" onclick="actualizarResumenEnTiempoReal()">
                                        <label for="argumento-composicion">Composición</label>
                                    </div>
                                    <div class="checkbox-option" style="background: #f8f9fa;">
                                        <input type="checkbox" id="argumento-division" name="argumentosAmbiguedad" value="division" onclick="actualizarResumenEnTiempoReal()">
                                        <label for="argumento-division">División</label>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- SECCIÓN 10: CAUSAL DE ARBITRARIEDAD -->
            <section class="form-section">
                <h2 class="section-title"><i class="fas fa-gavel"></i> 10. Causal de Arbitrariedad</h2>
                <div class="form-grid">
                    <div class="form-group full-width">
                        <div style="margin-bottom: 20px;">
                            <div class="checkbox-option">
                                <input type="checkbox" id="causal-falta-fundamentacion" name="causalArbitrariedad" value="falta_fundamentacion" onclick="toggleFaltaFundamentacion(this); actualizarResumenEnTiempoReal()">
                                <label for="causal-falta-fundamentacion"><strong>Falta de fundamentación suficiente</strong></label>
                            </div>
                            <div id="faltaFundamentacionContainer" class="conditional-section" style="display: none; margin-left: 25px; margin-top: 10px;">
                                <div class="options-container" style="grid-template-columns: 1fr;">
                                    <div class="checkbox-option" style="background: #f8f9fa;">
                                        <input type="checkbox" id="fundamentacion-dogmatica" name="opcionesFundamentacion" value="afirmaciones_dogmaticas" onclick="actualizarResumenEnTiempoReal()">
                                        <label for="fundamentacion-dogmatica">Afirmaciones dogmáticas o no fundadas</label>
                                    </div>
                                    <div class="checkbox-option" style="background: #f8f9fa;">
                                        <input type="checkbox" id="fundamentacion-insuficiente" name="opcionesFundamentacion" value="falta_fundamentacion_idonea" onclick="actualizarResumenEnTiempoReal()">
                                        <label for="fundamentacion-insuficiente">Falta de fundamentación idónea o no suficiente</label>
                                    </div>
                                    <div class="checkbox-option" style="background: #f8f9fa;">
                                        <input type="checkbox" id="fundamentacion-carencia" name="opcionesFundamentacion" value="carencia_sustento" onclick="actualizarResumenEnTiempoReal()">
                                        <label for="fundamentacion-carencia">Carencia de sustento o referencia concreta</label>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div style="margin-bottom: 15px;">
                            <div class="checkbox-option">
                                <input type="checkbox" id="causal-apartamiento" name="causalArbitrariedad" value="apartamiento_condiciones" onclick="actualizarResumenEnTiempoReal()">
                                <label for="causal-apartamiento"><strong>Apartamiento de las condiciones de la causa</strong></label>
                            </div>
                        </div>
                        <div style="margin-bottom: 15px;">
                            <div class="checkbox-option">
                                <input type="checkbox" id="causal-valoracion" name="causalArbitrariedad" value="valoracion_hechos_prueba" onclick="actualizarResumenEnTiempoReal()">
                                <label for="causal-valoracion"><strong>Valoración de las circunstancias de hecho y prueba</strong></label>
                            </div>
                        </div>
                        <div style="margin-bottom: 15px;">
                            <div class="checkbox-option">
                                <input type="checkbox" id="causal-defectos-extremos" name="causalArbitrariedad" value="defectos_extremos_conducentes" onclick="actualizarResumenEnTiempoReal()">
                                <label for="causal-defectos-extremos"><strong>Defectos en la consideración de extremos conducentes</strong></label>
                            </div>
                        </div>
                        <div style="margin-bottom: 20px;">
                            <div class="checkbox-option">
                                <input type="checkbox" id="causal-defectos-normativa" name="causalArbitrariedad" value="defectos_fundamentacion_normativa" onclick="toggleDefectosNormativa(this); actualizarResumenEnTiempoReal()">
                                <label for="causal-defectos-normativa"><strong>Defectos en la fundamentación normativa</strong></label>
                            </div>
                            <div id="defectosNormativaContainer" class="conditional-section" style="display: none; margin-left: 25px; margin-top: 10px;">
                                <div class="options-container" style="grid-template-columns: 1fr;">
                                    <div class="checkbox-option" style="background: #f8f9fa;">
                                        <input type="checkbox" id="normativa-interpretacion-erronea" name="opcionesNormativa" value="interpretacion_aplicacion_erronea" onclick="actualizarResumenEnTiempoReal()">
                                        <label for="normativa-interpretacion-erronea">Interpretación o aplicación errónea de la norma</label>
                                    </div>
                                    <div class="checkbox-option" style="background: #f8f9fa;">
                                        <input type="checkbox" id="normativa-apartamiento" name="opcionesNormativa" value="apartamiento_omision_normativa" onclick="actualizarResumenEnTiempoReal()">
                                        <label for="normativa-apartamiento">Apartamiento u omisión normativa</label>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div style="margin-bottom: 15px;">
                            <div class="checkbox-option">
                                <input type="checkbox" id="causal-excesos-omisiones" name="causalArbitrariedad" value="excesos_omisiones_pronunciamiento" onclick="actualizarResumenEnTiempoReal()">
                                <label for="causal-excesos-omisiones"><strong>Excesos u omisiones en el pronunciamiento</strong></label>
                            </div>
                        </div>
                        <div style="margin-bottom: 15px;">
                            <div class="checkbox-option">
                                <input type="checkbox" id="causal-exceso-ritual" name="causalArbitrariedad" value="exceso_ritual_manifiesto" onclick="actualizarResumenEnTiempoReal()">
                                <label for="causal-exceso-ritual"><strong>Exceso ritual manifiesto</strong></label>
                            </div>
                        </div>
                        <div style="margin-bottom: 5px;">
                            <div class="checkbox-option">
                                <input type="checkbox" id="causal-contradiccion" name="causalArbitrariedad" value="contradiccion" onclick="actualizarResumenEnTiempoReal()">
                                <label for="causal-contradiccion"><strong>Contradicción</strong></label>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
            
            <!-- SECCIÓN 11: OBSERVACIONES -->
            <section class="form-section">
                <h2 class="section-title"><i class="fas fa-sticky-note"></i> 11. Observaciones adicionales</h2>
                <div class="form-grid">
                    <div class="form-group full-width">
                        <label for="observaciones">Notas, comentarios u observaciones relevantes</label>
                        <textarea id="observaciones" name="observaciones" placeholder="Agregue cualquier observación adicional que considere relevante para el análisis del fallo..." rows="4" onchange="actualizarResumenEnTiempoReal()" onkeyup="actualizarResumenEnTiempoReal()"></textarea>
                    </div>
                </div>
            </section>
            
            <!-- BOTONES -->
            <div class="buttons-container">
                <button type="button" class="btn btn-submit" onclick="guardarFallo()">
                    <i class="fas fa-save"></i> Guardar Fallo
                </button>
                <button type="button" class="btn btn-reset" onclick="resetForm()">
                    <i class="fas fa-redo"></i> Limpiar Formulario
                </button>
            </div>
        </form>
        
        <footer class="footer">
            <p>Instituto de Recursos Judiciales, Argumentación y Razonamiento Probatorio &copy; <span id="current-year"></span> | Análisis Jurisprudencial Penal</p>
            <p><i class="fas fa-info-circle"></i> Todos los campos marcados con * son obligatorios</p>
        </footer>
    </div>

    <script>
        // ============ FUNCIÓN PRINCIPAL DE ACTUALIZACIÓN - VERSIÓN DOS COLUMNAS ============
        function actualizarResumenEnTiempoReal() {
            const resumenContenido = document.getElementById('resumenContenido');
            const resumenBadge = document.getElementById('resumenBadge');
            const resumenFooter = document.getElementById('resumenFooter');
            
            const datos = recopilarDatosResumen();
            
            // Contar secciones completadas
            let contador = 0;
            if (datos.caratula) contador++;
            if (datos.integracion) contador++;
            if (datos.materias.length > 0) contador++;
            if (datos.cuestionesFederales.length > 0) contador++;
            if (datos.causalesArbitrariedad.length > 0) contador++;
            if (datos.erroresSilogismo.length > 0 || datos.argumentosAtinencia.length > 0 || datos.argumentosAmbiguedad.length > 0) contador++;
            
            resumenBadge.textContent = contador > 0 ? `${contador} secciones` : 'Sin datos';
            
            // Si no hay datos
            if (!datos.caratula && datos.materias.length === 0 && datos.cuestionesFederales.length === 0) {
                resumenContenido.innerHTML = '<span class="resumen-vacio">Complete el formulario para ver el resumen del fallo...</span>';
                resumenFooter.innerHTML = '';
                return;
            }
            
            // Determinar si hay disidencias
            let votoTexto = datos.voto === 'unanimidad' ? 'Unanimidad' : datos.voto === 'mayoria' ? 'Mayoría' : datos.voto === 'disidencias' ? 'Con disidencias' : '';
            let votoColor = datos.voto === 'unanimidad' ? '#27ae60' : datos.voto === 'mayoria' ? '#f39c12' : datos.voto === 'disidencias' ? '#e74c3c' : '#718096';
            
            let html = `
                <!-- ENCABEZADO DEL FALLO -->
                <div class="resumen-encabezado">
                    <div class="resumen-encabezado-icono">
                        <i class="fas fa-gavel"></i>
                    </div>
                    <div class="resumen-encabezado-contenido">
                        <div class="resumen-encabezado-titulo">
                            ${datos.caratula || 'FALLO SIN CARÁTULA'}
                        </div>
                        <div class="resumen-encabezado-detalle">
                            <span><i class="fas fa-bookmark"></i> ${datos.fallos || 'Sin tomo/página'}</span>
                            <span><i class="fas fa-calendar-alt"></i> ${datos.fecha || 'Sin fecha'}</span>
                            ${votoTexto ? `<span><i class="fas fa-check-circle" style="color: ${votoColor};"></i> Voto: ${votoTexto}</span>` : ''}
                        </div>
                    </div>
                    <div class="resumen-encabezado-badge">
                        <i class="fas fa-balance-scale"></i> Análisis crítico
                    </div>
                </div>
                
                <!-- CONTENIDO A DOS COLUMNAS -->
                <div class="resumen-columnas">
                    <!-- COLUMNA IZQUIERDA -->
                    <div class="resumen-columna">
            `;
            
            // ===== COLUMNA IZQUIERDA =====
            
            // 1. INTEGRACIÓN DEL TRIBUNAL
            if (datos.integracion) {
                html += `<div class="resumen-seccion">
                    <div class="resumen-seccion-titulo">
                        <i class="fas fa-users"></i> COMPOSICIÓN DEL TRIBUNAL
                    </div>
                    <div class="resumen-item">
                        <div class="resumen-icono"><i class="fas fa-user-tie"></i></div>
                        <div class="resumen-label">INTEGRACIÓN:</div>
                        <div class="resumen-valor">${datos.integracion}</div>
                    </div>`;
                
                if (datos.detalleDisidencias) {
                    html += `<div class="resumen-item">
                        <div class="resumen-icono"><i class="fas fa-comment-dots"></i></div>
                        <div class="resumen-label">DISIDENCIAS:</div>
                        <div class="resumen-valor">${datos.detalleDisidencias.substring(0, 80)}${datos.detalleDisidencias.length > 80 ? '...' : ''}</div>
                    </div>`;
                }
                html += `</div>`;
            }
            
            // 2. MATERIA PRINCIPAL Y SUBTEMA
            if (datos.materias.length > 0) {
                html += `<div class="resumen-seccion">
                    <div class="resumen-seccion-titulo">
                        <i class="fas fa-balance-scale"></i> MATERIA PRINCIPAL
                    </div>
                    <div class="resumen-item">
                        <div class="resumen-icono"><i class="fas fa-tag"></i></div>
                        <div class="resumen-label">MATERIA${datos.materias.length > 1 ? 'S' : ''}:</div>
                        <div class="resumen-valor">`;
                datos.materias.forEach(m => html += `<span class="resumen-chip">${m}</span>`);
                html += `</div></div>`;
                
                if (datos.subtema) {
                    html += `<div class="resumen-item">
                        <div class="resumen-icono"><i class="fas fa-tags"></i></div>
                        <div class="resumen-label">SUBTEMA:</div>
                        <div class="resumen-valor"><strong>${datos.subtema}</strong></div>
                    </div>`;
                }
                html += `</div>`;
            }
            
            // 3. CUESTIÓN FEDERAL
            if (datos.cuestionesFederales.length > 0) {
                html += `<div class="resumen-seccion">
                    <div class="resumen-seccion-titulo">
                        <i class="fas fa-landmark"></i> CUESTIÓN FEDERAL
                    </div>
                    <div class="resumen-item">
                        <div class="resumen-icono"><i class="fas fa-check-square"></i></div>
                        <div class="resumen-label">SELECCIONADAS:</div>
                        <div class="resumen-valor">`;
                datos.cuestionesFederales.slice(0, 3).forEach(c => html += `<span class="resumen-chip">${c}</span>`);
                if (datos.cuestionesFederales.length > 3) html += `<span class="resumen-chip">+${datos.cuestionesFederales.length - 3} más</span>`;
                html += `</div></div>`;
                
                if (datos.descripcionCuestionFederal) {
                    html += `<div class="resumen-item">
                        <div class="resumen-icono"><i class="fas fa-file-alt"></i></div>
                        <div class="resumen-label">DESCRIPCIÓN:</div>
                        <div class="resumen-valor"><em>${datos.descripcionCuestionFederal.substring(0, 70)}${datos.descripcionCuestionFederal.length > 70 ? '...' : ''}</em></div>
                    </div>`;
                }
                html += `</div>`;
            }
            
            // 4. TIPO DE DESACUERDO Y PROBLEMA
            if (datos.desacuerdos.length > 0 || datos.problemas.length > 0) {
                html += `<div class="resumen-seccion">
                    <div class="resumen-seccion-titulo">
                        <i class="fas fa-exclamation-triangle"></i> DESACUERDO Y PROBLEMA
                    </div>`;
                if (datos.desacuerdos.length > 0) {
                    html += `<div class="resumen-item">
                        <div class="resumen-icono"><i class="fas fa-exchange-alt"></i></div>
                        <div class="resumen-label">DESACUERDO:</div>
                        <div class="resumen-valor">${datos.desacuerdos.join(' · ')}</div>
                    </div>`;
                }
                if (datos.problemas.length > 0) {
                    html += `<div class="resumen-item">
                        <div class="resumen-icono"><i class="fas fa-question-circle"></i></div>
                        <div class="resumen-label">PROBLEMA:</div>
                        <div class="resumen-valor">${datos.problemas.join(' · ')}</div>
                    </div>`;
                }
                if (datos.rolPrueba) {
                    let rolColor = datos.rolPrueba === 'central' ? '#e74c3c' : datos.rolPrueba === 'secundario' ? '#f39c12' : '#27ae60';
                    html += `<div class="resumen-item">
                        <div class="resumen-icono"><i class="fas fa-clipboard-check"></i></div>
                        <div class="resumen-label">ROL PRUEBA:</div>
                        <div class="resumen-valor"><span style="color: ${rolColor}; font-weight: 600;">${datos.rolPrueba.charAt(0).toUpperCase() + datos.rolPrueba.slice(1)}</span></div>
                    </div>`;
                }
                html += `</div>`;
            }
            
            // CERRAR COLUMNA IZQUIERDA Y ABRIR COLUMNA DERECHA
            html += `</div><div class="resumen-columna">`;
            
            // ===== COLUMNA DERECHA =====
            
            // 5. MÉTODO INTERPRETATIVO
            if (datos.metodoInterpretativo.length > 0) {
                html += `<div class="resumen-seccion">
                    <div class="resumen-seccion-titulo">
                        <i class="fas fa-search"></i> MÉTODO INTERPRETATIVO
                    </div>
                    <div class="resumen-item">
                        <div class="resumen-icono"><i class="fas fa-magnifying-glass"></i></div>
                        <div class="resumen-label">MÉTODOS:</div>
                        <div class="resumen-valor">${datos.metodoInterpretativo.slice(0, 4).join(' · ')}${datos.metodoInterpretativo.length > 4 ? ` <span style="color: var(--accent-color);">(+${datos.metodoInterpretativo.length - 4})</span>` : ''}</div>
                    </div>
                </div>`;
            }
            
            // 6. COLISIÓN DE PRINCIPIOS
            if (datos.colisionPrincipios === 'si' && datos.principioA && datos.principioB) {
                html += `<div class="resumen-seccion">
                    <div class="resumen-seccion-titulo">
                        <i class="fas fa-scale-balanced"></i> PONDERACIÓN
                    </div>
                    <div class="resumen-item">
                        <div class="resumen-icono"><i class="fas fa-gavel"></i></div>
                        <div class="resumen-label">COLISIÓN:</div>
                        <div class="resumen-valor">
                            <span style="background: #e8f0fe; padding: 3px 10px; border-radius: 20px;">${datos.principioA}</span>
                            <span style="margin: 0 5px; color: var(--danger-color); font-weight: 600;">VS</span>
                            <span style="background: #e8f0fe; padding: 3px 10px; border-radius: 20px;">${datos.principioB}</span>
                        </div>
                    </div>
                </div>`;
            }
            
            // 7. ERRORES DEL RAZONAMIENTO
            if (datos.erroresSilogismo.length > 0 || datos.argumentosAtinencia.length > 0 || datos.argumentosAmbiguedad.length > 0) {
                let total = datos.erroresSilogismo.length + datos.argumentosAtinencia.length + datos.argumentosAmbiguedad.length;
                html += `<div class="resumen-seccion">
                    <div class="resumen-seccion-titulo">
                        <i class="fas fa-times-circle"></i> ERRORES DEL RAZONAMIENTO
                        <span style="background: #e74c3c20; color: var(--danger-color); padding: 2px 10px; border-radius: 30px; font-size: 0.7rem; margin-left: 8px;">${total} detectado${total !== 1 ? 's' : ''}</span>
                    </div>`;
                if (datos.erroresSilogismo.length > 0) {
                    html += `<div class="resumen-item">
                        <div class="resumen-icono"><i class="fas fa-sitemap"></i></div>
                        <div class="resumen-label">FORMALES:</div>
                        <div class="resumen-valor">${datos.erroresSilogismo.join(' · ')}</div>
                    </div>`;
                }
                if (datos.argumentosAtinencia.length > 0) {
                    html += `<div class="resumen-item">
                        <div class="resumen-icono"><i class="fas fa-comment"></i></div>
                        <div class="resumen-label">ATINENCIA:</div>
                        <div class="resumen-valor">${datos.argumentosAtinencia.slice(0, 3).join(' · ')}${datos.argumentosAtinencia.length > 3 ? ` <span style="color: var(--accent-color);">(+${datos.argumentosAtinencia.length - 3})</span>` : ''}</div>
                    </div>`;
                }
                if (datos.argumentosAmbiguedad.length > 0) {
                    html += `<div class="resumen-item">
                        <div class="resumen-icono"><i class="fas fa-language"></i></div>
                        <div class="resumen-label">AMBIGÜEDAD:</div>
                        <div class="resumen-valor">${datos.argumentosAmbiguedad.slice(0, 3).join(' · ')}${datos.argumentosAmbiguedad.length > 3 ? ` <span style="color: var(--accent-color);">(+${datos.argumentosAmbiguedad.length - 3})</span>` : ''}</div>
                    </div>`;
                }
                html += `</div>`;
            }
            
            // 8. CAUSALES DE ARBITRARIEDAD
            if (datos.causalesArbitrariedad.length > 0) {
                html += `<div class="resumen-seccion">
                    <div class="resumen-seccion-titulo">
                        <i class="fas fa-gavel"></i> CAUSALES DE ARBITRARIEDAD
                        <span style="background: #3498db20; color: var(--accent-color); padding: 2px 10px; border-radius: 30px; font-size: 0.7rem; margin-left: 8px;">${datos.causalesArbitrariedad.length} causal${datos.causalesArbitrariedad.length !== 1 ? 'es' : ''}</span>
                    </div>
                    <div class="resumen-item">
                        <div class="resumen-icono"><i class="fas fa-list-check"></i></div>
                        <div class="resumen-label">CAUSALES:</div>
                        <div class="resumen-valor">`;
                datos.causalesArbitrariedad.slice(0, 4).forEach(c => html += `<span class="resumen-chip">${c}</span>`);
                if (datos.causalesArbitrariedad.length > 4) html += `<span class="resumen-chip">+${datos.causalesArbitrariedad.length - 4} más</span>`;
                html += `</div></div></div>`;
            }
            
            // 9. OBSERVACIONES
            if (datos.observaciones) {
                html += `<div class="resumen-seccion">
                    <div class="resumen-seccion-titulo">
                        <i class="fas fa-sticky-note"></i> OBSERVACIONES
                    </div>
                    <div class="resumen-item">
                        <div class="resumen-icono"><i class="fas fa-quote-left"></i></div>
                        <div class="resumen-label">NOTAS:</div>
                        <div class="resumen-valor"><em>${datos.observaciones.substring(0, 100)}${datos.observaciones.length > 100 ? '...' : ''}</em></div>
                    </div>
                </div>`;
            }
            
            // CERRAR COLUMNA DERECHA Y CONTENEDOR
            html += `</div></div>`;
            
            resumenContenido.innerHTML = html;
            resumenFooter.innerHTML = `
                <div class="resumen-footer-left">
                    <i class="fas fa-clock"></i> Actualizado: ${new Date().toLocaleTimeString('es-AR')}
                    <span><i class="fas fa-university"></i> Instituto de Recursos Judiciales</span>
                </div>
                <div class="resumen-footer-right">
                    <i class="fas fa-file-signature"></i> Análisis en tiempo real
                </div>
            `;
        }

        // ============ RECOPILACIÓN DE DATOS ============
        function recopilarDatosResumen() {
            const datos = {
                caratula: document.getElementById('caratula').value || '',
                fallos: document.getElementById('fallos').value || '',
                fecha: document.getElementById('fecha').value ? new Date(document.getElementById('fecha').value).toLocaleDateString('es-AR') : '',
                integracion: document.getElementById('integracion').value || '',
                voto: document.querySelector('input[name="voto"]:checked')?.value || '',
                detalleDisidencias: document.getElementById('detalleDisidencias')?.value || '',
                materias: [], 
                subtema: '', 
                cuestionesFederales: [], 
                descripcionCuestionFederal: document.getElementById('descripcionCuestionFederal')?.value || '',
                desacuerdos: [], 
                problemas: [], 
                rolPrueba: document.querySelector('input[name="rolPrueba"]:checked')?.value || '', 
                metodoInterpretativo: [],
                colisionPrincipios: document.querySelector('input[name="colisionPrincipios"]:checked')?.value || '', 
                principioA: '', 
                principioB: '', 
                erroresSilogismo: [], 
                argumentosAtinencia: [], 
                argumentosAmbiguedad: [],
                causalesArbitrariedad: [], 
                observaciones: document.getElementById('observaciones').value || ''
            };

            // MATERIAS
            document.querySelectorAll('input[name="materiaPrincipal"]:checked').forEach(cb => {
                if (cb.value === 'arbitrariedad_sentencia') {
                    let sub = [];
                    document.querySelectorAll('#arbitrariedadSubopcionesContainer input[type="checkbox"]:checked').forEach(s => {
                        if (s.id === 'arbitrariedad-normativa') sub.push('Normativa');
                        if (s.id === 'arbitrariedad-clasica') sub.push('Clásica');
                    });
                    datos.materias.push(`Arbitrariedad${sub.length ? ' (' + sub.join('/') + ')' : ''}`);
                } else if (cb.value === 'otro') {
                    let c = document.getElementById('customMateriaPrincipal').value;
                    datos.materias.push(c || 'Otro');
                } else {
                    let l = cb.nextElementSibling?.textContent.trim() || cb.value;
                    if (l.includes('Afectación')) datos.materias.push('Afectación derechos');
                    else if (l.includes('Interpretación de tratados')) datos.materias.push('Interpretación tratados');
                    else if (l.includes('Interpretación de leyes')) datos.materias.push('Interpretación leyes fed.');
                    else if (l.includes('Fuero penal')) datos.materias.push('Penal económico');
                    else datos.materias.push(l);
                }
            });

            // SUBTEMA
            let s = document.getElementById('subtema');
            if (s.value) {
                if (s.value !== 'otro') datos.subtema = s.options[s.selectedIndex]?.text || '';
                else datos.subtema = document.getElementById('customSubtema').value || 'Otro';
            }

            // CUESTIONES FEDERALES
            document.querySelectorAll('input[name="cuestionFederal"]:checked').forEach(cb => {
                if (cb.value === 'otro') {
                    let c = document.getElementById('customCuestionFederal').value;
                    datos.cuestionesFederales.push(c || 'Otro');
                } else {
                    let l = cb.nextElementSibling?.textContent.trim() || cb.value;
                    datos.cuestionesFederales.push(l);
                }
            });

            // DESACUERDOS
            document.querySelectorAll('input[name="tipoDesacuerdo"]:checked').forEach(cb => {
                datos.desacuerdos.push(cb.nextElementSibling.textContent.trim());
            });

            // PROBLEMAS
            document.querySelectorAll('input[name="problemaJuridico"]:checked').forEach(cb => {
                datos.problemas.push(cb.nextElementSibling.textContent.trim());
            });

            // MÉTODO INTERPRETATIVO
            document.querySelectorAll('input[name="metodoInterpretativo"]:checked').forEach(cb => {
                datos.metodoInterpretativo.push(cb.nextElementSibling.textContent.trim());
            });

            // PRINCIPIOS
            if (document.getElementById('colision-si')?.checked) {
                datos.principioA = obtenerValorConPersonalizado('principioA', 'customPrincipioA');
                datos.principioB = obtenerValorConPersonalizado('principioB', 'customPrincipioB');
            }

            // ERRORES
            document.querySelectorAll('input[name="erroresSilogismo"]:checked').forEach(cb => {
                datos.erroresSilogismo.push(cb.nextElementSibling.textContent.trim());
            });
            if (document.getElementById('argumentos-atinencia-principal')?.checked) {
                document.querySelectorAll('#argumentosAtinenciaContainer input[type="checkbox"]:checked').forEach(cb => {
                    datos.argumentosAtinencia.push(cb.nextElementSibling.textContent.trim());
                });
            }
            if (document.getElementById('argumentos-ambiguedad-principal')?.checked) {
                document.querySelectorAll('#argumentosAmbiguedadContainer input[type="checkbox"]:checked').forEach(cb => {
                    datos.argumentosAmbiguedad.push(cb.nextElementSibling.textContent.trim());
                });
            }

            // ARBITRARIEDAD (versión simplificada)
            document.querySelectorAll('input[name="causalArbitrariedad"]:checked').forEach(cb => {
                let texto = cb.nextElementSibling.textContent.trim();
                if (texto.includes('Falta de fundamentación')) texto = 'Falta fundamentación';
                else if (texto.includes('Apartamiento')) texto = 'Apartamiento';
                else if (texto.includes('Valoración')) texto = 'Valoración hechos';
                else if (texto.includes('Defectos en la consideración')) texto = 'Defectos extremos';
                else if (texto.includes('Defectos en la fundamentación normativa')) texto = 'Defectos normativos';
                else if (texto.includes('Excesos')) texto = 'Excesos/omisiones';
                else if (texto.includes('Exceso ritual')) texto = 'Exceso ritual';
                else if (texto.includes('Contradicción')) texto = 'Contradicción';
                datos.causalesArbitrariedad.push(texto);
            });

            return datos;
        }

        // ============ FUNCIONES AUXILIARES ============
        function obtenerValorConPersonalizado(selectId, customInputId) {
            let s = document.getElementById(selectId);
            if (!s) return '';
            if (s.value === 'otro') { 
                let c = document.getElementById(customInputId); 
                return c ? c.value : ''; 
            }
            return s.options[s.selectedIndex]?.text || '';
        }

        function obtenerCheckboxes(n) { 
            return Array.from(document.querySelectorAll(`input[name="${n}"]:checked`)).map(cb => cb.value).join('; '); 
        }

        // ============ TOGGLES ============
        function toggleArbitrariedadSubopciones(cb) {
            let c = document.getElementById('arbitrariedadSubopcionesContainer');
            if (cb.checked) c.style.display = 'block';
            else { 
                c.style.display = 'none'; 
                c.querySelectorAll('input[type="checkbox"]').forEach(cb => cb.checked = false); 
            }
            actualizarResumenEnTiempoReal();
        }
        
        function toggleCustomMateriaPrincipal(cb) {
            let c = document.getElementById('customMateriaPrincipalContainer');
            if (cb.checked) c.style.display = 'block';
            else { 
                c.style.display = 'none'; 
                document.getElementById('customMateriaPrincipal').value = ''; 
            }
            actualizarResumenEnTiempoReal();
        }
        
        function toggleCustomSubtema(s) {
            let c = document.getElementById('customSubtemaContainer');
            if (s.value === 'otro') c.style.display = 'block';
            else { 
                c.style.display = 'none'; 
                document.getElementById('customSubtema').value = ''; 
            }
            actualizarResumenEnTiempoReal();
        }
        
        function toggleCustomCuestionFederal(cb) {
            let c = document.getElementById('customCuestionFederalContainer');
            if (cb.checked) c.style.display = 'block';
            else { 
                c.style.display = 'none'; 
                document.getElementById('customCuestionFederal').value = ''; 
            }
            actualizarResumenEnTiempoReal();
        }
        
        function toggleCustomPrincipioA(s) {
            let c = document.getElementById('customPrincipioAContainer');
            c.style.display = s.value === 'otro' ? 'block' : 'none';
            if (s.value !== 'otro') document.getElementById('customPrincipioA').value = '';
            actualizarResumenEnTiempoReal();
        }
        
        function toggleCustomPrincipioB(s) {
            let c = document.getElementById('customPrincipioBContainer');
            c.style.display = s.value === 'otro' ? 'block' : 'none';
            if (s.value !== 'otro') document.getElementById('customPrincipioB').value = '';
            actualizarResumenEnTiempoReal();
        }
        
        function toggleArgumentosAtinencia(cb) {
            let c = document.getElementById('argumentosAtinenciaContainer');
            if (cb.checked) c.style.display = 'block';
            else { 
                c.style.display = 'none'; 
                c.querySelectorAll('input[type="checkbox"]').forEach(cb => cb.checked = false); 
            }
            actualizarResumenEnTiempoReal();
        }
        
        function toggleArgumentosAmbiguedad(cb) {
            let c = document.getElementById('argumentosAmbiguedadContainer');
            if (cb.checked) c.style.display = 'block';
            else { 
                c.style.display = 'none'; 
                c.querySelectorAll('input[type="checkbox"]').forEach(cb => cb.checked = false); 
            }
            actualizarResumenEnTiempoReal();
        }
        
        function toggleFaltaFundamentacion(cb) {
            let c = document.getElementById('faltaFundamentacionContainer');
            if (cb.checked) c.style.display = 'block';
            else { 
                c.style.display = 'none'; 
                c.querySelectorAll('input[type="checkbox"]').forEach(cb => cb.checked = false); 
            }
            actualizarResumenEnTiempoReal();
        }
        
        function toggleDefectosNormativa(cb) {
            let c = document.getElementById('defectosNormativaContainer');
            if (cb.checked) c.style.display = 'block';
            else { 
                c.style.display = 'none'; 
                c.querySelectorAll('input[type="checkbox"]').forEach(cb => cb.checked = false); 
            }
            actualizarResumenEnTiempoReal();
        }
        
        function toggleCollapsible(e) {
            e.classList.toggle('active');
            e.nextElementSibling.classList.toggle('active');
        }
        
        function toggleDisidencias(m) {
            let c = document.getElementById('disidenciasContainer');
            if (m) c.classList.add('active');
            else { 
                c.classList.remove('active'); 
                document.getElementById('detalleDisidencias').value = ''; 
            }
            actualizarResumenEnTiempoReal();
        }
        
        function togglePrincipiosContainer(m) {
            let c = document.getElementById('principiosContainer');
            if (m) c.classList.add('active');
            else { 
                c.classList.remove('active'); 
                document.getElementById('principioA').value = ''; 
                document.getElementById('principioB').value = ''; 
                document.getElementById('customPrincipioA').value = ''; 
                document.getElementById('customPrincipioB').value = ''; 
                document.getElementById('customPrincipioAContainer').style.display = 'none'; 
                document.getElementById('customPrincipioBContainer').style.display = 'none'; 
            }
            actualizarResumenEnTiempoReal();
        }
        
        function toggleProbatorio(m) {
            let c = document.getElementById('probatorioContainer');
            let chk = document.getElementById('problema-probatorio');
            if (m && chk.checked) c.classList.add('active');
            else { 
                c.classList.remove('active'); 
                c.querySelectorAll('input').forEach(i => { 
                    if (i.type === 'checkbox' || i.type === 'radio') i.checked = false; 
                }); 
            }
            actualizarResumenEnTiempoReal();
        }

        // ============ GUARDADO Y RESET ============
        function validarProblemaJuridico() { 
            return document.querySelectorAll('input[name="problemaJuridico"]:checked').length > 0; 
        }
        
        function recopilarDatos() {
            return {
                caratula: document.getElementById('caratula').value,
                fallos: document.getElementById('fallos').value,
                fecha: document.getElementById('fecha').value,
                integracion: document.getElementById('integracion').value,
                voto: document.querySelector('input[name="voto"]:checked')?.value || '',
                disidencias: document.getElementById('detalleDisidencias')?.value || '',
                materiaPrincipal: obtenerCheckboxes('materiaPrincipal'),
                customMateriaPrincipal: document.getElementById('customMateriaPrincipal')?.value || '',
                causalesArbitrariedad: obtenerCheckboxes('causalesArbitrariedad'),
                subtema: obtenerValorConPersonalizado('subtema', 'customSubtema'),
                cuestionFederal: obtenerCheckboxes('cuestionFederal'),
                customCuestionFederal: document.getElementById('customCuestionFederal')?.value || '',
                descripcionCuestionFederal: document.getElementById('descripcionCuestionFederal')?.value || '',
                tipoDesacuerdo: obtenerCheckboxes('tipoDesacuerdo'),
                problemaJuridico: obtenerCheckboxes('problemaJuridico'),
                rolPrueba: document.querySelector('input[name="rolPrueba"]:checked')?.value || '',
                tipoInferencias: obtenerCheckboxes('tipoInferencias'),
                metodoInterpretativo: obtenerCheckboxes('metodoInterpretativo'),
                colisionPrincipios: document.querySelector('input[name="colisionPrincipios"]:checked')?.value || '',
                principioA: obtenerValorConPersonalizado('principioA', 'customPrincipioA'),
                principioB: obtenerValorConPersonalizado('principioB', 'customPrincipioB'),
                estructuraPonderacion: obtenerCheckboxes('estructuraPonderacion'),
                tipoRazonamiento: obtenerCheckboxes('tipoRazonamiento'),
                erroresSilogismo: obtenerCheckboxes('erroresSilogismo'),
                argumentosAtinencia: obtenerCheckboxes('argumentosAtinencia'),
                argumentosAmbiguedad: obtenerCheckboxes('argumentosAmbiguedad'),
                causalArbitrariedad: obtenerCheckboxes('causalArbitrariedad'),
                opcionesFundamentacion: obtenerCheckboxes('opcionesFundamentacion'),
                opcionesNormativa: obtenerCheckboxes('opcionesNormativa'),
                observaciones: document.getElementById('observaciones').value,
                timestamp: new Date().toISOString(),
                fechaRegistro: new Date().toLocaleString('es-AR')
            };
        }

        function guardarFallo() {
            let c = document.getElementById('caratula').value, f = document.getElementById('fecha').value;
            if (!c || !f) { 
                showStatus('Complete todos los campos obligatorios', 'error'); 
                return; 
            }
            if (!validarProblemaJuridico()) { 
                showStatus('Debe seleccionar al menos un tipo de problema jurídico', 'error'); 
                return; 
            }
            if (document.getElementById('voto-disidencias').checked && !document.getElementById('detalleDisidencias').value) { 
                showStatus('Debe detallar las disidencias', 'error'); 
                return; 
            }
            if (document.getElementById('colision-si')?.checked) {
                let a = obtenerValorConPersonalizado('principioA', 'customPrincipioA'), 
                    b = obtenerValorConPersonalizado('principioB', 'customPrincipioB');
                if (!a || !b) { 
                    showStatus('Debe especificar ambos principios cuando hay colisión', 'error'); 
                    return; 
                }
            }
            console.log('Datos del fallo:', recopilarDatos());
            showStatus(`Fallo "${c}" procesado correctamente`, 'success');
        }

        function showStatus(m, t) {
            let s = document.getElementById('statusMessage');
            s.textContent = m; 
            s.className = `status-message status-${t}`; 
            s.style.display = 'block';
            setTimeout(() => s.style.display = 'none', 5000);
        }

        function resetForm() {
            if (confirm('¿Está seguro de que desea limpiar todo el formulario?')) {
                document.getElementById('fallosForm').reset();
                document.querySelectorAll('.conditional-section, .custom-input').forEach(el => { 
                    el.classList.remove('active'); 
                    el.style.display = 'none'; 
                });
                document.querySelectorAll('.collapsible-content').forEach(c => c.classList.remove('active'));
                document.querySelectorAll('.collapsible-header').forEach(h => h.classList.remove('active'));
                actualizarResumenEnTiempoReal();
                showStatus('Formulario limpiado correctamente', 'success');
            }
        }

        // ============ INICIALIZACIÓN ============
        document.getElementById('current-year').textContent = new Date().getFullYear();
        document.getElementById('fecha').valueAsDate = new Date();
        document.addEventListener('DOMContentLoaded', function() {
            document.querySelectorAll('.custom-input').forEach(el => el.style.display = 'none');
            actualizarResumenEnTiempoReal();
            ['argumentos-atinencia-principal', 'argumentos-ambiguedad-principal', 'causal-falta-fundamentacion', 'causal-defectos-normativa'].forEach(id => {
                let e = document.getElementById(id);
                if (e && e.checked) document.getElementById(id + (id.includes('causal') ? 'Container' : 'Container')).style.display = 'block';
            });
        });
    </script>
</body>
</html>
