<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Consulta de Fallos - Instituto de Recursos Judiciales</title>
    <link rel="icon" type="image/png" sizes="32x32" href="favicon.png">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --primary-color: #2c3e50;
            --secondary-color: #34495e;
            --accent-color: #3498db;
            --success-color: #27ae60;
            --warning-color: #f39c12;
            --danger-color: #e74c3c;
            --light-color: #ecf0f1;
            --dark-color: #2c3e50;
            --border-color: #bdc3c7;
            --shadow: 0 2px 8px rgba(0,0,0,0.1);
            --border-radius: 6px;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Roboto', sans-serif;
            background-color: #f5f7fa;
            color: #333;
            line-height: 1.6;
            padding: 20px;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        
        /* Header */
        .header {
            background: linear-gradient(135deg, #1a2634, #2c3e50);
            color: white;
            padding: 20px 30px;
            border-radius: var(--border-radius);
            margin-bottom: 25px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 15px;
        }
        
        .header h1 {
            font-size: 1.8rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .header h1 i {
            color: var(--accent-color);
        }
        
        .nav-links {
            display: flex;
            gap: 15px;
        }
        
        .nav-link {
            color: white;
            text-decoration: none;
            padding: 8px 16px;
            border-radius: 30px;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 6px;
        }
        
        .nav-link:hover {
            background: rgba(255,255,255,0.1);
        }
        
        .nav-link.active {
            background: var(--accent-color);
        }
        
        /* Panel de filtros */
        .filtros-panel {
            background: white;
            border-radius: var(--border-radius);
            padding: 25px;
            margin-bottom: 30px;
            box-shadow: var(--shadow);
        }
        
        .filtros-titulo {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--accent-color);
            color: var(--primary-color);
        }
        
        .filtros-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .filtro-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--secondary-color);
        }
        
        .filtro-group input,
        .filtro-group select {
            width: 100%;
            padding: 10px 12px;
            border: 1.5px solid var(--border-color);
            border-radius: var(--border-radius);
            font-size: 0.95rem;
        }
        
        .filtro-group input:focus,
        .filtro-group select:focus {
            outline: none;
            border-color: var(--accent-color);
        }
        
        .filtros-actions {
            display: flex;
            justify-content: flex-end;
            gap: 15px;
        }
        
        .btn {
            padding: 12px 25px;
            border: none;
            border-radius: var(--border-radius);
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }
        
        .btn-primary {
            background: var(--accent-color);
            color: white;
        }
        
        .btn-primary:hover {
            background: #2980b9;
            transform: translateY(-2px);
            box-shadow: var(--shadow);
        }
        
        .btn-secondary {
            background: var(--light-color);
            color: var(--dark-color);
        }
        
        .btn-secondary:hover {
            background: #dfe6e9;
        }
        
        /* Estadísticas rápidas */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: white;
            border-radius: var(--border-radius);
            padding: 20px;
            box-shadow: var(--shadow);
            display: flex;
            align-items: center;
            gap: 15px;
            border-left: 4px solid var(--accent-color);
        }
        
        .stat-icon {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: rgba(52,152,219,0.1);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--accent-color);
            font-size: 1.5rem;
        }
        
        .stat-info h3 {
            font-size: 1.8rem;
            font-weight: 700;
            color: var(--primary-color);
            line-height: 1.2;
        }
        
        .stat-info p {
            color: var(--gray-600);
            font-size: 0.9rem;
        }
        
        /* Tabla de resultados */
        .resultados-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            flex-wrap: wrap;
            gap: 15px;
        }
        
        .resultados-titulo {
            display: flex;
            align-items: center;
            gap: 10px;
            color: var(--primary-color);
        }
        
        .export-buttons {
            display: flex;
            gap: 10px;
        }
        
        .btn-export {
            background: var(--success-color);
            color: white;
            padding: 8px 16px;
        }
        
        .btn-export:hover {
            background: #219653;
        }
        
        .table-container {
            background: white;
            border-radius: var(--border-radius);
            padding: 5px;
            box-shadow: var(--shadow);
            overflow-x: auto;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
        }
        
        th {
            background: var(--primary-color);
            color: white;
            padding: 12px 15px;
            text-align: left;
            font-weight: 500;
            font-size: 0.9rem;
        }
        
        td {
            padding: 12px 15px;
            border-bottom: 1px solid #ecf0f1;
        }
        
        tr:hover {
            background: #f8f9fa;
        }
        
        .badge {
            padding: 4px 8px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 500;
            display: inline-block;
        }
        
        .badge-success {
            background: #d4edda;
            color: #155724;
        }
        
        .badge-warning {
            background: #fff3cd;
            color: #856404;
        }
        
        .badge-info {
            background: #d1ecf1;
            color: #0c5460;
        }
        
        .action-btn {
            background: none;
            border: none;
            color: var(--accent-color);
            cursor: pointer;
            margin: 0 5px;
            font-size: 1rem;
        }
        
        .action-btn:hover {
            color: var(--primary-color);
        }
        
        .pagination {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 15px;
            margin-top: 25px;
        }
        
        .pagination-btn {
            background: white;
            border: 1px solid var(--border-color);
            padding: 8px 16px;
            border-radius: var(--border-radius);
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .pagination-btn:hover:not(.disabled) {
            background: var(--accent-color);
            color: white;
            border-color: var(--accent-color);
        }
        
        .pagination-btn.disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .page-info {
            font-weight: 500;
        }
        
        /* Modal */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
        }
        
        .modal-content {
            background-color: white;
            margin: 5% auto;
            padding: 0;
            width: 80%;
            max-width: 800px;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            animation: slideIn 0.3s;
        }
        
        @keyframes slideIn {
            from { transform: translateY(-50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        
        .modal-header {
            padding: 20px 25px;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            border-radius: var(--border-radius) var(--border-radius) 0 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .modal-close {
            color: white;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }
        
        .modal-body {
            padding: 25px;
            max-height: 60vh;
            overflow-y: auto;
        }
        
        .modal-footer {
            padding: 15px 25px;
            background: var(--light-color);
            border-radius: 0 0 var(--border-radius) var(--border-radius);
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }
        
        .fallo-detalle-item {
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid #edf2f7;
        }
        
        .fallo-detalle-label {
            font-size: 0.8rem;
            color: var(--gray-600);
            text-transform: uppercase;
            margin-bottom: 3px;
        }
        
        .fallo-detalle-value {
            font-size: 1rem;
            color: var(--dark-color);
            font-weight: 500;
        }
        
        .empty-state {
            text-align: center;
            padding: 40px;
            color: var(--gray-600);
        }
        
        .empty-state i {
            font-size: 3rem;
            margin-bottom: 15px;
            color: var(--border-color);
        }
        
        /* Footer */
        .footer {
            text-align: center;
            margin-top: 40px;
            padding: 20px;
            color: var(--gray-600);
            border-top: 1px solid var(--border-color);
        }
        
        @media (max-width: 768px) {
            .filtros-grid {
                grid-template-columns: 1fr;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .header {
                flex-direction: column;
                text-align: center;
            }
            
            .resultados-header {
                flex-direction: column;
                align-items: flex-start;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1>
                <i class="fas fa-search"></i> 
                Consulta de Fallos Judiciales
            </h1>
            <div class="nav-links">
                <a href="index.html" class="nav-link">
                    <i class="fas fa-edit"></i> Carga
                </a>
                <a href="consulta.html" class="nav-link active">
                    <i class="fas fa-search"></i> Consulta
                </a>
                <a href="estadisticas.html" class="nav-link">
                    <i class="fas fa-chart-bar"></i> Estadísticas
                </a>
            </div>
        </div>
        
        <!-- Panel de filtros -->
        <div class="filtros-panel">
            <div class="filtros-titulo">
                <i class="fas fa-filter"></i>
                <h2>Filtros de búsqueda</h2>
            </div>
            
            <div class="filtros-grid">
                <div class="filtro-group">
                    <label>Carátula</label>
                    <input type="text" id="filtroCaratula" placeholder="Ej: Pérez, Juan...">
                </div>
                
                <div class="filtro-group">
                    <label>N° Causa</label>
                    <input type="text" id="filtroCausa" placeholder="Ej: 12345/2023">
                </div>
                
                <div class="filtro-group">
                    <label>Materia principal</label>
                    <select id="filtroMateria">
                        <option value="">Todas las materias</option>
                        <option value="Aplicación/determinación de la pena">Aplicación/determinación de la pena</option>
                        <option value="Control de oficio del orden público">Control de oficio del orden público</option>
                        <option value="Cuestiones de competencia">Cuestiones de competencia</option>
                        <option value="Decomiso de bienes">Decomiso de bienes</option>
                        <option value="Derechos convencionales">Derechos convencionales</option>
                        <option value="Detención ilegal">Detención ilegal</option>
                        <option value="Ejecución de la pena privativa de libertad">Ejecución de la pena privativa de libertad</option>
                        <option value="Estupefacientes">Estupefacientes</option>
                        <option value="Garantía de defensa en juicio">Garantía de defensa en juicio</option>
                        <option value="Incompetencia de la justicia federal">Incompetencia de la justicia federal</option>
                        <option value="Prisión preventiva">Prisión preventiva</option>
                        <option value="Prohibición de autoincriminación">Prohibición de autoincriminación</option>
                        <option value="Supremacía constitucional">Supremacía constitucional</option>
                        <option value="Violación al debido proceso">Violación al debido proceso</option>
                        <option value="Violación del plazo razonable">Violación del plazo razonable</option>
                    </select>
                </div>
                
                <div class="filtro-group">
                    <label>Voto</label>
                    <select id="filtroVoto">
                        <option value="">Todos</option>
                        <option value="unanimidad">Unanimidad</option>
                        <option value="mayoria">Mayoría</option>
                        <option value="disidencias">Con disidencias</option>
                    </select>
                </div>
                
                <div class="filtro-group">
                    <label>Admisibilidad</label>
                    <select id="filtroAdmisibilidad">
                        <option value="">Todas</option>
                        <option value="si">Sí</option>
                        <option value="no">No</option>
                    </select>
                </div>
                
                <div class="filtro-group">
                    <label>Arbitrariedad</label>
                    <select id="filtroArbitrariedad">
                        <option value="">Todas</option>
                        <option value="normativa">Normativa</option>
                        <option value="factica">Fáctica</option>
                        <option value="logica">Lógica</option>
                        <option value="otras">Otras causales</option>
                    </select>
                </div>
                
                <div class="filtro-group">
                    <label>Fecha desde</label>
                    <input type="date" id="filtroFechaDesde">
                </div>
                
                <div class="filtro-group">
                    <label>Fecha hasta</label>
                    <input type="date" id="filtroFechaHasta">
                </div>
            </div>
            
            <div class="filtros-actions">
                <button class="btn btn-secondary" onclick="limpiarFiltros()">
                    <i class="fas fa-undo"></i> Limpiar
                </button>
                <button class="btn btn-primary" onclick="buscarFallos()">
                    <i class="fas fa-search"></i> Buscar
                </button>
            </div>
        </div>
        
        <!-- Estadísticas rápidas -->
        <div class="stats-grid" id="statsRapidas">
            <div class="stat-card">
                <div class="stat-icon">
                    <i class="fas fa-file-alt"></i>
                </div>
                <div class="stat-info">
                    <h3 id="totalFallos">0</h3>
                    <p>Fallos cargados</p>
                </div>
            </div>
            
            <div class="stat-card">
                <div class="stat-icon">
                    <i class="fas fa-check-circle"></i>
                </div>
                <div class="stat-info">
                    <h3 id="totalAdmitidos">0</h3>
                    <p>Admitidos</p>
                </div>
            </div>
            
            <div class="stat-card">
                <div class="stat-icon">
                    <i class="fas fa-times-circle"></i>
                </div>
                <div class="stat-info">
                    <h3 id="totalInadmisibles">0</h3>
                    <p>Inadmisibles</p>
                </div>
            </div>
            
            <div class="stat-card">
                <div class="stat-icon">
                    <i class="fas fa-gavel"></i>
                </div>
                <div class="stat-info">
                    <h3 id="totalArbitrariedad">0</h3>
                    <p>Con arbitrariedad</p>
                </div>
            </div>
        </div>
        
        <!-- Resultados -->
        <div class="resultados-header">
            <div class="resultados-titulo">
                <i class="fas fa-list"></i>
                <h2>Resultados de la búsqueda</h2>
            </div>
            <div class="export-buttons">
                <button class="btn btn-export" onclick="exportarCSV()">
                    <i class="fas fa-file-csv"></i> Exportar CSV
                </button>
                <button class="btn btn-export" onclick="exportarExcel()">
                    <i class="fas fa-file-excel"></i> Exportar Excel
                </button>
            </div>
        </div>
        
        <div class="table-container">
            <table id="tablaResultados">
                <thead>
                    <tr>
                        <th>Carátula</th>
                        <th>N° Causa</th>
                        <th>Fecha</th>
                        <th>Materia</th>
                        <th>Voto</th>
                        <th>Admisibilidad</th>
                        <th>Arbitrariedad</th>
                        <th>Acciones</th>
                    </tr>
                </thead>
                <tbody id="tablaBody">
                    <tr>
                        <td colspan="8" class="empty-state">
                            <i class="fas fa-search"></i>
                            <p>No hay resultados para mostrar. Utilice los filtros para buscar fallos.</p>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
        
        <!-- Paginación -->
        <div class="pagination" id="paginacion">
            <button class="pagination-btn" id="btnPrev" onclick="cambiarPagina('prev')" disabled>
                <i class="fas fa-chevron-left"></i> Anterior
            </button>
            <span class="page-info" id="pageInfo">Página 1 de 1</span>
            <button class="pagination-btn" id="btnNext" onclick="cambiarPagina('next')" disabled>
                Siguiente <i class="fas fa-chevron-right"></i>
            </button>
        </div>
        
        <!-- Modal de detalle -->
        <div id="detalleModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3><i class="fas fa-file-alt"></i> Detalle completo del fallo</h3>
                    <span class="modal-close" onclick="cerrarModal()">&times;</span>
                </div>
                <div class="modal-body" id="modalBody">
                    <!-- Se llena dinámicamente -->
                </div>
                <div class="modal-footer">
                    <button class="btn btn-secondary" onclick="cerrarModal()">Cerrar</button>
                </div>
            </div>
        </div>
        
        <footer class="footer">
            <p>Instituto de Recursos Judiciales &copy; <span id="current-year"></span> | Sistema de Consulta de Fallos</p>
        </footer>
    </div>

    <script>
        // ============ VARIABLES GLOBALES ============
        let fallosData = [];
        let fallosFiltrados = [];
        let paginaActual = 1;
        const resultadosPorPagina = 10;
        
        // ============ INICIALIZACIÓN ============
        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('current-year').textContent = new Date().getFullYear();
            cargarDatosDesdeStorage();
            actualizarEstadisticas();
        });
        
        // ============ CARGA DE DATOS ============
        function cargarDatosDesdeStorage() {
            // Intentar cargar desde localStorage
            const stored = localStorage.getItem('fallosJudiciales');
            if (stored) {
                try {
                    fallosData = JSON.parse(stored);
                } catch (e) {
                    console.error('Error al cargar datos:', e);
                    fallosData = generarDatosEjemplo();
                }
            } else {
                // Si no hay datos, generar datos de ejemplo
                fallosData = generarDatosEjemplo();
                localStorage.setItem('fallosJudiciales', JSON.stringify(fallosData));
            }
            
            fallosFiltrados = [...fallosData];
            mostrarResultados();
        }
        
        function generarDatosEjemplo() {
            return [
                {
                    caratula: 'Pérez, Juan c/ Estado Nacional',
                    numeroCausa: '12345/2023',
                    fecha: '2023-05-15',
                    fallos: '336:1234',
                    materiaPrincipal: 'Violación al debido proceso',
                    subtema: 'Prisión preventiva',
                    integracion: 'Juan Pérez, María González, Carlos Rodríguez',
                    voto: 'unanimidad',
                    admisibilidad: 'si',
                    motivoInadmisible: '',
                    argumentoCorte: '',
                    cuestionesFederales: ['Violación al debido proceso', 'Garantía de defensa en juicio'],
                    arbitrariedadCausales: ['Arbitrariedad fáctica'],
                    arbitrariedadFactica: ['Conceptual'],
                    opcionesFundamentacion: [],
                    opcionesNormativa: [],
                    desacuerdos: ['Normativo'],
                    problemas: ['Interpretativo'],
                    metodoInterpretativo: ['Sistemático', 'Teleológico'],
                    estructuraPonderacion: ['Necesidad'],
                    tipoRazonamiento: ['Balance explícito'],
                    erroresSilogismo: ['Afirmación del consecuente'],
                    argumentosAtinencia: ['Ad hominem'],
                    argumentosAmbiguedad: ['Equívoco'],
                    observaciones: 'Fallo importante sobre prisión preventiva'
                },
                {
                    caratula: 'González, Ana c/ ANSES',
                    numeroCausa: '67890/2023',
                    fecha: '2023-06-20',
                    fallos: '337:5678',
                    materiaPrincipal: 'Garantía de defensa en juicio',
                    subtema: 'Recurso extraordinario',
                    integracion: 'María González, Carlos Rodríguez, Luis Martínez',
                    voto: 'mayoria',
                    admisibilidad: 'no',
                    motivoInadmisible: 'Art. 280 CPCCN',
                    argumentoCorte: 'Cuestión no federal',
                    cuestionesFederales: ['Garantía de defensa en juicio'],
                    arbitrariedadCausales: ['Arbitrariedad normativa'],
                    arbitrariedadFactica: [],
                    opcionesFundamentacion: ['Afirmaciones dogmáticas o no fundadas'],
                    opcionesNormativa: [],
                    desacuerdos: ['Fáctico'],
                    problemas: ['Probatorio'],
                    metodoInterpretativo: ['Literal'],
                    estructuraPonderacion: ['Idoneidad'],
                    tipoRazonamiento: ['Balance implícito'],
                    erroresSilogismo: [],
                    argumentosAtinencia: ['Ad verecundiam'],
                    argumentosAmbiguedad: [],
                    observaciones: 'Recurso inadmisible'
                },
                {
                    caratula: 'Rodríguez, Carlos c/ Provincia de Buenos Aires',
                    numeroCausa: '54321/2023',
                    fecha: '2023-07-10',
                    fallos: '338:91011',
                    materiaPrincipal: 'Detención ilegal',
                    subtema: 'Habeas corpus',
                    integracion: 'Carlos Rodríguez, Luis Martínez, Ana Pérez',
                    voto: 'disidencias',
                    admisibilidad: 'si',
                    motivoInadmisible: '',
                    argumentoCorte: '',
                    cuestionesFederales: ['Detención ilegal', 'Prohibición de autoincriminación'],
                    arbitrariedadCausales: ['Contradicción'],
                    arbitrariedadFactica: [],
                    opcionesFundamentacion: [],
                    opcionesNormativa: ['Interpretación o aplicación errónea de la norma'],
                    desacuerdos: ['Mixto'],
                    problemas: ['Interpretativo'],
                    metodoInterpretativo: ['Histórico', 'Principialista'],
                    estructuraPonderacion: ['Proporcionalidad estricta'],
                    tipoRazonamiento: ['Retórico (sin estructura real)'],
                    erroresSilogismo: ['Negación del antecedente'],
                    argumentosAtinencia: ['Ad populum'],
                    argumentosAmbiguedad: ['Anfibología'],
                    observaciones: 'Con disidencias del juez Pérez'
                },
                {
                    caratula: 'López, Marta c/ GCBA',
                    numeroCausa: '98765/2023',
                    fecha: '2023-08-05',
                    fallos: '339:121314',
                    materiaPrincipal: 'Supremacía constitucional',
                    subtema: 'Derechos convencionales',
                    integracion: 'Luis Martínez, Ana Pérez, Juan Gómez',
                    voto: 'unanimidad',
                    admisibilidad: 'si',
                    motivoInadmisible: '',
                    argumentoCorte: '',
                    cuestionesFederales: ['Supremacía constitucional', 'Derechos convencionales'],
                    arbitrariedadCausales: ['Exceso ritual manifiesto'],
                    arbitrariedadFactica: [],
                    opcionesFundamentacion: [],
                    opcionesNormativa: [],
                    desacuerdos: ['Normativo'],
                    problemas: ['Constitucionalidad de la norma'],
                    metodoInterpretativo: ['A contrario', 'Analógico'],
                    estructuraPonderacion: ['Fórmula del peso implícita'],
                    tipoRazonamiento: ['Balance explícito'],
                    erroresSilogismo: [],
                    argumentosAtinencia: ['De accidente'],
                    argumentosAmbiguedad: ['Composición'],
                    observaciones: 'Fallo plenario'
                },
                {
                    caratula: 'Fernández, Pedro c/ Poder Ejecutivo',
                    numeroCausa: '24680/2023',
                    fecha: '2023-09-18',
                    fallos: '340:151617',
                    materiaPrincipal: 'Prisión preventiva',
                    subtema: 'Excarcelación',
                    integracion: 'Ana Pérez, Juan Gómez, María López',
                    voto: 'mayoria',
                    admisibilidad: 'no',
                    motivoInadmisible: 'Falta de fundamentación autónoma',
                    argumentoCorte: 'Art. 15 ley 48',
                    cuestionesFederales: ['Prisión preventiva'],
                    arbitrariedadCausales: ['Falta de fundamentación suficiente', 'Valoración de hechos y prueba'],
                    arbitrariedadFactica: [],
                    opcionesFundamentacion: ['Falta de fundamentación idónea o no suficiente', 'Carencia de sustento'],
                    opcionesNormativa: [],
                    desacuerdos: ['Fáctico'],
                    problemas: ['Probatorio'],
                    metodoInterpretativo: ['Reducción al absurdo'],
                    estructuraPonderacion: ['Necesidad'],
                    tipoRazonamiento: ['Balance implícito'],
                    erroresSilogismo: ['Silogismo disyuntivo falaz'],
                    argumentosAtinencia: ['Causa falsa'],
                    argumentosAmbiguedad: ['Énfasis'],
                    observaciones: 'Inadmisible por falta de fundamentación'
                }
            ];
        }
        
        // ============ FUNCIONES DE FILTRADO ============
        function buscarFallos() {
            const filtroCaratula = document.getElementById('filtroCaratula').value.toLowerCase();
            const filtroCausa = document.getElementById('filtroCausa').value.toLowerCase();
            const filtroMateria = document.getElementById('filtroMateria').value;
            const filtroVoto = document.getElementById('filtroVoto').value;
            const filtroAdmisibilidad = document.getElementById('filtroAdmisibilidad').value;
            const filtroArbitrariedad = document.getElementById('filtroArbitrariedad').value;
            const filtroFechaDesde = document.getElementById('filtroFechaDesde').value;
            const filtroFechaHasta = document.getElementById('filtroFechaHasta').value;
            
            fallosFiltrados = fallosData.filter(fallo => {
                // Filtro carátula
                if (filtroCaratula && !fallo.caratula.toLowerCase().includes(filtroCaratula)) {
                    return false;
                }
                
                // Filtro número de causa
                if (filtroCausa && !fallo.numeroCausa.toLowerCase().includes(filtroCausa)) {
                    return false;
                }
                
                // Filtro materia principal
                if (filtroMateria && fallo.materiaPrincipal !== filtroMateria) {
                    return false;
                }
                
                // Filtro voto
                if (filtroVoto && fallo.voto !== filtroVoto) {
                    return false;
                }
                
                // Filtro admisibilidad
                if (filtroAdmisibilidad && fallo.admisibilidad !== filtroAdmisibilidad) {
                    return false;
                }
                
                // Filtro arbitrariedad (simplificado)
                if (filtroArbitrariedad) {
                    if (filtroArbitrariedad === 'normativa' && !fallo.arbitrariedadCausales.includes('Arbitrariedad normativa')) {
                        return false;
                    }
                    if (filtroArbitrariedad === 'factica' && !fallo.arbitrariedadCausales.includes('Arbitrariedad fáctica')) {
                        return false;
                    }
                    if (filtroArbitrariedad === 'logica' && !fallo.arbitrariedadCausales.includes('Contradicción')) {
                        return false;
                    }
                    if (filtroArbitrariedad === 'otras' && fallo.arbitrariedadCausales.length === 0) {
                        return false;
                    }
                    if (filtroArbitrariedad === 'otras' && fallo.arbitrariedadCausales.some(c => 
                        !c.includes('Arbitrariedad normativa') && 
                        !c.includes('Arbitrariedad fáctica') && 
                        c !== 'Contradicción'
                    )) {
                        return true;
                    }
                }
                
                // Filtro fecha desde
                if (filtroFechaDesde && fallo.fecha < filtroFechaDesde) {
                    return false;
                }
                
                // Filtro fecha hasta
                if (filtroFechaHasta && fallo.fecha > filtroFechaHasta) {
                    return false;
                }
                
                return true;
            });
            
            paginaActual = 1;
            actualizarEstadisticas();
            mostrarResultados();
        }
        
        function limpiarFiltros() {
            document.getElementById('filtroCaratula').value = '';
            document.getElementById('filtroCausa').value = '';
            document.getElementById('filtroMateria').value = '';
            document.getElementById('filtroVoto').value = '';
            document.getElementById('filtroAdmisibilidad').value = '';
            document.getElementById('filtroArbitrariedad').value = '';
            document.getElementById('filtroFechaDesde').value = '';
            document.getElementById('filtroFechaHasta').value = '';
            
            fallosFiltrados = [...fallosData];
            paginaActual = 1;
            actualizarEstadisticas();
            mostrarResultados();
        }
        
        // ============ FUNCIONES DE VISUALIZACIÓN ============
        function mostrarResultados() {
            const tbody = document.getElementById('tablaBody');
            const totalPaginas = Math.ceil(fallosFiltrados.length / resultadosPorPagina);
            
            if (fallosFiltrados.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="8" class="empty-state">
                            <i class="fas fa-search"></i>
                            <p>No se encontraron fallos con los filtros aplicados.</p>
                        </td>
                    </tr>
                `;
                document.getElementById('btnPrev').disabled = true;
                document.getElementById('btnNext').disabled = true;
                document.getElementById('pageInfo').textContent = 'Página 1 de 1';
                return;
            }
            
            const inicio = (paginaActual - 1) * resultadosPorPagina;
            const fin = Math.min(inicio + resultadosPorPagina, fallosFiltrados.length);
            const fallosPagina = fallosFiltrados.slice(inicio, fin);
            
            tbody.innerHTML = fallosPagina.map(fallo => {
                const fecha = new Date(fallo.fecha).toLocaleDateString('es-AR');
                const votoTexto = fallo.voto === 'unanimidad' ? 'Unanimidad' : 
                                 fallo.voto === 'mayoria' ? 'Mayoría' : 'Con disidencias';
                
                const admisibilidadClass = fallo.admisibilidad === 'si' ? 'badge-success' : 'badge-warning';
                const admisibilidadTexto = fallo.admisibilidad === 'si' ? 'Sí' : 'No';
                
                const arbitrariedadTexto = fallo.arbitrariedadCausales.length > 0 ? 
                    `<span class="badge badge-info">${fallo.arbitrariedadCausales.length} causal(es)</span>` : 
                    '<span class="badge">No</span>';
                
                return `
                    <tr>
                        <td><strong>${fallo.caratula}</strong></td>
                        <td>${fallo.numeroCausa}</td>
                        <td>${fecha}</td>
                        <td>${fallo.materiaPrincipal.substring(0, 30)}${fallo.materiaPrincipal.length > 30 ? '...' : ''}</td>
                        <td>${votoTexto}</td>
                        <td><span class="badge ${admisibilidadClass}">${admisibilidadTexto}</span></td>
                        <td>${arbitrariedadTexto}</td>
                        <td>
                            <button class="action-btn" onclick="verDetalle('${fallo.caratula}')" title="Ver detalle">
                                <i class="fas fa-eye"></i>
                            </button>
                        </td>
                    </tr>
                `;
            }).join('');
            
            // Actualizar paginación
            document.getElementById('btnPrev').disabled = paginaActual === 1;
            document.getElementById('btnNext').disabled = paginaActual === totalPaginas;
            document.getElementById('pageInfo').textContent = `Página ${paginaActual} de ${totalPaginas}`;
        }
        
        function cambiarPagina(direccion) {
            const totalPaginas = Math.ceil(fallosFiltrados.length / resultadosPorPagina);
            
            if (direccion === 'prev' && paginaActual > 1) {
                paginaActual--;
            } else if (direccion === 'next' && paginaActual < totalPaginas) {
                paginaActual++;
            }
            
            mostrarResultados();
        }
        
        // ============ ACTUALIZAR ESTADÍSTICAS ============
        function actualizarEstadisticas() {
            const totalFallos = fallosFiltrados.length;
            const totalAdmitidos = fallosFiltrados.filter(f => f.admisibilidad === 'si').length;
            const totalInadmisibles = fallosFiltrados.filter(f => f.admisibilidad === 'no').length;
            const totalArbitrariedad = fallosFiltrados.filter(f => f.arbitrariedadCausales.length > 0).length;
            
            document.getElementById('totalFallos').textContent = totalFallos;
            document.getElementById('totalAdmitidos').textContent = totalAdmitidos;
            document.getElementById('totalInadmisibles').textContent = totalInadmisibles;
            document.getElementById('totalArbitrariedad').textContent = totalArbitrariedad;
        }
        
        // ============ VER DETALLE ============
        function verDetalle(caratula) {
            const fallo = fallosFiltrados.find(f => f.caratula === caratula);
            if (!fallo) return;
            
            const modalBody = document.getElementById('modalBody');
            
            // Formatear arrays
            const cuestionesFederales = fallo.cuestionesFederales?.join(', ') || 'Ninguna';
            const arbitrariedadCausales = fallo.arbitrariedadCausales?.join(', ') || 'Ninguna';
            const desacuerdos = fallo.desacuerdos?.join(', ') || 'Ninguno';
            const problemas = fallo.problemas?.join(', ') || 'Ninguno';
            const metodoInterpretativo = fallo.metodoInterpretativo?.join(', ') || 'Ninguno';
            const estructuraPonderacion = fallo.estructuraPonderacion?.join(', ') || 'Ninguna';
            const tipoRazonamiento = fallo.tipoRazonamiento?.join(', ') || 'Ninguno';
            const erroresSilogismo = fallo.erroresSilogismo?.join(', ') || 'Ninguno';
            const argumentosAtinencia = fallo.argumentosAtinencia?.join(', ') || 'Ninguno';
            const argumentosAmbiguedad = fallo.argumentosAmbiguedad?.join(', ') || 'Ninguno';
            
            const votoTexto = fallo.voto === 'unanimidad' ? 'Unanimidad' : 
                             fallo.voto === 'mayoria' ? 'Mayoría' : 'Con disidencias';
            
            modalBody.innerHTML = `
                <div class="fallo-detalle-item">
                    <div class="fallo-detalle-label">Carátula</div>
                    <div class="fallo-detalle-value">${fallo.caratula}</div>
                </div>
                <div class="fallo-detalle-item">
                    <div class="fallo-detalle-label">N° Causa / Fallos</div>
                    <div class="fallo-detalle-value">${fallo.numeroCausa} ${fallo.fallos ? '- ' + fallo.fallos : ''}</div>
                </div>
                <div class="fallo-detalle-item">
                    <div class="fallo-detalle-label">Fecha</div>
                    <div class="fallo-detalle-value">${new Date(fallo.fecha).toLocaleDateString('es-AR')}</div>
                </div>
                <div class="fallo-detalle-item">
                    <div class="fallo-detalle-label">Integración del Tribunal</div>
                    <div class="fallo-detalle-value">${fallo.integracion}</div>
                </div>
                <div class="fallo-detalle-item">
                    <div class="fallo-detalle-label">Voto</div>
                    <div class="fallo-detalle-value">${votoTexto} ${fallo.detalleDisidencias ? '- ' + fallo.detalleDisidencias : ''}</div>
                </div>
                <div class="fallo-detalle-item">
                    <div class="fallo-detalle-label">Admisibilidad</div>
                    <div class="fallo-detalle-value">${fallo.admisibilidad === 'si' ? 'Sí' : 'No'} ${fallo.motivoInadmisible ? '- ' + fallo.motivoInadmisible : ''}</div>
                </div>
                ${fallo.argumentoCorte ? `
                <div class="fallo-detalle-item">
                    <div class="fallo-detalle-label">Argumento de la Corte</div>
                    <div class="fallo-detalle-value">${fallo.argumentoCorte}</div>
                </div>` : ''}
                <div class="fallo-detalle-item">
                    <div class="fallo-detalle-label">Materia principal</div>
                    <div class="fallo-detalle-value">${fallo.materiaPrincipal} ${fallo.subtema ? '- ' + fallo.subtema : ''}</div>
                </div>
                <div class="fallo-detalle-item">
                    <div class="fallo-detalle-label">Cuestiones federales</div>
                    <div class="fallo-detalle-value">${cuestionesFederales}</div>
                </div>
                <div class="fallo-detalle-item">
                    <div class="fallo-detalle-label">Arbitrariedad</div>
                    <div class="fallo-detalle-value">${arbitrariedadCausales}</div>
                </div>
                ${fallo.opcionesFundamentacion?.length ? `
                <div class="fallo-detalle-item">
                    <div class="fallo-detalle-label">Detalles de fundamentación</div>
                    <div class="fallo-detalle-value">${fallo.opcionesFundamentacion.join(', ')}</div>
                </div>` : ''}
                ${fallo.opcionesNormativa?.length ? `
                <div class="fallo-detalle-item">
                    <div class="fallo-detalle-label">Detalles normativos</div>
                    <div class="fallo-detalle-value">${fallo.opcionesNormativa.join(', ')}</div>
                </div>` : ''}
                <div class="fallo-detalle-item">
                    <div class="fallo-detalle-label">Tipo de desacuerdo</div>
                    <div class="fallo-detalle-value">${desacuerdos}</div>
                </div>
                <div class="fallo-detalle-item">
                    <div class="fallo-detalle-label">Problema jurídico</div>
                    <div class="fallo-detalle-value">${problemas} ${fallo.rolPrueba ? '- Rol de prueba: ' + fallo.rolPrueba : ''}</div>
                </div>
                <div class="fallo-detalle-item">
                    <div class="fallo-detalle-label">Método interpretativo</div>
                    <div class="fallo-detalle-value">${metodoInterpretativo}</div>
                </div>
                <div class="fallo-detalle-item">
                    <div class="fallo-detalle-label">Ponderación</div>
                    <div class="fallo-detalle-value">${estructuraPonderacion}</div>
                </div>
                <div class="fallo-detalle-item">
                    <div class="fallo-detalle-label">Tipo de razonamiento</div>
                    <div class="fallo-detalle-value">${tipoRazonamiento}</div>
                </div>
                <div class="fallo-detalle-item">
                    <div class="fallo-detalle-label">Errores del razonamiento</div>
                    <div class="fallo-detalle-value">
                        <strong>Falacias formales:</strong> ${erroresSilogismo}<br>
                        <strong>Atinencia:</strong> ${argumentosAtinencia}<br>
                        <strong>Ambigüedad:</strong> ${argumentosAmbiguedad}
                    </div>
                </div>
                ${fallo.observaciones ? `
                <div class="fallo-detalle-item">
                    <div class="fallo-detalle-label">Observaciones</div>
                    <div class="fallo-detalle-value">${fallo.observaciones}</div>
                </div>` : ''}
            `;
            
            document.getElementById('detalleModal').style.display = 'block';
        }
        
        function cerrarModal() {
            document.getElementById('detalleModal').style.display = 'none';
        }
        
        // Cerrar modal con click fuera
        window.onclick = function(event) {
            const modal = document.getElementById('detalleModal');
            if (event.target === modal) {
                modal.style.display = 'none';
            }
        };
        
        // ============ FUNCIONES DE EXPORTACIÓN ============
        function exportarCSV() {
            if (fallosFiltrados.length === 0) {
                alert('No hay datos para exportar');
                return;
            }
            
            // Cabeceras
            const cabeceras = ['Carátula', 'N° Causa', 'Fallos', 'Fecha', 'Integración', 'Voto', 'Admisibilidad', 
                              'Motivo Inadmisible', 'Materia Principal', 'Subtema', 'Cuestiones Federales', 
                              'Arbitrariedad', 'Desacuerdos', 'Problemas', 'Método Interpretativo', 
                              'Ponderación', 'Razonamiento', 'Observaciones'];
            
            // Filas
            const filas = fallosFiltrados.map(fallo => [
                fallo.caratula,
                fallo.numeroCausa,
                fallo.fallos || '',
                fallo.fecha,
                fallo.integracion,
                fallo.voto,
                fallo.admisibilidad,
                fallo.motivoInadmisible || '',
                fallo.materiaPrincipal,
                fallo.subtema || '',
                (fallo.cuestionesFederales || []).join('; '),
                (fallo.arbitrariedadCausales || []).join('; '),
                (fallo.desacuerdos || []).join('; '),
                (fallo.problemas || []).join('; '),
                (fallo.metodoInterpretativo || []).join('; '),
                (fallo.estructuraPonderacion || []).join('; '),
                (fallo.tipoRazonamiento || []).join('; '),
                fallo.observaciones || ''
            ]);
            
            // Convertir a CSV
            const csvContent = [
                cabeceras.join(','),
                ...filas.map(fila => fila.map(celda => `"${celda}"`).join(','))
            ].join('\n');
            
            // Descargar
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `fallos_export_${new Date().toISOString().slice(0,10)}.csv`;
            link.click();
        }
        
        function exportarExcel() {
            exportarCSV(); // Por ahora igual que CSV, en implementación real usarían librería Excel
        }
    </script>
</body>
</html>